{
  return builder.setImplicitOutputsFunction(ImplicitOutputsFunction.fromFunctions(ReleaseBundlingSupport.IPA,XcodeSupport.PBXPROJ)).override(attr(IosTest.TARGET_DEVICE,LABEL).allowedFileTypes().allowedRuleClasses(Constants.IOS_DEVICE_RULE_CLASSES).value(env.getLabel("//tools/objc/sim_devices:default"))).add(attr("ios_test_target_device",LABEL).allowedFileTypes().allowedRuleClasses("ios_lab_device")).add(attr("ios_device_arg",STRING_LIST)).add(attr("plugins",LABEL_LIST).allowedFileTypes(FileType.of("_deploy.jar"))).add(attr("$test_template",LABEL).value(env.getLabel("//tools/objc:ios_test.sh.bazel_template"))).add(attr("$test_runner",LABEL).value(env.getLabel("//tools/objc:testrunner"))).override(attr(":gcov",LABEL_LIST).cfg(HOST).value(new LateBoundLabelList<BuildConfiguration>(){
    @Override public List<Label> getDefault(    Rule rule,    BuildConfiguration configuration){
      if (!configuration.isCodeCoverageEnabled()) {
        return ImmutableList.of();
      }
      return ImmutableList.of(configuration.getFragment(ObjcConfiguration.class).getGcovLabel());
    }
  }
)).build();
}
