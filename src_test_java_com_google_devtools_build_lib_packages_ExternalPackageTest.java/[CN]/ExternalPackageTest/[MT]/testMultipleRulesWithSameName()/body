{
  Builder builder=Package.newExternalPackageBuilder(workspacePath,"TESTING");
  Location buildFile=Location.fromFile(getOutputPath().getRelative("BUILD"));
  RuleClass ruleClass=TestRuleClassProvider.getRuleClassProvider().getRuleClassMap().get("cc_library");
  RuleClass bindRuleClass=TestRuleClassProvider.getRuleClassProvider().getRuleClassMap().get("bind");
  Map<String,Object> kwargs=ImmutableMap.of("name",(Object)"my-rule");
  FuncallExpression ast=new FuncallExpression(new Identifier(ruleClass.getName()),Lists.<Argument.Passed>newArrayList());
  ast.setLocation(buildFile);
  builder.externalPackageData().createAndAddRepositoryRule(builder,ruleClass,bindRuleClass,kwargs,ast);
  ruleClass=TestRuleClassProvider.getRuleClassProvider().getRuleClassMap().get("sh_test");
  ast=new FuncallExpression(new Identifier(ruleClass.getName()),Lists.<Argument.Passed>newArrayList());
  ast.setLocation(buildFile);
  builder.externalPackageData().createAndAddRepositoryRule(builder,ruleClass,bindRuleClass,kwargs,ast);
  Package pkg=builder.build();
  assertEquals("sh_test rule",pkg.getTarget("my-rule").getTargetKind());
}
