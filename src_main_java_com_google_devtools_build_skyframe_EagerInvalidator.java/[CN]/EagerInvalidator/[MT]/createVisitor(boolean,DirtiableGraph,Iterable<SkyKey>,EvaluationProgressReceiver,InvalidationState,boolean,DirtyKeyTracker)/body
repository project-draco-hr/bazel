{
  state.update(diff);
  if (state.isEmpty()) {
    return null;
  }
  return delete ? new DeletingNodeVisitor(graph,invalidationReceiver,state,traverseGraph,dirtyKeyTracker) : new DirtyingNodeVisitor(graph,invalidationReceiver,state,dirtyKeyTracker);
}
