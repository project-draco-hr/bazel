{
  Preconditions.checkNotNull(comparator);
  ImmutableSortedSet<K> sortedKeys=ImmutableSortedSet.copyOf(comparator,keys);
  final List<KeyedLocker.AutoUnlocker> unlockers=new ArrayList<>(sortedKeys.size());
  boolean success=false;
  try {
    for (    K key : sortedKeys) {
      unlockers.add(lock(key));
    }
    success=true;
    return new AtMostOnceAutoUnlockerBase<K>(){
      @Override public void doClose(){
        unlockAll(unlockers);
      }
    }
;
  }
  finally {
    if (!success) {
      unlockAll(unlockers);
    }
  }
}
