{
  if (Map.class.isAssignableFrom(itemType) || SkylarkList.class.isAssignableFrom(itemType) || ClassObject.class.isAssignableFrom(itemType)) {
    throw new EvalException(loc,String.format("nested set item is composite (type of %s)",EvalUtils.getDataTypeNameFromClass(itemType)));
  }
  if (!EvalUtils.isSkylarkImmutable(itemType)) {
    throw new EvalException(loc,String.format("nested set item is not immutable (type of %s)",EvalUtils.getDataTypeNameFromClass(itemType)));
  }
  if (builderType.equals(Object.class)) {
    return itemType;
  }
  if (!EvalUtils.getSkylarkType(builderType).equals(EvalUtils.getSkylarkType(itemType))) {
    throw new EvalException(loc,String.format("nested set item is type of %s but the nested set accepts only %s-s",EvalUtils.getDataTypeNameFromClass(itemType),EvalUtils.getDataTypeNameFromClass(builderType)));
  }
  return builderType;
}
