{
  ImmutableList<SdkFramework> extraSdkFrameworks=isXcTest(ruleContext) ? AUTOMATIC_SDK_FRAMEWORKS_FOR_XCTEST : ImmutableList.<SdkFramework>of();
  List<ObjcProvider> extraDepObjcProviders=new ArrayList<>();
  if (isXcTest(ruleContext)) {
    extraDepObjcProviders.add(xcTestAppProvider(ruleContext).getObjcProvider());
  }
  ObjcConfiguration config=ruleContext.getFragment(ObjcConfiguration.class);
  if (config.runMemleaks()) {
    extraDepObjcProviders.add(ruleContext.getPrerequisite(MEMLEAKS_DEP,Mode.TARGET,ObjcProvider.class));
  }
  return ObjcLibrary.common(ruleContext,extraSdkFrameworks,false,extraDepObjcProviders);
}
