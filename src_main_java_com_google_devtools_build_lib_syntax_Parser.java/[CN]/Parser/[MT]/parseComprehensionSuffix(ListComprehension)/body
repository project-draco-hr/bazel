{
  while (true) {
switch (token.kind) {
case FOR:
      nextToken();
    Expression loopVar=parseForLoopVariables();
  expect(TokenKind.IN);
Expression listExpression=parseNonTupleExpression(0);
listComprehension.addFor(loopVar,listExpression);
break;
case IF:
nextToken();
listComprehension.addIf(parseExpression());
break;
case RBRACKET:
nextToken();
return listComprehension;
default :
syntaxError(token,"expected ']', 'for' or 'if'");
syncPast(LIST_TERMINATOR_SET);
return makeErrorExpression(token.left,token.right);
}
}
}
