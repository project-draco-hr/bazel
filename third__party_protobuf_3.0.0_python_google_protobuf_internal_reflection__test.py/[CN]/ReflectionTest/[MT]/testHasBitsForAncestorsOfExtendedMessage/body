def testHasBitsForAncestorsOfExtendedMessage(self):
    toplevel = more_extensions_pb2.TopLevelMessage()
    self.assertTrue((not toplevel.HasField('submessage')))
    self.assertEqual(0, toplevel.submessage.Extensions[more_extensions_pb2.optional_int_extension])
    self.assertTrue((not toplevel.HasField('submessage')))
    toplevel.submessage.Extensions[more_extensions_pb2.optional_int_extension] = 23
    self.assertEqual(23, toplevel.submessage.Extensions[more_extensions_pb2.optional_int_extension])
    self.assertTrue(toplevel.HasField('submessage'))
    toplevel = more_extensions_pb2.TopLevelMessage()
    self.assertTrue((not toplevel.HasField('submessage')))
    self.assertEqual([], toplevel.submessage.Extensions[more_extensions_pb2.repeated_int_extension])
    self.assertTrue((not toplevel.HasField('submessage')))
    toplevel.submessage.Extensions[more_extensions_pb2.repeated_int_extension].append(23)
    self.assertEqual([23], toplevel.submessage.Extensions[more_extensions_pb2.repeated_int_extension])
    self.assertTrue(toplevel.HasField('submessage'))
    toplevel = more_extensions_pb2.TopLevelMessage()
    self.assertTrue((not toplevel.HasField('submessage')))
    self.assertEqual(0, toplevel.submessage.Extensions[more_extensions_pb2.optional_message_extension].foreign_message_int)
    self.assertTrue((not toplevel.HasField('submessage')))
    toplevel.submessage.Extensions[more_extensions_pb2.optional_message_extension].foreign_message_int = 23
    self.assertEqual(23, toplevel.submessage.Extensions[more_extensions_pb2.optional_message_extension].foreign_message_int)
    self.assertTrue(toplevel.HasField('submessage'))
    toplevel = more_extensions_pb2.TopLevelMessage()
    self.assertTrue((not toplevel.HasField('submessage')))
    self.assertEqual(0, len(toplevel.submessage.Extensions[more_extensions_pb2.repeated_message_extension]))
    self.assertTrue((not toplevel.HasField('submessage')))
    foreign = toplevel.submessage.Extensions[more_extensions_pb2.repeated_message_extension].add()
    self.assertEqual(foreign, toplevel.submessage.Extensions[more_extensions_pb2.repeated_message_extension][0])
    self.assertTrue(toplevel.HasField('submessage'))
