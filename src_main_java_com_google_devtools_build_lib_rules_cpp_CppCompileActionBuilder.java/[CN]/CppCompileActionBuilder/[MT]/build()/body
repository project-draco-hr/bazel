{
  Preconditions.checkNotNull(shouldScanIncludes);
  NestedSetBuilder<Artifact> realMandatoryInputsBuilder=NestedSetBuilder.compileOrder();
  realMandatoryInputsBuilder.addTransitive(mandatoryInputsBuilder.build());
  if (tempOutputFile == null && !shouldScanIncludes) {
    realMandatoryInputsBuilder.addTransitive(context.getDeclaredIncludeSrcs());
  }
  realMandatoryInputsBuilder.addTransitive(context.getAdditionalInputs(usePic));
  realMandatoryInputsBuilder.addTransitive(pluginInputsBuilder.build());
  realMandatoryInputsBuilder.add(sourceFile);
  boolean fake=tempOutputFile != null;
  ImmutableSet<String> executionRequirements=ImmutableSet.of();
  if (featureConfiguration.actionIsConfigured(getActionName())) {
    executionRequirements=featureConfiguration.getToolForAction(getActionName()).getExecutionRequirements();
  }
  if (fake) {
    return new FakeCppCompileAction(owner,ImmutableList.copyOf(features),featureConfiguration,variables,sourceFile,shouldScanIncludes,sourceLabel,realMandatoryInputsBuilder.build(),outputFile,tempOutputFile,dotdFile,configuration,cppConfiguration,context,actionContext,ImmutableList.copyOf(copts),ImmutableList.copyOf(pluginOpts),getNocoptPredicate(nocopts),extraSystemIncludePrefixes,fdoBuildStamp,ruleContext,usePic);
  }
 else {
    NestedSet<Artifact> realMandatoryInputs=realMandatoryInputsBuilder.build();
    return new CppCompileAction(owner,ImmutableList.copyOf(features),featureConfiguration,variables,sourceFile,shouldScanIncludes,sourceLabel,realMandatoryInputs,outputFile,dotdFile,gcnoFile,getDwoFile(ruleContext,outputFile,cppConfiguration),optionalSourceFile,configuration,cppConfiguration,context,actionContext,ImmutableList.copyOf(copts),ImmutableList.copyOf(pluginOpts),getNocoptPredicate(nocopts),extraSystemIncludePrefixes,fdoBuildStamp,specialInputsHandler,getLipoScannables(realMandatoryInputs),actionClassId,usePic,executionRequirements,getActionName(),ruleContext);
  }
}
