{
  ImmutableList<Artifact> generatedSources=getGeneratedSources();
  CompilationArtifacts.Builder builder=new CompilationArtifacts.Builder().setIntermediateArtifacts(intermediateArtifacts).setPchFile(Optional.<Artifact>absent()).addAdditionalHdrs(getGeneratedHeaders());
  if (experimentalAutoUnion()) {
    if (targetType == TargetType.LINKING_TARGET) {
      builder.addNonArcSrcs(generatedSources);
    }
  }
 else {
    if (targetType == TargetType.PROTO_TARGET) {
      builder.addNonArcSrcs(generatedSources);
    }
  }
  return builder.build();
}
