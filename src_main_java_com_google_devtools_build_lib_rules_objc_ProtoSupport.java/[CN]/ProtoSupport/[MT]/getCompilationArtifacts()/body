{
  ImmutableList<Artifact> generatedSources=getGeneratedSources();
  CompilationArtifacts.Builder builder=new CompilationArtifacts.Builder().setIntermediateArtifacts(intermediateArtifacts).setPchFile(Optional.<Artifact>absent()).addAdditionalHdrs(getGeneratedHeaders());
  if (targetType == TargetType.PROTO_TARGET && !usesProtobufLibrary()) {
    builder.addAdditionalHdrs(generatedSources);
  }
  if ((targetType == TargetType.PROTO_TARGET && !usesProtobufLibrary()) || targetType == TargetType.LINKING_TARGET) {
    builder.addNonArcSrcs(generatedSources);
  }
  return builder.build();
}
