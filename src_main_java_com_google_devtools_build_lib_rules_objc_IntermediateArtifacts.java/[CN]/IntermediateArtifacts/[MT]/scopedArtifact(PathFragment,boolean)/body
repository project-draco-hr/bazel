{
  Root root=inGenfiles ? ruleContext.getConfiguration().getGenfilesDirectory() : ruleContext.getConfiguration().getBinDirectory();
  if (scopingLabel.isPresent()) {
    return ruleContext.getUniqueDirectoryArtifact("_intermediate_scoped",scopingLabel.get().getPackageIdentifier().getPathFragment().getRelative(scopingLabel.get().getName()).getRelative(scopeRelative),root);
  }
 else {
    return ruleContext.getPackageRelativeArtifact(scopeRelative,root);
  }
}
