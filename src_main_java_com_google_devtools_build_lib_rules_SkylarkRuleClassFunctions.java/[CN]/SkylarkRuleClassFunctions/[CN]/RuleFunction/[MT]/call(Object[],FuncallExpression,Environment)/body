{
  env.checkLoadingPhase(getName(),ast.getLocation());
  try {
    if (ruleClass == null) {
      throw new EvalException(ast.getLocation(),"Invalid rule class hasn't been exported by a Skylark file");
    }
    PackageContext pkgContext=(PackageContext)env.lookup(PackageFactory.PKG_CONTEXT);
    BuildLangTypedAttributeValuesMap attributeValues=new BuildLangTypedAttributeValuesMap((Map<String,Object>)args[0]);
    return RuleFactory.createAndAddRule(pkgContext,ruleClass,attributeValues,ast,env,pkgContext.getAttributeContainerFactory().apply(ruleClass));
  }
 catch (  InvalidRuleException|NameConflictException|NoSuchVariableException e) {
    throw new EvalException(ast.getLocation(),e.getMessage());
  }
}
