{
  Map<Artifact,Action> generatingActions=new HashMap<>();
  for (  Action action : actions) {
    for (    Artifact artifact : action.getOutputs()) {
      Action previousAction=generatingActions.put(artifact,action);
      if (previousAction != null && previousAction != action) {
        if (!allowSharedAction || !Actions.canBeShared(previousAction,action)) {
          throw new ActionConflictException(artifact,previousAction,action);
        }
      }
    }
  }
  return generatingActions;
}
