{
  Preconditions.checkNotNull(labelMap);
  for (  Map.Entry<Attribute,Collection<LabelAndConfiguration>> entry : labelMap.asMap().entrySet()) {
    Attribute attribute=entry.getKey();
    for (    LabelAndConfiguration dep : entry.getValue()) {
      Label label=dep.getLabel();
      BuildConfiguration config=dep.getConfiguration();
      Target toTarget;
      try {
        toTarget=getTarget(label);
      }
 catch (      NoSuchThingException e) {
        throw new IllegalStateException("not found: " + label + " from "+ rule+ " in "+ attribute.getName());
      }
      if (toTarget == null) {
        continue;
      }
      BuildConfiguration.TransitionApplier transitionApplier=config.getTransitionApplier();
      if (config.useDynamicConfigurations() && config.isHostConfiguration() && !BuildConfiguration.usesNullConfiguration(toTarget)) {
        transitionApplier.applyTransition(Attribute.ConfigurationTransition.HOST);
      }
 else {
        config.evaluateTransition(rule,attribute,toTarget,transitionApplier);
      }
      for (      Dependency dependency : transitionApplier.getDependencies(label,requiredAspects(aspectWithParameters,attribute,toTarget,rule))) {
        outgoingEdges.put(entry.getKey(),dependency);
      }
    }
  }
}
