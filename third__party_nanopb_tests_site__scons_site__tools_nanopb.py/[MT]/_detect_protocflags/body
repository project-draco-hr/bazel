def _detect_protocflags(env):
    'Find the options to use for protoc.'
    if env.has_key('PROTOCFLAGS'):
        return env['PROTOCFLAGS']
    p = _detect_protoc(env)
    n = _detect_nanopb(env)
    p1 = os.path.join(n, 'generator-bin', ('protoc' + env['PROGSUFFIX']))
    if (p == env['ESCAPE'](p1)):
        return ''
    e = env['ESCAPE']
    if (env['PLATFORM'] == 'win32'):
        return e(('--plugin=protoc-gen-nanopb=' + os.path.join(n, 'generator', 'protoc-gen-nanopb.bat')))
    else:
        return e(('--plugin=protoc-gen-nanopb=' + os.path.join(n, 'generator', 'protoc-gen-nanopb')))
