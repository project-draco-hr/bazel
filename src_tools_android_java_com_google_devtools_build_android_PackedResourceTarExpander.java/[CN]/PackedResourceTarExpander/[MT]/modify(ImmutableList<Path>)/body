{
  final Builder<Path> outDirs=ImmutableList.builder();
  for (  final Path unresolvedRoot : resourceRoots) {
    Path root=unresolvedRoot.toAbsolutePath();
    try {
      final Path packedResources=root.resolve("raw/blaze_internal_packed_resources.tar");
      if (Files.exists(packedResources)) {
        Preconditions.checkArgument(root.startsWith(workingDirectory),"%s is not under %s",root,workingDirectory);
        final Path resourcePrefix=workingDirectory.relativize(root);
        final Path targetDirectory=out.resolve(resourcePrefix);
        outDirs.add(targetDirectory);
        copyRemainingResources(root,packedResources);
        final Path tarOut=out.resolve("blaze_internal_packed_resources").resolve(resourcePrefix);
        unTarPackedResources(tarOut,packedResources);
        outDirs.add(tarOut);
      }
 else {
        outDirs.add(root);
      }
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
  }
  return outDirs.build();
}
