{
  FilesToRunProvider provider=target.getProvider(FilesToRunProvider.class);
  RunfilesSupport runfilesSupport=provider == null ? null : provider.getRunfilesSupport();
  if (runfilesSupport == null) {
    return runtime.getWorkingDirectory();
  }
  Artifact manifest=runfilesSupport.getRunfilesManifest();
  PathFragment runfilesDir=runfilesSupport.getRunfilesDirectoryExecPath();
  Path workingDir=runtime.getExecRoot().getRelative(runfilesDir).getRelative(runtime.getRunfilesPrefix());
  if (!RUNFILES_MANIFEST.matches(manifest.getFilename())) {
    return workingDir;
  }
  SymlinkTreeHelper helper=new SymlinkTreeHelper(manifest.getExecPath(),runfilesDir,false);
  helper.createSymlinksUsingCommand(runtime.getExecRoot(),target.getConfiguration(),runtime.getBinTools());
  return workingDir;
}
