{
  Runfiles.Builder runfilesBuilder=new Runfiles.Builder();
  NestedSetBuilder<Artifact> filesToBuildBuilder=NestedSetBuilder.<Artifact>stableOrder();
  filesToBuildBuilder.addTransitive(filesToBuild);
  TestSupport testSupport=new TestSupport(ruleContext).registerTestRunnerActionsForSimulator().addRunfiles(runfilesBuilder).addFilesToBuild(filesToBuildBuilder);
  Artifact executable=testSupport.generatedTestScript();
  Runfiles runfiles=runfilesBuilder.build();
  RunfilesSupport runfilesSupport=RunfilesSupport.withExecutable(ruleContext,runfiles,executable);
  return new RuleConfiguredTargetBuilder(ruleContext).setFilesToBuild(filesToBuildBuilder.build()).add(XcodeProvider.class,xcodeProvider).add(RunfilesProvider.class,RunfilesProvider.simple(runfiles)).add(ExecutionInfoProvider.class,new ExecutionInfoProvider(ImmutableMap.of(ExecutionRequirements.REQUIRES_DARWIN,""))).setRunfilesSupport(runfilesSupport,executable).build();
}
