{
  Runfiles.Builder runfilesBuilder=new Runfiles.Builder().addRunfiles(ruleContext,RunfilesProvider.DEFAULT_RUNFILES);
  NestedSetBuilder<Artifact> filesToBuildBuilder=NestedSetBuilder.<Artifact>stableOrder().addTransitive(filesToBuild);
  TestSupport testSupport=new TestSupport(ruleContext).registerTestRunnerActions().addRunfiles(runfilesBuilder,common.getObjcProvider()).addFilesToBuild(filesToBuildBuilder);
  Artifact executable=testSupport.generatedTestScript();
  Runfiles runfiles=runfilesBuilder.build();
  RunfilesSupport runfilesSupport=RunfilesSupport.withExecutable(ruleContext,runfiles,executable);
  return new RuleConfiguredTargetBuilder(ruleContext).setFilesToBuild(filesToBuildBuilder.build()).add(XcodeProvider.class,xcodeProvider).add(RunfilesProvider.class,RunfilesProvider.simple(runfiles)).add(ExecutionInfoProvider.class,new ExecutionInfoProvider(ImmutableMap.of(ExecutionRequirements.REQUIRES_DARWIN,""))).addProviders(testSupport.getExtraProviders(common.getObjcProvider())).setRunfilesSupport(runfilesSupport,executable).build();
}
