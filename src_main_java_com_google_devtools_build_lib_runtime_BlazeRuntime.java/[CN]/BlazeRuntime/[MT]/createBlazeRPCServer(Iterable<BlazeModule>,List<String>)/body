{
  BlazeRuntime runtime=newRuntime(modules,args);
  BlazeCommandDispatcher dispatcher=new BlazeCommandDispatcher(runtime);
  CommandExecutor commandExecutor=new CommandExecutor(runtime,dispatcher);
  BlazeServerStartupOptions startupOptions=runtime.getStartupOptionsProvider().getOptions(BlazeServerStartupOptions.class);
  try {
    Class<?> factoryClass=Class.forName("com.google.devtools.build.lib.server.GrpcServerImpl$Factory");
    RPCServer.Factory factory=(RPCServer.Factory)factoryClass.newInstance();
    return factory.create(commandExecutor,runtime.getClock(),startupOptions.commandPort,runtime.getServerDirectory(),startupOptions.maxIdleSeconds);
  }
 catch (  ClassNotFoundException|InstantiationException|IllegalAccessException e) {
    throw new AbruptExitException("gRPC server not compiled in",ExitCode.BLAZE_INTERNAL_ERROR);
  }
}
