{
  Preconditions.checkNotNull(intermediateArtifacts,"intermediateArtifacts");
  Optional<Artifact> plistWithEverything=Optional.absent();
  Action[] mergeActions=new Action[0];
  if (!inputPlists.isEmpty()) {
    int inputs=Iterables.size(inputPlists);
    if (inputs == 1 && primaryBundleId == null && fallbackBundleId == null) {
      plistWithEverything=Optional.of(Iterables.getOnlyElement(inputPlists));
    }
 else {
      Artifact merged=intermediateArtifacts.mergedInfoplist();
      plistWithEverything=Optional.of(merged);
      mergeActions=new SpawnAction.Builder().setMnemonic("MergeInfoPlistFiles").setExecutable(plmerge).setCommandLine(mergeCommandLine(inputPlists,merged,primaryBundleId,fallbackBundleId)).addTransitiveInputs(inputPlists).addOutput(merged).build(context);
    }
  }
  return new InfoplistMerging(plistWithEverything,mergeActions,inputPlists);
}
