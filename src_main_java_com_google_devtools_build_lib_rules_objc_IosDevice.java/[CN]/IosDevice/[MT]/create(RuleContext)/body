{
  String iosVersionAttribute=context.attributes().get("ios_version",STRING);
  DottedVersion iosVersion;
  if (!Strings.isNullOrEmpty(iosVersionAttribute)) {
    iosVersion=DottedVersion.fromString(iosVersionAttribute);
  }
 else {
    iosVersion=context.getFragment(AppleConfiguration.class).getSdkVersionForPlatform(Platform.IOS_SIMULATOR);
  }
  IosDeviceProvider provider=new IosDeviceProvider.Builder().setType(context.attributes().get("type",STRING)).setIosVersion(iosVersion).setLocale(context.attributes().get("locale",STRING)).build();
  return new RuleConfiguredTargetBuilder(context).add(RunfilesProvider.class,RunfilesProvider.EMPTY).add(IosDeviceProvider.class,provider).add(IosTestSubstitutionProvider.class,provider.iosTestSubstitutionProvider()).build();
}
