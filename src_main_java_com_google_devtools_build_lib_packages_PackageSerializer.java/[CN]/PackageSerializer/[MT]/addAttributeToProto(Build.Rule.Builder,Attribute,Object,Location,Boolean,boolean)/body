{
  com.google.devtools.build.lib.packages.Type<?> type=attr.getType();
  Build.Attribute.Builder attrPb=Build.Attribute.newBuilder();
  Build.Attribute.Discriminator attributeProtoType=ProtoUtils.getDiscriminatorFromType(type);
  attrPb.setName(attr.getName());
  attrPb.setType(attributeProtoType);
  if (location != null) {
    attrPb.setParseableLocation(serializeLocation(location));
  }
  if (explicitlySpecified != null) {
    attrPb.setExplicitlySpecified(explicitlySpecified);
  }
  if (type == INTEGER) {
    attrPb.setIntValue((Integer)value);
  }
 else   if (type == STRING || type == LABEL || type == NODEP_LABEL || type == OUTPUT) {
    attrPb.setStringValue(value.toString());
  }
 else   if (type == STRING_LIST || type == LABEL_LIST || type == NODEP_LABEL_LIST || type == OUTPUT_LIST || type == DISTRIBUTIONS) {
    Collection<?> values=(Collection<?>)value;
    for (    Object entry : values) {
      attrPb.addStringListValue(entry.toString());
    }
  }
 else   if (type == INTEGER_LIST) {
    Collection<Integer> values=(Collection<Integer>)value;
    for (    Integer entry : values) {
      attrPb.addIntListValue(entry);
    }
  }
 else   if (type == BOOLEAN) {
    if ((Boolean)value) {
      attrPb.setStringValue("true");
      attrPb.setBooleanValue(true);
    }
 else {
      attrPb.setStringValue("false");
      attrPb.setBooleanValue(false);
    }
    attrPb.setIntValue((Boolean)value ? 1 : 0);
  }
 else   if (type == TRISTATE) {
switch ((TriState)value) {
case AUTO:
      attrPb.setIntValue(-1);
    attrPb.setStringValue("auto");
  attrPb.setTristateValue(Build.Attribute.Tristate.AUTO);
break;
case NO:
attrPb.setIntValue(0);
attrPb.setStringValue("no");
attrPb.setTristateValue(Build.Attribute.Tristate.NO);
break;
case YES:
attrPb.setIntValue(1);
attrPb.setStringValue("yes");
attrPb.setTristateValue(Build.Attribute.Tristate.YES);
break;
}
}
 else if (type == LICENSE) {
License license=(License)value;
Build.License.Builder licensePb=Build.License.newBuilder();
for (License.LicenseType licenseType : license.getLicenseTypes()) {
licensePb.addLicenseType(licenseType.toString());
}
for (Label exception : license.getExceptions()) {
licensePb.addException(exception.toString());
}
attrPb.setLicense(licensePb);
}
 else if (type == STRING_DICT) {
Map<String,String> dict=(Map<String,String>)value;
for (Map.Entry<String,String> dictEntry : dict.entrySet()) {
Build.StringDictEntry entry=Build.StringDictEntry.newBuilder().setKey(dictEntry.getKey()).setValue(dictEntry.getValue()).build();
attrPb.addStringDictValue(entry);
}
}
 else if (type == STRING_DICT_UNARY) {
Map<String,String> dict=(Map<String,String>)value;
for (Map.Entry<String,String> dictEntry : dict.entrySet()) {
Build.StringDictUnaryEntry entry=Build.StringDictUnaryEntry.newBuilder().setKey(dictEntry.getKey()).setValue(dictEntry.getValue()).build();
attrPb.addStringDictUnaryValue(entry);
}
}
 else if (type == STRING_LIST_DICT) {
Map<String,List<String>> dict=(Map<String,List<String>>)value;
for (Map.Entry<String,List<String>> dictEntry : dict.entrySet()) {
Build.StringListDictEntry.Builder entry=Build.StringListDictEntry.newBuilder().setKey(dictEntry.getKey());
for (Object dictEntryValue : dictEntry.getValue()) {
entry.addValue(dictEntryValue.toString());
}
attrPb.addStringListDictValue(entry);
}
}
 else if (type == LABEL_LIST_DICT) {
Map<String,List<Label>> dict=(Map<String,List<Label>>)value;
for (Map.Entry<String,List<Label>> dictEntry : dict.entrySet()) {
Build.LabelListDictEntry.Builder entry=Build.LabelListDictEntry.newBuilder().setKey(dictEntry.getKey());
for (Object dictEntryValue : dictEntry.getValue()) {
entry.addValue(dictEntryValue.toString());
}
attrPb.addLabelListDictValue(entry);
}
}
 else if (type == FILESET_ENTRY_LIST) {
List<FilesetEntry> filesetEntries=(List<FilesetEntry>)value;
for (FilesetEntry filesetEntry : filesetEntries) {
Build.FilesetEntry.Builder filesetEntryPb=Build.FilesetEntry.newBuilder().setSource(filesetEntry.getSrcLabel().toString()).setDestinationDirectory(filesetEntry.getDestDir().getPathString()).setSymlinkBehavior(symlinkBehaviorToPb(filesetEntry.getSymlinkBehavior())).setStripPrefix(filesetEntry.getStripPrefix()).setFilesPresent(filesetEntry.getFiles() != null);
if (filesetEntry.getFiles() != null) {
for (Label file : filesetEntry.getFiles()) {
filesetEntryPb.addFile(file.toString());
}
}
if (filesetEntry.getExcludes() != null) {
for (String exclude : filesetEntry.getExcludes()) {
filesetEntryPb.addExclude(exclude);
}
}
attrPb.addFilesetListValue(filesetEntryPb);
}
}
 else {
throw new IllegalStateException("Unknown type: " + type);
}
if (includeGlobs && value instanceof GlobList<?>) {
GlobList<?> globList=(GlobList<?>)value;
for (GlobCriteria criteria : globList.getCriteria()) {
Build.GlobCriteria.Builder criteriaPb=Build.GlobCriteria.newBuilder();
criteriaPb.setGlob(criteria.isGlob());
for (String include : criteria.getIncludePatterns()) {
criteriaPb.addInclude(include);
}
for (String exclude : criteria.getExcludePatterns()) {
criteriaPb.addExclude(exclude);
}
attrPb.addGlobCriteria(criteriaPb);
}
}
result.addAttribute(attrPb);
}
