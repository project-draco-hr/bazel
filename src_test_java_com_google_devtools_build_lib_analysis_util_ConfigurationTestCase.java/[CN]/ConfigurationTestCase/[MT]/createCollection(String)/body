{
  OptionsParser parser=OptionsParser.newOptionsParser(ImmutableList.<Class<? extends OptionsBase>>builder().addAll(buildOptionClasses).add(TestOptions.class).build());
  parser.parse(args);
  InvocationPolicyEnforcer optionsPolicyEnforcer=new InvocationPolicyEnforcer(TestConstants.TEST_INVOCATION_POLICY);
  optionsPolicyEnforcer.enforce(parser);
  ImmutableSortedSet<String> multiCpu=ImmutableSortedSet.copyOf(parser.getOptions(TestOptions.class).multiCpus);
  configurationFactory.forbidSanityCheck();
  BuildOptions buildOptions=BuildOptions.of(buildOptionClasses,parser);
  BuildConfigurationCollection collection=skyframeExecutor.createConfigurations(reporter,configurationFactory,buildOptions,new BlazeDirectories(outputBase,outputBase,workspace),multiCpu,false);
  return collection;
}
