{
  workspace=rootDirectory;
  ConfiguredRuleClassProvider ruleClassProvider=TestRuleClassProvider.getRuleClassProvider();
  PathPackageLocator pkgLocator=new PathPackageLocator(outputBase,ImmutableList.of(rootDirectory));
  final PackageFactory pkgFactory;
  BlazeDirectories directories=new BlazeDirectories(outputBase,outputBase,rootDirectory,TestConstants.PRODUCT_NAME);
  pkgFactory=new PackageFactory(ruleClassProvider);
  AnalysisTestUtil.DummyWorkspaceStatusActionFactory workspaceStatusActionFactory=new AnalysisTestUtil.DummyWorkspaceStatusActionFactory(directories);
  AnalysisMock analysisMock=getAnalysisMock();
  skyframeExecutor=SequencedSkyframeExecutor.create(pkgFactory,directories,BinTools.forUnitTesting(directories,TestConstants.EMBEDDED_TOOLS),workspaceStatusActionFactory,ruleClassProvider.getBuildInfoFactories(),ImmutableList.<DiffAwareness.Factory>of(),Predicates.<PathFragment>alwaysFalse(),Preprocessor.Factory.Supplier.NullSupplier.INSTANCE,analysisMock.getSkyFunctions(),ImmutableList.<PrecomputedValue.Injected>of(),ImmutableList.<SkyValueDirtinessChecker>of(),TestConstants.PRODUCT_NAME);
  skyframeExecutor.preparePackageLoading(pkgLocator,Options.getDefaults(PackageCacheOptions.class).defaultVisibility,true,7,ruleClassProvider.getDefaultsPackageContent(TestConstants.TEST_INVOCATION_POLICY),UUID.randomUUID(),new TimestampGranularityMonitor(BlazeClock.instance()));
  analysisMock.setupMockClient(new MockToolsConfig(rootDirectory));
  analysisMock.setupMockWorkspaceFiles(directories.getEmbeddedBinariesRoot());
  configurationFactory=analysisMock.createConfigurationFactory();
  buildOptionClasses=TestRuleClassProvider.getRuleClassProvider().getOptionFragments();
}
