{
  NodeEntry entry=new NodeEntry();
  entry.addReverseDepAndCheckIfDone(null);
  SkyKey dep=key("dep");
  addTemporaryDirectDep(entry,dep);
  entry.signalDep();
  setValue(entry,new IntegerValue(5),null,0L);
  entry.markDirty(false);
  entry.addReverseDepAndCheckIfDone(null);
  assertEquals(BuildingState.DirtyState.CHECK_DEPENDENCIES,entry.getDirtyState());
  assertThat(entry.getNextDirtyDirectDeps()).containsExactly(dep).inOrder();
  addTemporaryDirectDep(entry,dep);
  assertTrue(entry.signalDep(new IntVersion(1L)));
  assertEquals(BuildingState.DirtyState.REBUILDING,entry.getDirtyState());
  assertThat(entry.getTemporaryDirectDeps()).containsExactly(dep);
  addTemporaryDirectDep(entry,key("dep2"));
  assertTrue(entry.signalDep(new IntVersion(1L)));
  setValue(entry,new IntegerValue(5),null,1L);
  assertTrue(entry.isDone());
  assertEquals("Version increments when deps change",new IntVersion(1L),entry.getVersion());
}
