{
  ImmutableList.Builder<QueryFunction> functions=ImmutableList.builder();
  for (  BlazeModule module : env.getRuntime().getBlazeModules()) {
    functions.addAll(module.getQueryFunctions());
  }
  return env.getRuntime().getQueryEnvironmentFactory().create(env.getPackageManager().newTransitiveLoader(),env.getSkyframeExecutor(),env.getPackageManager(),env.newTargetPatternEvaluator(),keepGoing,true,orderedResults,universeScope,loadingPhaseThreads,ALL_LABELS,env.getReporter(),settings,functions.build(),env.getPackageManager().getPackagePath());
}
