{
  ResourceContainer resourceContainer=checkForInlinedResources(new AndroidResourceContainerBuilder().withData(data).withManifest(getManifest()).withROutput(rTxt).withSymbolsFile(symbolsTxt).buildFromRule(ruleContext,resourceApk),resourceDeps.getResources(),ruleContext);
  if (ruleContext.hasErrors()) {
    return null;
  }
  AndroidResourcesProcessorBuilder builder=new AndroidResourcesProcessorBuilder(ruleContext).setLibrary(isLibrary).setApkOut(resourceContainer.getApk()).setConfigurationFilters(configurationFilters).setUncompressedExtensions(uncompressedExtensions).setCrunchPng(crunchPng).setJavaPackage(resourceContainer.getJavaPackage()).setDebug(ruleContext.getConfiguration().getCompilationMode() != CompilationMode.OPT).setManifestOut(manifestOut).setMergedResourcesOut(mergedResources).withPrimary(resourceContainer).withDependencies(resourceDeps).setDensities(densities).setProguardOut(proguardCfg).setMainDexProguardOut(mainDexProguardCfg).setApplicationId(applicationId).setVersionCode(versionCode).setVersionName(versionName);
  if (!incremental) {
    builder.setRTxtOut(resourceContainer.getRTxt()).setSymbolsTxt(resourceContainer.getSymbolsTxt()).setSourceJarOut(resourceContainer.getJavaSourceJar());
  }
  ResourceContainer processed=builder.build(ruleContext);
  return new ResourceApk(resourceApk,processed.getJavaSourceJar(),resourceDeps,processed,manifest,proguardCfg,mainDexProguardCfg,false);
}
