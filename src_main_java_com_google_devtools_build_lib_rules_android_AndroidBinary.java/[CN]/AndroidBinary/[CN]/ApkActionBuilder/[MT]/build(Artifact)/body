{
  Builder actionBuilder=tools.apkBuilderAction().setProgressMessage(message).setMnemonic("AndroidApkBuilder").addOutputArgument(outApk);
  if (javaResourceZip != null) {
    actionBuilder.addArgument("-rj").addInputArgument(javaResourceZip);
  }
  ImmutableList<Artifact> nativeSymlinks=nativeLibs.createApkBuilderSymlinks(ruleContext);
  if (!nativeSymlinks.isEmpty()) {
    actionBuilder.addInputs(nativeSymlinks).addArgument("-nf").addArgument(nativeSymlinks.get(0).getExecPath().getParentDirectory().getParentDirectory().getPathString());
  }
  if (nativeLibs.getName() != null) {
    actionBuilder.addArgument("-rf").addArgument(nativeLibs.getName().getExecPath().getParentDirectory().getPathString()).addInput(nativeLibs.getName());
  }
  if (javaResourceFile != null) {
    actionBuilder.addArgument("-rf").addArgument((javaResourceFile.getExecPath().getParentDirectory().getPathString())).addInput(javaResourceFile);
  }
  if (signingKey == null) {
    actionBuilder.addArgument("-u");
  }
 else {
    actionBuilder.addArgument("-ks").addArgument(signingKey.getExecPathString());
    actionBuilder.addInput(signingKey);
  }
  actionBuilder.addArgument("-z").addInputArgument(resourceApk);
  if (classesDex != null) {
    actionBuilder.addArgument(classesDex.getFilename().endsWith(".dex") ? "-f" : "-z").addInputArgument(classesDex);
  }
  return actionBuilder.build(ruleContext);
}
