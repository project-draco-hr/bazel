{
  JavaSemantics javaSemantics=createJavaSemantics();
  AndroidSemantics androidSemantics=createAndroidSemantics();
  if (!AndroidSdkProvider.verifyPresence(ruleContext)) {
    return null;
  }
  NestedSetBuilder<Artifact> filesBuilder=NestedSetBuilder.stableOrder();
  ImmutableList<TransitiveInfoCollection> deps=ImmutableList.<TransitiveInfoCollection>copyOf(ruleContext.getPrerequisites("deps",Mode.TARGET));
  JavaCommon javaCommon=new JavaCommon(ruleContext,javaSemantics,deps,deps,deps);
  AndroidCommon androidCommon=new AndroidCommon(javaCommon,true,true);
  try {
    ResourceDependencies resourceDeps=LocalResourceContainer.definesAndroidResources(ruleContext.attributes()) ? ResourceDependencies.fromRuleDeps(ruleContext) : ResourceDependencies.fromRuleResourceAndDeps(ruleContext);
    RuleConfiguredTargetBuilder builder=init(ruleContext,filesBuilder,resourceDeps,javaCommon,androidCommon,javaSemantics,androidSemantics,ImmutableList.<String>of("deps"));
    if (builder == null) {
      return null;
    }
    return builder.build();
  }
 catch (  RuleConfigurationException e) {
    Preconditions.checkArgument(ruleContext.hasErrors(),"Exception caught but no errors reported:\n %s",Joiner.on("\n").join(e.getStackTrace()));
    return null;
  }
}
