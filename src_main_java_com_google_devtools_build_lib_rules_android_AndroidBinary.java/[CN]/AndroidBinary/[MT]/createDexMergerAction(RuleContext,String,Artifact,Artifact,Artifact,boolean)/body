{
  checkArgument(!minimalMainDex || mainDexList != null,"expected mainDexList");
  SpawnAction.Builder dexmerger=new SpawnAction.Builder().setExecutable(ruleContext.getExecutablePrerequisite("$dexmerger",Mode.HOST)).addArgument("--input").addInputArgument(inputJar).addArgument("--output").addOutputArgument(classesDex).addArgument("--multidex=" + multidexStrategy).setMnemonic("DexMerger").setProgressMessage("Assembling dex files into " + classesDex.prettyPrint());
  if (ruleContext.getConfiguration().isCodeCoverageEnabled()) {
    dexmerger.addArgument("--nolocals");
  }
  if (mainDexList != null) {
    dexmerger.addArgument("--main-dex-list").addInputArgument(mainDexList);
    if (minimalMainDex) {
      dexmerger.addArgument("--minimal-main-dex");
    }
  }
  ruleContext.registerAction(dexmerger.build(ruleContext));
}
