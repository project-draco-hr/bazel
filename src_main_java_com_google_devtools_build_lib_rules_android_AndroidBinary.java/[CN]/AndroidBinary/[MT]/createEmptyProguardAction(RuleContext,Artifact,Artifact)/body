{
  ImmutableList.Builder<Artifact> failures=ImmutableList.<Artifact>builder().add(proguardOutputJar).add(ruleContext.getImplicitOutputArtifact(JavaSemantics.JAVA_BINARY_PROGUARD_CONFIG));
  if (ruleContext.attributes().get("proguard_generate_mapping",Type.BOOLEAN)) {
    failures.add(ruleContext.getImplicitOutputArtifact(JavaSemantics.JAVA_BINARY_PROGUARD_MAP));
  }
  JavaOptimizationMode optMode=getJavaOptimizationMode(ruleContext);
  ruleContext.registerAction(new FailAction(ruleContext.getActionOwner(),failures.build(),String.format("Can't generate Proguard jar or mapping %s.",optMode == JavaOptimizationMode.LEGACY ? "without proguard_specs" : "in optimization mode " + optMode)));
  return new ProguardOutput(deployJarArtifact,null);
}
