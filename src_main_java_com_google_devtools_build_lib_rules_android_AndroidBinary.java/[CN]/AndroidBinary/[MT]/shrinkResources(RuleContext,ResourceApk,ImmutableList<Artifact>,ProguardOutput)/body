{
  if (ruleContext.getFragment(AndroidConfiguration.class).useAndroidResourceShrinking() && LocalResourceContainer.definesAndroidResources(ruleContext.attributes()) && !proguardSpecs.isEmpty()) {
    Artifact apk=new ResourceShrinkerActionBuilder(ruleContext).setResourceApkOut(ruleContext.getImplicitOutputArtifact(AndroidRuleClasses.ANDROID_RESOURCES_SHRUNK_APK)).setShrunkResourcesOut(ruleContext.getImplicitOutputArtifact(AndroidRuleClasses.ANDROID_RESOURCES_SHRUNK_ZIP)).setLogOut(ruleContext.getImplicitOutputArtifact(AndroidRuleClasses.ANDROID_RESOURCE_SHRINKER_LOG)).withResourceFiles(ruleContext.getImplicitOutputArtifact(AndroidRuleClasses.ANDROID_RESOURCES_ZIP)).withShrunkJar(proguardOutput.getOutputJar()).withProguardMapping(proguardOutput.getMapping()).withPrimary(resourceApk.getPrimaryResource()).withDependencies(resourceApk.getResourceDependencies()).setConfigurationFilters(ruleContext.getTokenizedStringListAttr("resource_configuration_filters")).setUncompressedExtensions(ruleContext.getTokenizedStringListAttr("nocompress_extensions")).build();
    return new ResourceApk(apk,resourceApk.getResourceJavaSrcJar(),resourceApk.getResourceJavaClassJar(),resourceApk.getResourceDependencies(),resourceApk.getPrimaryResource(),resourceApk.getManifest(),resourceApk.getResourceProguardConfig(),resourceApk.getMainDexProguardConfig(),resourceApk.isLegacy());
  }
  return resourceApk;
}
