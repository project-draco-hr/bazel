{
  JavaCompilationArgs dep=ruleContext.getPrerequisite(":incremental_stub_application",Mode.TARGET).getProvider(JavaCompilationArgsProvider.class).getJavaCompilationArgs();
  JavaTargetAttributes attributes=new JavaTargetAttributes.Builder(javaSemantics).addRuntimeClassPathEntries(dep.getRuntimeJars()).build();
  Artifact stubDeployJar=getDxArtifact(ruleContext,"stub_deploy.jar");
  new DeployArchiveBuilder(javaSemantics,ruleContext).setOutputJar(stubDeployJar).setAttributes(attributes).build();
  Artifact stubDex=getDxArtifact(ruleContext,"stub_application.dex");
  AndroidCommon.createDexAction(ruleContext,androidSemantics,tools,stubDeployJar,stubDex,ImmutableList.<String>of(),false,null);
  return stubDex;
}
