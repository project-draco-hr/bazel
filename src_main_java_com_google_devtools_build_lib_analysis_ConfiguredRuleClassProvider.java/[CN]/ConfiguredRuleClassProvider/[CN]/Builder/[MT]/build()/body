{
  for (  Node<Class<? extends RuleDefinition>> ruleDefinition : dependencyGraph.getTopologicalOrder()) {
    commitRuleDefinition(ruleDefinition.getLabel());
  }
  return new ConfiguredRuleClassProvider(preludeLabel,runfilesPrefix,toolsRepository,ImmutableMap.copyOf(ruleClassMap),ImmutableMap.copyOf(ruleDefinitionMap),ImmutableMap.copyOf(aspectFactoryMap),defaultWorkspaceFile.toString(),ImmutableList.copyOf(buildInfoFactories),ImmutableList.copyOf(configurationOptions),ImmutableList.copyOf(configurationFragments),configurationCollectionFactory,universalFragment,prerequisiteValidator,skylarkAccessibleJavaClasses,buildOptions);
}
