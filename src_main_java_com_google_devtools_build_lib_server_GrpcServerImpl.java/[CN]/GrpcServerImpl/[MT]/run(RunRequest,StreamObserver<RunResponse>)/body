{
  if (!request.getCookie().equals(requestCookie)) {
    observer.onNext(RunResponse.newBuilder().setExitCode(ExitCode.LOCAL_ENVIRONMENTAL_ERROR.getNumericExitCode()).build());
    observer.onCompleted();
    return;
  }
  String commandId;
  int exitCode;
  try (RunningCommand command=new RunningCommand()){
    commandId=command.id;
    OutErr rpcOutErr=OutErr.create(new RpcOutputStream(observer,command.id,StreamType.STDOUT),new RpcOutputStream(observer,command.id,StreamType.STDERR));
    exitCode=commandExecutor.exec(request.getArgList(),rpcOutErr,clock.currentTimeMillis());
  }
   Thread.interrupted();
  RunResponse response=RunResponse.newBuilder().setCookie(responseCookie).setCommandId(commandId).setFinished(true).setExitCode(exitCode).build();
  observer.onNext(response);
  observer.onCompleted();
  if (commandExecutor.shutdown()) {
    server.shutdownNow();
  }
}
