{
  ByteString input=ByteString.copyFrom(b,off,inlen);
  RunResponse.Builder response=RunResponse.newBuilder().setCookie(responseCookie).setCommandId(commandId);
switch (type) {
case STDOUT:
    response.setStandardOutput(input);
  break;
case STDERR:
response.setStandardError(input);
break;
default :
throw new IllegalStateException();
}
if (!sink.offer(response.build())) {
log.info(String.format("Client disconnected received for command %s on thread %s",commandId,Thread.currentThread().getName()));
throw new IOException("Client disconnected");
}
}
