{
  if (alreadyHandlingCrash.compareAndSet(false,true)) {
    int exitCode=getExitCodeForThrowable(throwable);
    try {
      logCrash(throwable,args);
      if (runtime != null) {
        runtime.notifyCommandComplete(exitCode);
      }
    }
  finally {
      Runtime.getRuntime().halt(exitCode);
    }
  }
 else {
    logCrash(throwable,args);
  }
}
