{
  TestResultAnalyzer resultAnalyzer=new TestResultAnalyzer(runtime.getExecRoot(),options.getOptions(TestSummaryOptions.class),options.getOptions(ExecutionOptions.class),runtime.getEventBus());
  printer=new AnsiTerminalPrinter(runtime.getReporter().getOutErr().getOutputStream(),options.getOptions(BlazeCommandEventHandler.Options.class).useColor());
  AggregatingTestListener testListener=new AggregatingTestListener(resultAnalyzer,runtime.getEventBus(),runtime.getReporter());
  runtime.getEventBus().register(testListener);
  return doTest(runtime,options,testListener);
}
