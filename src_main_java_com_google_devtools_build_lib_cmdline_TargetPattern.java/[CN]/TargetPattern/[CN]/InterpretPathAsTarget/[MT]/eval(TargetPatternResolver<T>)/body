{
  if (resolver.isPackage(path)) {
    throw new TargetParsingException("ambiguous target pattern: '" + path + "' is "+ "the name of a package; use '"+ path+ ":all' to mean \"all "+ "rules in this package\", '"+ path+ "/...' to mean \"all rules recursively "+ "beneath this package\", or '//"+ path+ "' to mean \"the default rule in this "+ "package\"");
  }
  List<String> pieces=SLASH_SPLITTER.splitToList(path);
  for (int i=pieces.size() - 1; i > 0; i--) {
    String packageName=SLASH_JOINER.join(pieces.subList(0,i));
    if (resolver.isPackage(packageName)) {
      String targetName=SLASH_JOINER.join(pieces.subList(i,pieces.size()));
      return resolver.getExplicitTarget("//" + packageName + ":"+ targetName);
    }
  }
  throw new TargetParsingException("couldn't determine target from filename '" + path + "'");
}
