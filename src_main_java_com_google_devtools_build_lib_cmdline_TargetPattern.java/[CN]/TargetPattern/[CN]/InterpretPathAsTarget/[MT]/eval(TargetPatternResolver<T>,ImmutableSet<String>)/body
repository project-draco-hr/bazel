{
  Preconditions.checkArgument(excludedSubdirectories.isEmpty(),"Target pattern \"%s\" of type %s cannot be evaluated with excluded subdirectories: %s.",getOriginalPattern(),getType(),excludedSubdirectories);
  if (resolver.isPackage(PackageIdentifier.createInDefaultRepo(path))) {
    return resolver.getExplicitTarget("//" + path);
  }
  List<String> pieces=SLASH_SPLITTER.splitToList(path);
  for (int i=pieces.size() - 1; i > 0; i--) {
    String packageName=SLASH_JOINER.join(pieces.subList(0,i));
    if (resolver.isPackage(PackageIdentifier.createInDefaultRepo(packageName))) {
      String targetName=SLASH_JOINER.join(pieces.subList(i,pieces.size()));
      return resolver.getExplicitTarget("//" + packageName + ":"+ targetName);
    }
  }
  throw new TargetParsingException("couldn't determine target from filename '" + path + "'");
}
