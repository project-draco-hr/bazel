{
  Command annotation=command.getClass().getAnnotation(Command.class);
  List<Class<? extends OptionsBase>> allOptions=Lists.newArrayList();
  allOptions.addAll(BlazeCommandUtils.getOptions(command.getClass(),getRuntime().getBlazeModules(),getRuntime().getRuleClassProvider()));
  OptionsParser parser=OptionsParser.newOptionsParser(allOptions);
  parser.setAllowResidue(annotation.allowResidue());
  return parser;
}
