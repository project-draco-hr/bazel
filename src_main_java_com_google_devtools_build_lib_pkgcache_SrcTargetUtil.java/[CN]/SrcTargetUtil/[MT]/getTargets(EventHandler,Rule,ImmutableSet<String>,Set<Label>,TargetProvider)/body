{
  List<Label> srcLabels=Lists.newArrayList();
  RawAttributeMapper attributeMapper=RawAttributeMapper.of(rule);
  for (  String attrName : attributes) {
    if (rule.isAttrDefined(attrName,BuildType.LABEL_LIST)) {
      srcLabels.addAll(attributeMapper.getMergedValues(attrName,BuildType.LABEL_LIST));
    }
 else     if (rule.isAttrDefined(attrName,BuildType.LABEL) && !rule.isConfigurableAttribute(attrName)) {
      Label srcLabel=attributeMapper.get(attrName,BuildType.LABEL);
      if (srcLabel != null) {
        srcLabels.add(srcLabel);
      }
    }
  }
  if (srcLabels.isEmpty()) {
    return ImmutableList.of();
  }
  List<FileTarget> srcTargets=new ArrayList<>();
  for (  Label label : srcLabels) {
    Target target=targetProvider.getTarget(eventHandler,label);
    if (target instanceof FileTarget) {
      srcTargets.add((FileTarget)target);
    }
 else {
      Rule srcRule=target.getAssociatedRule();
      if (srcRule != null && !visitedRuleLabels.contains(srcRule.getLabel())) {
        visitedRuleLabels.add(srcRule.getLabel());
        if ("filegroup".equals(srcRule.getRuleClass())) {
          srcTargets.addAll(getTargets(eventHandler,srcRule,FILEGROUP_ATTRIBUTES,visitedRuleLabels,targetProvider));
        }
 else {
          srcTargets.addAll(srcRule.getOutputFiles());
        }
      }
    }
  }
  return ImmutableList.copyOf(srcTargets);
}
