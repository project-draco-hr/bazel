{
  String strategy=shardingEnvironment.getTestShardingStrategy();
  if (strategy == null) {
    return defaultShardingStrategy;
  }
  ShardingFilterFactory shardingFilterFactory;
  try {
    shardingFilterFactory=ShardingStrategy.valueOf(strategy.toUpperCase());
  }
 catch (  IllegalArgumentException e) {
    try {
      Class<?> strategyClass=Thread.currentThread().getContextClassLoader().loadClass(strategy);
      shardingFilterFactory=(ShardingFilterFactory)strategyClass.newInstance();
    }
 catch (    ClassNotFoundException|InstantiationException|IllegalAccessException|IllegalArgumentException e2) {
      throw new RuntimeException("Could not create custom sharding strategy class " + strategy,e2);
    }
  }
  return shardingFilterFactory;
}
