{
  Preconditions.checkNotNull(object);
  Preconditions.checkState(startTime > 0,"startTime was %s",startTime);
  if (duration < 0) {
    duration=0;
  }
  tasksHistograms[type.ordinal()].addStat((int)TimeUnit.NANOSECONDS.toMillis(duration),object);
  TaskData parent=taskStack.peek();
  if (parent != null) {
    parent.aggregateChild(type,duration);
  }
  if (wasTaskSlowEnoughToRecord(type,duration)) {
    TaskData data=taskStack.create(startTime,type,object);
    data.duration=duration;
    if (out != null) {
      taskQueue.add(data);
    }
    SlowestTaskAggregator aggregator=slowestTasks[type.ordinal()];
    if (aggregator != null) {
      aggregator.add(data);
    }
  }
}
