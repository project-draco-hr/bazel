{
  Stopwatch timer=preLoadingLogging(eventHandler);
  TransitivePackageLoader pkgLoader=packageManager.newTransitiveLoader();
  BaseLoadingResult baseResult=performLoadingOfTargets(eventHandler,eventBus,pkgLoader,targets.getTargets(),labelsToLoadUnconditionally,keepGoing,loadingPhaseThreads);
  ResolvedTargets<Target> expandedResult;
  try {
    expandedResult=expandTestSuites(eventHandler,baseResult.getTargets(),keepGoing);
  }
 catch (  TargetParsingException e) {
    throw (AssertionError)(new AssertionError("Unexpected target failure").initCause(e));
  }
  freeMemoryAfterLoading(callback,pkgLoader.getVisitedPackageNames());
  postLoadingLogging(eventBus,baseResult.getTargets(),expandedResult.getTargets(),timer);
  return new LoadingResult(targets.hasError(),!baseResult.isSuccesful() || expandedResult.hasError(),expandedResult.getTargets(),testsToRun,getWorkspaceName(eventHandler));
}
