{
  Multimap<Label,Label> rootCauses=pkgLoader.getRootCauses();
  for (  Map.Entry<String,Label> entry : labelsToLoadUnconditionally.entries()) {
    Label label=entry.getValue();
    if (rootCauses.containsKey(label)) {
      throw new LoadingFailedException(String.format("Failed to load required %s target: '%s'",entry.getKey(),label));
    }
  }
  for (  Map.Entry<Label,Label> entry : rootCauses.entries()) {
    eventBus.post(new LoadingFailureEvent(entry.getKey(),entry.getValue()));
  }
  LoadedPackageProvider.Bridge bridge=new LoadedPackageProvider.Bridge(packageManager,eventHandler);
  return ImmutableSet.copyOf(Sets.difference(ImmutableSet.copyOf(targetsToLoad),getTargetsForLabels(bridge,rootCauses.keySet())));
}
