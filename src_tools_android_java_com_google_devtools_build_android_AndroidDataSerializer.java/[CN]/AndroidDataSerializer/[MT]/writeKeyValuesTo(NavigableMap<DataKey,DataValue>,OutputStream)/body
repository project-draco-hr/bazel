{
  NavigableSet<DataKey> keys=map.navigableKeySet();
  int[] orderedValueSizes=new int[keys.size()];
  int valueSizeIndex=0;
  ByteArrayOutputStream valuesOutputStream=new ByteArrayOutputStream(2048);
  for (  DataKey key : keys) {
    orderedValueSizes[valueSizeIndex++]=map.get(key).serializeTo(key,valuesOutputStream);
  }
  valueSizeIndex=0;
  for (  DataKey key : keys) {
    key.serializeTo(outStream,orderedValueSizes[valueSizeIndex++]);
  }
  outStream.write(valuesOutputStream.toByteArray());
}
