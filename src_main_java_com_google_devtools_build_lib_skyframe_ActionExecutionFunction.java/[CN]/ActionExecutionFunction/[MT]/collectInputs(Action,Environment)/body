{
  Iterable<Artifact> allKnownInputs=Iterables.concat(action.getInputs(),action.getRunfilesSupplier().getArtifacts());
  if (action.inputsKnown()) {
    return new AllInputs(allKnownInputs);
  }
  Preconditions.checkState(action.discoversInputs(),action);
  PackageRootResolverWithEnvironment resolver=new PackageRootResolverWithEnvironment(env);
  Iterable<Artifact> actionCacheInputs=skyframeActionExecutor.getActionCachedInputs(action,resolver);
  if (actionCacheInputs == null) {
    Preconditions.checkState(env.valuesMissing(),action);
    return null;
  }
  return new AllInputs(allKnownInputs,actionCacheInputs,resolver.keysRequested);
}
