{
  ObjcCommon.Builder commonBuilder=new ObjcCommon.Builder(ruleContext).setIntermediateArtifacts(intermediateArtifacts).setHasModuleMap().setCompilationArtifacts(compilationArtifacts);
  if (isLinkingTarget()) {
    commonBuilder.addUserHeaderSearchPaths(getProtobufHeaderSearchPaths());
  }
 else {
    commonBuilder.addDepObjcProviders(ruleContext.getPrerequisites(ObjcRuleClasses.PROTO_LIB_ATTR,Mode.TARGET,ObjcProvider.class));
  }
  return commonBuilder.build();
}
