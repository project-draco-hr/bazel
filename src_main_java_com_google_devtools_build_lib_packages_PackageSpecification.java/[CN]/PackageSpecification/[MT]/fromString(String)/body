{
  String result=spec;
  boolean allBeneath=false;
  if (result.startsWith("//")) {
    result=spec.substring(2);
  }
 else {
    throw new InvalidPackageSpecificationException("invalid package label: " + spec);
  }
  if (result.indexOf(':') >= 0) {
    throw new InvalidPackageSpecificationException("invalid package label: " + spec);
  }
  if (result.equals("...")) {
    return EVERYTHING;
  }
  if (result.endsWith(ALL_BENEATH_SUFFIX)) {
    allBeneath=true;
    result=result.substring(0,result.length() - ALL_BENEATH_SUFFIX.length());
  }
  String errorMessage=LabelValidator.validatePackageName(result);
  if (errorMessage == null) {
    return allBeneath ? new AllPackagesBeneath(new PathFragment(result)) : new SinglePackage(new PathFragment(result));
  }
 else {
    throw new InvalidPackageSpecificationException(errorMessage);
  }
}
