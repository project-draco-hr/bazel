{
  J2ObjcSrcsProvider provider=ObjcRuleClasses.j2ObjcSrcsProvider(ruleContext);
  Iterable<J2ObjcSource> j2ObjcSources=provider.getSrcs();
  J2ObjcConfiguration j2objcConfiguration=ruleContext.getFragment(J2ObjcConfiguration.class);
  boolean stripJ2ObjcDeadCode=j2objcConfiguration.removeDeadCode() && !provider.getEntryClasses().isEmpty();
  if (stripJ2ObjcDeadCode) {
    registerJ2ObjcDeadCodeRemovalActions(j2ObjcSources,provider.getEntryClasses());
  }
  for (  J2ObjcSource j2ObjcSource : j2ObjcSources) {
    J2ObjcSource sourceToCompile=j2ObjcSource.getSourceType() == SourceType.JAVA && stripJ2ObjcDeadCode ? j2ObjcSource.toPrunedSource(ruleContext) : j2ObjcSource;
    IntermediateArtifacts intermediateArtifacts=ObjcRuleClasses.j2objcIntermediateArtifacts(ruleContext,sourceToCompile);
    CompilationArtifacts compilationArtifact=new CompilationArtifacts.Builder().addNonArcSrcs(sourceToCompile.getObjcSrcs()).setIntermediateArtifacts(intermediateArtifacts).setPchFile(Optional.<Artifact>absent()).build();
    registerCompileAndArchiveActions(compilationArtifact,intermediateArtifacts,objcProvider,optionsProvider,ruleContext.getConfiguration().isCodeCoverageEnabled());
  }
  return this;
}
