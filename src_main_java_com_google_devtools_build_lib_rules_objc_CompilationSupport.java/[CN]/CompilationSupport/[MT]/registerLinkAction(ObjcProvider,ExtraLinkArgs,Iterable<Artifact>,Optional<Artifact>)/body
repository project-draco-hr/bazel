{
  ObjcConfiguration objcConfiguration=ObjcRuleClasses.objcConfiguration(ruleContext);
  IntermediateArtifacts intermediateArtifacts=ObjcRuleClasses.intermediateArtifacts(ruleContext);
  Artifact binaryToLink=objcConfiguration.shouldStripBinary() ? intermediateArtifacts.unstrippedSingleArchitectureBinary() : intermediateArtifacts.strippedSingleArchitectureBinary();
  ImmutableList<Artifact> ccLibraries=ccLibraries(objcProvider);
  ruleContext.registerAction(ObjcRuleClasses.spawnOnDarwinActionBuilder(ruleContext).setMnemonic("ObjcLink").setShellCommand(ImmutableList.of("/bin/bash","-c")).setCommandLine(linkCommandLine(extraLinkArgs,objcProvider,binaryToLink,dsymBundle,ccLibraries)).addOutput(binaryToLink).addOutputs(dsymBundle.asSet()).addTransitiveInputs(objcProvider.get(LIBRARY)).addTransitiveInputs(objcProvider.get(IMPORTED_LIBRARY)).addTransitiveInputs(objcProvider.get(FRAMEWORK_FILE)).addInputs(ccLibraries).addInputs(extraLinkInputs).build(ruleContext));
  if (objcConfiguration.shouldStripBinary()) {
    boolean isTestTarget=TargetUtils.isTestRule(ruleContext.getRule());
    Iterable<String> stripArgs=isTestTarget ? ImmutableList.of("-S") : ImmutableList.<String>of();
    Artifact strippedBinary=intermediateArtifacts.strippedSingleArchitectureBinary();
    ruleContext.registerAction(ObjcRuleClasses.spawnOnDarwinActionBuilder(ruleContext).setMnemonic("ObjcBinarySymbolStrip").setExecutable(STRIP).setCommandLine(symbolStripCommandLine(stripArgs,binaryToLink,strippedBinary)).addOutput(strippedBinary).addInput(binaryToLink).build(ruleContext));
  }
}
