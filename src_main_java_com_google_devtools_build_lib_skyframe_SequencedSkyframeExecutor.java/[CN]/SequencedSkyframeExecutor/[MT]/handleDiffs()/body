{
  if (lastAnalysisDiscarded) {
    dropConfiguredTargetsNow();
    lastAnalysisDiscarded=false;
  }
  modifiedFiles=0;
  Map<Path,DiffAwarenessManager.ProcessableModifiedFileSet> modifiedFilesByPathEntry=Maps.newHashMap();
  Set<Pair<Path,DiffAwarenessManager.ProcessableModifiedFileSet>> pathEntriesWithoutDiffInformation=Sets.newHashSet();
  for (  Path pathEntry : pkgLocator.get().getPathEntries()) {
    DiffAwarenessManager.ProcessableModifiedFileSet modifiedFileSet=diffAwarenessManager.getDiff(pathEntry);
    if (modifiedFileSet.getModifiedFileSet().treatEverythingAsModified()) {
      LOG.info("DiffAwareness treating all sources as modified for " + pathEntry);
      pathEntriesWithoutDiffInformation.add(Pair.of(pathEntry,modifiedFileSet));
    }
 else {
      LOG.info(diffInfoLogString(pathEntry,modifiedFileSet.getModifiedFileSet().modifiedSourceFiles()));
      modifiedFilesByPathEntry.put(pathEntry,modifiedFileSet);
    }
  }
  handleDiffsWithCompleteDiffInformation(modifiedFilesByPathEntry);
  handleDiffsWithMissingDiffInformation(pathEntriesWithoutDiffInformation);
}
