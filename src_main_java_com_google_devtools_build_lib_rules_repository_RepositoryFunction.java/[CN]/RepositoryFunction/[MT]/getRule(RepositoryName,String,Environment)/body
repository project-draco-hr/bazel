{
  Package externalPackage=getExternalPackage(env);
  if (externalPackage == null) {
    return null;
  }
  Rule rule=externalPackage.getRule(repositoryName.strippedName());
  if (rule == null) {
    throw new RepositoryFunctionException(new BuildFileContainsErrorsException(Package.EXTERNAL_PACKAGE_IDENTIFIER,"The repository named '" + repositoryName + "' could not be resolved"),Transience.PERSISTENT);
  }
  Preconditions.checkState(ruleClassName == null || rule.getRuleClass().equals(ruleClassName),"Got %s, was expecting a %s",rule,ruleClassName);
  return rule;
}
