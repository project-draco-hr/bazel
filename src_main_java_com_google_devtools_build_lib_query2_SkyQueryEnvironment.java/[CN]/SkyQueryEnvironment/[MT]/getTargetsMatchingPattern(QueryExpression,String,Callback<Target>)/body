{
  Set<Target> targets=new LinkedHashSet<>(resolvedTargetPatterns.get(pattern));
  Iterator<Target> targetIterator=targets.iterator();
  while (targetIterator.hasNext()) {
    Target target=targetIterator.next();
    if (!validateScope(target.getLabel(),strictScope)) {
      targetIterator.remove();
    }
  }
  try {
    callback.process(targets);
  }
 catch (  InterruptedException e) {
    throw new QueryException(owner,e.getMessage());
  }
}
