{
  EvaluationResult<SkyValue> result;
  try (AutoProfiler p=AutoProfiler.logged("evaluation and walkable graph",LOG)){
    result=graphFactory.prepareAndGet(universeScope,parserPrefix,loadingPhaseThreads,eventHandler);
  }
   graph=result.getWalkableGraph();
  blacklistPatterns=Preconditions.checkNotNull((BlacklistedPackagePrefixesValue)graph.getValue(BlacklistedPackagePrefixesValue.key())).getPatterns();
  SkyKey universeKey=graphFactory.getUniverseKey(universeScope,parserPrefix);
  universeTargetPatternKeys=PrepareDepsOfPatternsFunction.getTargetPatternKeys(PrepareDepsOfPatternsFunction.getSkyKeys(universeKey,eventHandler));
  Collection<SkyValue> values=result.values();
  if (!values.isEmpty()) {
    Preconditions.checkState(values.size() == 1,"Universe query \"%s\" returned multiple" + " values unexpectedly (%s values in result)",universeScope,values.size());
    Preconditions.checkNotNull(result.get(universeKey),result);
  }
 else {
    boolean foundCycle=!Iterables.isEmpty(result.getError().getCycleInfo());
    Preconditions.checkState(foundCycle,"Universe query \"%s\" failed with non-cycle error: %s",universeScope,result.getError());
  }
}
