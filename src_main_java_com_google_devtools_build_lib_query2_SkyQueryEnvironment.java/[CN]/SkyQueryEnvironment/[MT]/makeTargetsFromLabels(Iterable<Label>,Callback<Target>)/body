{
  Multimap<SkyKey,Label> packageKeyToLabelMap=ArrayListMultimap.create();
  for (  Label label : labels) {
    try {
      packageKeyToLabelMap.put(getPackageKeyAndValidateLabel(label),label);
    }
 catch (    QueryException e) {
    }
  }
  Uniquifier<Target> uniquifier=createUniquifier();
  for (  List<SkyKey> packageKeys : Iterables.partition(packageKeyToLabelMap.keySet(),BATCH_CALLBACK_SIZE)) {
    Map<SkyKey,SkyValue> packageMap=graph.getSuccessfulValues(packageKeys);
    List<Target> targets=new ArrayList<>(packageMap.size());
    for (    Map.Entry<SkyKey,SkyValue> entry : packageMap.entrySet()) {
      for (      Label label : packageKeyToLabelMap.get(entry.getKey())) {
        try {
          targets.add(((PackageValue)entry.getValue()).getPackage().getTarget(label.getName()));
        }
 catch (        NoSuchTargetException e) {
        }
      }
    }
    callback.process(uniquifier.unique(targets));
  }
}
