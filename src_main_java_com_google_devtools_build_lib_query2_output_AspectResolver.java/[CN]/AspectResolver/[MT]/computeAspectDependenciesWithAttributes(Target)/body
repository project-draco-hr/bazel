{
  Map<Attribute,Collection<Label>> aspectDependencies=new LinkedHashMap<>();
  if (target instanceof Rule) {
    Multimap<Attribute,Label> transitions=((Rule)target).getTransitions(Rule.NO_NODEP_ATTRIBUTES);
    for (    Entry<Attribute,Label> entry : transitions.entries()) {
      Target toTarget;
      try {
        toTarget=packageProvider.getTarget(eventHandler,entry.getValue());
        Map<Attribute,Collection<Label>> deps=Multimaps.asMap(AspectDefinition.visitAspectsIfRequired(target,entry.getKey(),toTarget));
        aspectDependencies.putAll(deps);
      }
 catch (      NoSuchThingException e) {
      }
    }
  }
  return aspectDependencies;
}
