{
  InstrumentedFilesCollector instrumentedFilesCollector=new InstrumentedFilesCollector(ruleContext,semantics.getCoverageInstrumentationSpec(),JAVA_METADATA_COLLECTOR,filesToBuild);
  builder.add(InstrumentedFilesProvider.class,new InstrumentedFilesProviderImpl(instrumentedFilesCollector)).add(FilesToCompileProvider.class,new FilesToCompileProvider(getFilesToCompile(classJar))).add(JavaExportsProvider.class,new JavaExportsProvider(collectTransitiveExports()));
  if (!TargetUtils.isTestRule(ruleContext.getTarget())) {
    builder.addOutputGroup(TopLevelArtifactProvider.BASELINE_COVERAGE,BaselineCoverageAction.getBaselineCoverageArtifacts(ruleContext,instrumentedFilesCollector.getInstrumentedFiles()));
  }
}
