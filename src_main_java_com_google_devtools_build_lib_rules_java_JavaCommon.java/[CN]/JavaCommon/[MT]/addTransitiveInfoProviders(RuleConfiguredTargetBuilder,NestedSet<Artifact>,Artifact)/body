{
  InstrumentedFilesCollector instrumentedFilesCollector=new InstrumentedFilesCollector(ruleContext,semantics.getCoverageInstrumentationSpec(),JAVA_METADATA_COLLECTOR,filesToBuild);
  builder.add(InstrumentedFilesProvider.class,new InstrumentedFilesProviderImpl(instrumentedFilesCollector)).add(JavaExportsProvider.class,new JavaExportsProvider(collectTransitiveExports())).addOutputGroup(OutputGroupProvider.FILES_TO_COMPILE,getFilesToCompile(classJar));
  if (!TargetUtils.isTestRule(ruleContext.getTarget())) {
    builder.addOutputGroup(OutputGroupProvider.BASELINE_COVERAGE,BaselineCoverageAction.getBaselineCoverageArtifacts(ruleContext,instrumentedFilesCollector.getInstrumentedFiles()));
  }
}
