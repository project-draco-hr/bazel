{
  Map<String,String> vars=getDefaultTestEnvironment(action);
  BuildConfiguration config=action.getConfiguration();
  vars.putAll(config.getLocalShellEnvironment());
  vars.putAll(action.getTestEnv());
  vars.put("TEST_SRCDIR",runfilesDir.relativeTo(execRoot).getPathString());
  vars.put("TEST_TMPDIR",tmpDir.relativeTo(execRoot).getPathString());
  vars.put("TEST_WORKSPACE",action.getRunfilesPrefix());
  vars.put("XML_OUTPUT_FILE",xmlOutputPath.relativeTo(execRoot).getPathString());
  if (!action.isEnableRunfiles()) {
    vars.put("RUNFILES_MANIFEST_ONLY","1");
  }
  return vars;
}
