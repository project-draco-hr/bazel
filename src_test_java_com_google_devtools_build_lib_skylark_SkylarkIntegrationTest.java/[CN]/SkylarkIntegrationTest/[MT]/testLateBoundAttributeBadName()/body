{
  scratch.file("test/skylark/extension.bzl","def custom_rule_impl(ctx):","  return None","","def attr_value(attr_map, cfg):","  return attr_map.bad_attr","","custom_rule = rule(implementation = custom_rule_impl,","  attrs = {'attr1': attr.label(default=attr_value)})");
  scratch.file("test/skylark/BUILD","load('/test/skylark/extension', 'custom_rule')","","custom_rule(name = 'cr', attr1 = '//test/skylark:file')");
  reporter.removeHandler(failFastHandler);
  try {
    getTarget("//test/skylark:cr");
    fail();
  }
 catch (  Exception e) {
    assertContainsEvent("When an attribute value is a function, the attribute must be private (start with '_')");
  }
}
