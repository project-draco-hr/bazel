{
  scratch.file("test/skylark/extension.bzl","fail('my error')","a = 'my_target'");
  scratch.file("test/skylark/BUILD","load('extension', 'a')","cc_library(name = a)");
  reporter.removeHandler(failFastHandler);
  try {
    getTarget("//test/skylark:my_target");
    fail();
  }
 catch (  BuildFileContainsErrorsException e) {
    assertThat(e.getMessage()).contains("Extension file 'test/skylark/extension.bzl' has errors");
  }
  assertContainsEvent("my error");
}
