{
  scratch.file("test/skylark/extension.bzl","def custom_rule_impl(ctx):","  return struct(custom_provider = 'a')","","custom_rule = rule(implementation = custom_rule_impl)","genrule = custom_rule");
  scratch.file("test/skylark/BUILD","load('/test/skylark/extension', 'genrule')","","genrule(name = 'cr')");
  ConfiguredTarget target=getConfiguredTarget("//test/skylark:cr");
  assertEquals("a",target.get("custom_provider"));
}
