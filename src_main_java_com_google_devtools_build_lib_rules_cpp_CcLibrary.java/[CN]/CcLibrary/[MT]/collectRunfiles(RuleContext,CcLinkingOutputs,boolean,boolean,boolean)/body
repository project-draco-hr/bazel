{
  Runfiles.Builder builder=new Runfiles.Builder();
  builder.addArtifacts(ccLinkingOutputs.getLibrariesForRunfiles(linkingStatically && !neverLink));
  builder.add(context,CppRunfilesProvider.runfilesFunction(linkingStatically));
  if (context.getRule().isAttrDefined("implements",Type.LABEL_LIST)) {
    builder.addTargets(context.getPrerequisites("implements",Mode.TARGET),RunfilesProvider.DEFAULT_RUNFILES);
    builder.addTargets(context.getPrerequisites("implements",Mode.TARGET),CppRunfilesProvider.runfilesFunction(linkingStatically));
  }
  if (context.getRule().isAttrDefined("implementation",Type.LABEL_LIST)) {
    builder.addTargets(context.getPrerequisites("implementation",Mode.TARGET),RunfilesProvider.DEFAULT_RUNFILES);
    builder.addTargets(context.getPrerequisites("implementation",Mode.TARGET),CppRunfilesProvider.runfilesFunction(linkingStatically));
  }
  builder.addDataDeps(context);
  if (addDynamicRuntimeInputArtifactsToRunfiles) {
    builder.addTransitiveArtifacts(CppHelper.getToolchain(context).getDynamicRuntimeLinkInputs());
  }
  return builder.build();
}
