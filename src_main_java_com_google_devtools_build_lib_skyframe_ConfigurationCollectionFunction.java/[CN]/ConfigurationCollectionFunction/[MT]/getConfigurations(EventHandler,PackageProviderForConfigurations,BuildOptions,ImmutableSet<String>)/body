{
  Cache<String,BuildConfiguration> cache=CacheBuilder.newBuilder().<String,BuildConfiguration>build();
  List<BuildConfiguration> targetConfigurations=new ArrayList<>();
  if (!multiCpu.isEmpty()) {
    for (    String cpu : multiCpu) {
      BuildConfiguration targetConfiguration=createConfiguration(cache,eventHandler,loadedPackageProvider,buildOptions,cpu);
      if (targetConfiguration == null || targetConfigurations.contains(targetConfiguration)) {
        continue;
      }
      targetConfigurations.add(targetConfiguration);
    }
    if (loadedPackageProvider.valuesMissing()) {
      return null;
    }
  }
 else {
    BuildConfiguration targetConfiguration=createConfiguration(cache,eventHandler,loadedPackageProvider,buildOptions,null);
    if (targetConfiguration == null) {
      return null;
    }
    targetConfigurations.add(targetConfiguration);
  }
  BuildConfiguration hostConfiguration=targetConfigurations.get(0).getConfiguration(ConfigurationTransition.HOST);
  for (  BuildConfiguration targetConfig : targetConfigurations.subList(1,targetConfigurations.size())) {
    Verify.verify(targetConfig.getConfiguration(ConfigurationTransition.HOST).equals(hostConfiguration));
  }
  return new BuildConfigurationCollection(targetConfigurations,hostConfiguration);
}
