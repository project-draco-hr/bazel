{
  TestTargetExecutionSettings execSettings=testAction.getExecutionSettings();
  if (!execSettings.getManifest().equals(execSettings.getInputManifest())) {
    return execSettings.getManifest().getPath().getParentDirectory();
  }
  Path program=execSettings.getExecutable().getPath();
  Path runfilesDir=program.getParentDirectory().getChild(program.getBaseName() + ".runfiles");
  long startTime=Profiler.nanoTimeMaybe();
synchronized (execSettings.getManifest()) {
    Profiler.instance().logSimpleTask(startTime,ProfilerTask.WAIT,testAction);
    updateLocalRunfilesDirectory(testAction,runfilesDir,actionExecutionContext,binTools);
  }
  return runfilesDir;
}
