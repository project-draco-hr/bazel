{
  RepositoryName repositoryName=(RepositoryName)skyKey.argument();
  Rule rule=getRule(repositoryName,AndroidSdkRepositoryRule.NAME,env);
  if (rule == null) {
    return null;
  }
  FileValue directoryValue=prepareLocalRepositorySymlinkTree(rule,env);
  if (directoryValue == null) {
    return null;
  }
  PathFragment pathFragment=getTargetPath(rule);
  if (!symlinkLocalRepositoryContents(directoryValue,getOutputBase().getFileSystem().getPath(pathFragment),env)) {
    return null;
  }
  AttributeMap attributes=NonconfigurableAttributeMapper.of(rule);
  String buildToolsVersion=attributes.get("build_tools_version",Type.STRING);
  Integer apiLevel=attributes.get("api_level",Type.INTEGER);
  String template;
  try {
    template=ResourceFileLoader.loadResource(AndroidSdkRepositoryFunction.class,"android_sdk_repository_template.txt");
  }
 catch (  IOException e) {
    throw new IllegalStateException(e);
  }
  String buildFile=template.replaceAll("%build_tools_version%",buildToolsVersion).replaceAll("%api_level%",apiLevel.toString());
  return writeBuildFile(directoryValue,buildFile);
}
