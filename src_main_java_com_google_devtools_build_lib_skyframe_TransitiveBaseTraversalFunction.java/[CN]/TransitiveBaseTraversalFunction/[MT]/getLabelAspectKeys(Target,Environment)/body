{
  List<SkyKey> depKeys=Lists.newArrayList();
  if (target instanceof Rule) {
    Multimap<Attribute,Label> transitions=((Rule)target).getTransitions(Rule.NO_NODEP_ATTRIBUTES);
    for (    Entry<Attribute,Label> entry : transitions.entries()) {
      SkyKey packageKey=PackageValue.key(entry.getValue().getPackageIdentifier());
      try {
        PackageValue pkgValue=(PackageValue)env.getValueOrThrow(packageKey,NoSuchThingException.class);
        if (pkgValue == null) {
          continue;
        }
        Collection<Label> labels=AspectDefinition.visitAspectsIfRequired(target,entry.getKey(),pkgValue.getPackage().getTarget(entry.getValue().getName())).values();
        for (        Label label : labels) {
          depKeys.add(getKey(label));
        }
      }
 catch (      NoSuchThingException e) {
      }
    }
  }
  return depKeys;
}
