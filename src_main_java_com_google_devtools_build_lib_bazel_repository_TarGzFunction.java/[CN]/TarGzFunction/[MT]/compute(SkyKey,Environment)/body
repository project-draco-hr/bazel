{
  DecompressorDescriptor descriptor=(DecompressorDescriptor)skyKey.argument();
  try (GZIPInputStream gzipStream=new GZIPInputStream(new FileInputStream(descriptor.archivePath().getPathFile()))){
    TarArchiveInputStream tarStream=new TarArchiveInputStream(gzipStream);
    TarArchiveEntry entry;
    while ((entry=tarStream.getNextTarEntry()) != null) {
      Path filename=descriptor.repositoryPath().getRelative(entry.getName());
      FileSystemUtils.createDirectoryAndParents(filename.getParentDirectory());
      if (entry.isDirectory()) {
        FileSystemUtils.createDirectoryAndParents(filename);
      }
 else {
        if (entry.isSymbolicLink()) {
          PathFragment linkName=new PathFragment(entry.getLinkName());
          if (linkName.isAbsolute()) {
            linkName=linkName.relativeTo(PathFragment.ROOT_DIR);
            linkName=descriptor.repositoryPath().getRelative(linkName).asFragment();
          }
          FileSystemUtils.ensureSymbolicLink(filename,linkName);
        }
 else {
          Files.copy(tarStream,filename.getPathFile().toPath(),StandardCopyOption.REPLACE_EXISTING);
          filename.chmod(entry.getMode());
        }
      }
    }
  }
 catch (  IOException e) {
    throw new RepositoryFunctionException(e,Transience.TRANSIENT);
  }
  return new DecompressorValue(descriptor.repositoryPath());
}
