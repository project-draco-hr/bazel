{
  try {
    actionCacheChecker.afterExecution(action,token,metadataHandler);
  }
 catch (  IOException e) {
    List<StackTraceElement[]> stackTraceElements=new ArrayList<>();
    for (    Artifact output : action.getOutputs()) {
      StackTraceElement[] stackTraceElement=metadataHandler.getInsertionOfMissingArtifactForDebugging(output);
      if (stackTraceElement != null) {
        stackTraceElements.add(stackTraceElement);
      }
    }
    String stackTraces="";
    if (stackTraceElements.isEmpty()) {
      stackTraces="no missing artifacts found?";
    }
 else {
      for (      StackTraceElement[] elt : stackTraceElements) {
        stackTraces+="\n" + Arrays.toString(elt);
      }
    }
    throw new IllegalStateException("failed to update action cache for " + action.prettyPrint() + ", but all outputs should already have been checked ("+ stackTraces+ ")",e);
  }
}
