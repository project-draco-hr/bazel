{
  ByteArrayOutputStream bytesOut=new ByteArrayOutputStream();
  CodedOutputStream codedOut=CodedOutputStream.newInstance(bytesOut);
  serializer.serialize(pkg,codedOut);
  codedOut.flush();
  Package deserializedPkg=deserializer.deserialize(CodedInputStream.newInstance(bytesOut.toByteArray()));
  assertEquals(pkg.getName(),deserializedPkg.getName());
  assertEquals(pkg.getPackageIdentifier(),deserializedPkg.getPackageIdentifier());
  assertEquals(pkg.getBuildFileLabel(),deserializedPkg.getBuildFileLabel());
  assertEquals(pkg.getFilename(),deserializedPkg.getFilename());
  assertEquals(pkg.toString(),deserializedPkg.toString());
  assertThat(deserializedPkg.getTargets()).hasSize(pkg.getTargets().size());
  return deserializedPkg;
}
