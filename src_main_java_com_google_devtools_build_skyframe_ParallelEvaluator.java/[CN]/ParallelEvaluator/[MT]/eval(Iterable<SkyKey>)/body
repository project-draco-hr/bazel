{
  ImmutableSet<SkyKey> skyKeySet=ImmutableSet.copyOf(skyKeys);
  boolean allAreDone=true;
  Map<SkyKey,NodeEntry> batch=graph.getBatch(skyKeySet);
  for (  SkyKey key : skyKeySet) {
    if (!isDoneForBuild(batch.get(key))) {
      allAreDone=false;
      break;
    }
  }
  if (allAreDone) {
    for (    SkyKey skyKey : skyKeySet) {
      informProgressReceiverThatValueIsDone(skyKey);
    }
    return constructResult(null,skyKeySet,null,false);
  }
  if (!keepGoing) {
    Set<SkyKey> cachedErrorKeys=new HashSet<>();
    for (    SkyKey skyKey : skyKeySet) {
      NodeEntry entry=graph.get(skyKey);
      if (entry == null) {
        continue;
      }
      if (entry.isDone() && entry.getErrorInfo() != null) {
        informProgressReceiverThatValueIsDone(skyKey);
        cachedErrorKeys.add(skyKey);
      }
    }
    if (!cachedErrorKeys.isEmpty()) {
      return constructResult(null,cachedErrorKeys,null,false);
    }
  }
  Preconditions.checkState(keepGoing || !(graph instanceof InMemoryGraph) || ((InMemoryGraph)graph).keepsEdges(),"nokeep_going evaluations are not allowed if graph edges are not kept: %s",skyKeys);
  Profiler.instance().startTask(ProfilerTask.SKYFRAME_EVAL,skyKeySet);
  try {
    ValueVisitor valueVisitor=forkJoinPool == null ? new ValueVisitor(threadCount) : new ValueVisitor(forkJoinPool);
    return eval(skyKeySet,valueVisitor);
  }
  finally {
    Profiler.instance().completeTask(ProfilerTask.SKYFRAME_EVAL);
  }
}
