{
  GroupedList<SkyKey> directDeps=entry.getTemporaryDirectDeps();
  Set<SkyKey> unvisitedDeps=Sets.newHashSetWithExpectedSize(directDeps.numElements());
  Iterables.addAll(unvisitedDeps,Iterables.concat(directDeps));
  unvisitedDeps.remove(cycleChild);
  removeIncompleteChildrenForCycle(key,entry,unvisitedDeps);
  if (!entry.isReady()) {
    entry.signalDep();
  }
  maybeMarkRebuilding(entry);
  Preconditions.checkState(entry.isReady(),"%s %s %s",key,cycleChild,entry);
  Iterator<SkyKey> it=toVisit.iterator();
  while (it.hasNext()) {
    SkyKey descendant=it.next();
    if (descendant == CHILDREN_FINISHED) {
      cycleLength--;
      if (cycleLength == 0) {
        return;
      }
      continue;
    }
    if (cycleLength == 1) {
      Preconditions.checkState(unvisitedDeps.contains(descendant),"%s %s %s %s %s",key,descendant,cycleChild,unvisitedDeps,entry);
      it.remove();
    }
  }
  throw new IllegalStateException("There were not " + cycleLength + " groups of children in "+ toVisit+ " when trying to remove children of "+ key+ " other than "+ cycleChild);
}
