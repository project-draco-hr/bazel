{
  try {
    Path cacheFilePath=execRoot.getRelative(BlazeDirectories.RELATIVE_OUTPUT_PATH).getRelative(XCRUN_CACHE_FILENAME);
    FileSystemUtils.touchFile(cacheFilePath);
    XcrunCacheManager cacheManager=new XcrunCacheManager(cacheFilePath,"");
    String sdkString=appleSdkPlatform.toLowerCase() + sdkVersion;
    String cacheResult=cacheManager.getSdkRoot(sdkString);
    if (cacheResult != null) {
      return cacheResult;
    }
 else {
      CommandResult xcrunResult=new Command(new String[]{"/usr/bin/xcrun","--sdk",sdkString,"--show-sdk-path"}).execute();
      TerminationStatus xcrunStatus=xcrunResult.getTerminationStatus();
      if (!xcrunResult.getTerminationStatus().exited()) {
        throw new UserExecException(String.format("xcrun failed.\n%s\nStderr: %s",xcrunStatus.toString(),new String(xcrunResult.getStderr(),StandardCharsets.UTF_8)));
      }
      String sdkRoot=new String(xcrunResult.getStdout(),StandardCharsets.UTF_8).trim();
      cacheManager.writeSdkRoot(sdkString,sdkRoot);
      return sdkRoot;
    }
  }
 catch (  AbnormalTerminationException e) {
    String message=String.format("%s : %s",e.getResult().getTerminationStatus(),new String(e.getResult().getStderr(),StandardCharsets.UTF_8));
    throw new UserExecException(message,e);
  }
catch (  CommandException|IOException e) {
    throw new UserExecException(e);
  }
}
