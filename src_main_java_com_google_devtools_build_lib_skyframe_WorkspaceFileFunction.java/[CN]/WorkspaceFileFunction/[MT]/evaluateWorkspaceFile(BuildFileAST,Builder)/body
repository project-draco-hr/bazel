{
  com.google.devtools.build.lib.syntax.Environment workspaceEnv=new com.google.devtools.build.lib.syntax.Environment();
  RuleFactory ruleFactory=new RuleFactory(packageFactory.getRuleClassProvider());
  for (  String ruleClass : ruleFactory.getRuleClassNames()) {
    Function ruleFunction=newRuleFunction(ruleFactory,builder,ruleClass);
    workspaceEnv.update(ruleClass,ruleFunction);
  }
  workspaceEnv.update("__embedded_dir__",this.installDir.toString());
  File jreDirectory=new File(System.getProperty("java.home"));
  workspaceEnv.update("DEFAULT_SERVER_JAVABASE",jreDirectory.getParentFile().toString());
  workspaceEnv.update(BIND,newBindFunction(builder));
  workspaceEnv.update("workspace",newWorkspaceNameFunction(builder));
  StoredEventHandler eventHandler=new StoredEventHandler();
  return buildFileAST.exec(workspaceEnv,eventHandler);
}
