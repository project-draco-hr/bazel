{
  RootedPath workspaceRoot=(RootedPath)skyKey.argument();
  if (env.getValue(FileValue.key(workspaceRoot)) == null) {
    return null;
  }
  Path repoWorkspace=workspaceRoot.getRoot().getRelative(workspaceRoot.getRelativePath());
  Builder builder=new Builder(repoWorkspace);
  List<PathFragment> workspaceFiles=packageFactory.getRuleClassProvider().getWorkspaceFiles();
  for (  PathFragment workspaceFile : workspaceFiles) {
    workspaceRoot=RootedPath.toRootedPath(installDir,workspaceFile);
    if (env.getValue(FileValue.key(workspaceRoot)) == null) {
      return null;
    }
    parseWorkspaceFile(installDir.getRelative(workspaceFile),builder);
  }
  parseWorkspaceFile(repoWorkspace,builder);
  try {
    builder.resolveBindTargets(packageFactory.getRuleClass(BIND));
  }
 catch (  NoSuchBindingException e) {
    throw new WorkspaceFileFunctionException(e);
  }
catch (  EvalException e) {
    throw new WorkspaceFileFunctionException(e);
  }
  ExternalPackage pkg=builder.build();
  return new WorkspaceFileValue(pkg.getWorkspaceName(),pkg);
}
