{
  RootedPath workspaceRoot=(RootedPath)skyKey.argument();
  FileValue workspaceFileValue=(FileValue)env.getValue(FileValue.key(workspaceRoot));
  if (workspaceFileValue == null) {
    return null;
  }
  Path repoWorkspace=workspaceRoot.getRoot().getRelative(workspaceRoot.getRelativePath());
  Builder builder=new Builder(repoWorkspace);
  parseWorkspaceFile(ParserInputSource.create(ruleClassProvider.getDefaultWorkspaceFile(),new PathFragment("DEFAULT.WORKSPACE")),builder);
  if (!workspaceFileValue.exists()) {
    return new PackageValue(builder.build());
  }
  try {
    ParserInputSource repoWorkspaceSource=ParserInputSource.create(repoWorkspace);
    parseWorkspaceFile(repoWorkspaceSource,builder);
  }
 catch (  IOException e) {
    throw new WorkspaceFileFunctionException(e,Transience.TRANSIENT);
  }
  try {
    builder.resolveBindTargets(packageFactory.getRuleClass(BIND));
  }
 catch (  NoSuchBindingException e) {
    throw new WorkspaceFileFunctionException(new EvalException(e.getLocation(),e.getMessage()));
  }
catch (  EvalException e) {
    throw new WorkspaceFileFunctionException(e);
  }
  return new PackageValue(builder.build());
}
