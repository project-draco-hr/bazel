{
  try (PrintStream out=new PrintStream(new BufferedOutputStream(htmlFile.getOutputStream()))){
    ChartCreator chartCreator;
    PhaseHtml phaseHtml=new PhaseHtml(out,phaseSummaryStats,statistics,vfsStatsLimit);
    Optional<SkylarkHtml> skylarkStats;
    if (detailed) {
      skylarkStats=Optional.of(new SkylarkHtml(out,new SkylarkStatistics(info)));
      chartCreator=new DetailedChartCreator(info);
    }
 else {
      chartCreator=new AggregatingChartCreator(info);
      skylarkStats=Optional.absent();
    }
    Chart chart=chartCreator.create();
    new HtmlCreator(out,info.comment,chart,skylarkStats,htmlPixelsPerSecond,phaseHtml).print();
  }
 }
