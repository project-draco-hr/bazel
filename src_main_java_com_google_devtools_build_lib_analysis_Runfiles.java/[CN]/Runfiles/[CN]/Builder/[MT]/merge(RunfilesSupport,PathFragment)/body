{
  if (runfilesSupport == null) {
    return this;
  }
  addArtifact(runfilesSupport.getRunfilesMiddleman());
  Runfiles runfiles=runfilesSupport.getRunfiles();
  if (omittedAdditionalSymlink == null) {
    merge(runfiles);
  }
 else {
    artifactsBuilder.addTransitive(runfiles.getUnconditionalArtifacts());
    symlinksBuilder.addAll(Maps.filterKeys(entriesToMap(runfiles.getSymlinks()),Predicates.not(Predicates.equalTo(omittedAdditionalSymlink))).entrySet());
    rootSymlinksBuilder.addTransitive(runfiles.getRootSymlinks());
    pruningManifestsBuilder.addTransitive(runfiles.getPruningManifests());
    if (manifestExpander == DUMMY_SYMLINK_EXPANDER) {
      manifestExpander=runfiles.getSymlinkExpander();
    }
 else {
      Function<Map<PathFragment,Artifact>,Map<PathFragment,Artifact>> otherExpander=runfiles.getSymlinkExpander();
      Preconditions.checkState((otherExpander == DUMMY_SYMLINK_EXPANDER) || manifestExpander.equals(otherExpander));
    }
  }
  return this;
}
