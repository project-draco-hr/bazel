{
  checker.check(map,runfilesPath,artifact);
  PathFragment path=runfilesPath.getPath();
  if (path.startsWith(workspaceName)) {
    sawWorkspaceName=true;
  }
  if (runfilesPath.isExternal() && legacyRunfilesStructure) {
    map.put(workspaceName.getRelative(Label.EXTERNAL_PACKAGE_NAME).getRelative(path),artifact);
  }
  map.put(path,artifact);
  return this;
}
