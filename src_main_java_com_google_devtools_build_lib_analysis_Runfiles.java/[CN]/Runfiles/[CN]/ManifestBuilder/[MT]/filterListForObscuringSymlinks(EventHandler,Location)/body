{
  Map<PathFragment,Artifact> newManifest=new HashMap<>();
  outer:   for (  Entry<PathFragment,Artifact> entry : map.entrySet()) {
    PathFragment source=entry.getKey();
    Artifact symlink=entry.getValue();
    int n=source.segmentCount();
    for (int j=1; j < n; ++j) {
      PathFragment prefix=source.subFragment(0,n - j);
      Artifact ancestor=map.get(prefix);
      if (ancestor != null) {
        if (eventHandler == null) {
          continue outer;
        }
        PathFragment suffixPath=source.subFragment(n - j,n);
        Path viaAncestor=ancestor.getPath().getRelative(suffixPath);
        Path expected=symlink.getPath();
        if (!viaAncestor.equals(expected)) {
          eventHandler.handle(Event.warn(location,"runfiles symlink " + source + " -> "+ expected+ " obscured by "+ prefix+ " -> "+ ancestor.getPath()));
        }
        continue outer;
      }
    }
    newManifest.put(entry.getKey(),entry.getValue());
  }
  map=newManifest;
  return this;
}
