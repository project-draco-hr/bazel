{
  Optional<SkyValue> newValueMaybe=maybeCreateNewValue(key,tsgm);
  if (newValueMaybe == null) {
    return null;
  }
  if (!newValueMaybe.isPresent()) {
    return DirtyResult.dirty(oldValue);
  }
  SkyValue newValue=Preconditions.checkNotNull(newValueMaybe.get(),key);
  return newValue.equals(oldValue) ? DirtyResult.notDirty(oldValue) : DirtyResult.dirtyWithNewValue(oldValue,newValue);
}
