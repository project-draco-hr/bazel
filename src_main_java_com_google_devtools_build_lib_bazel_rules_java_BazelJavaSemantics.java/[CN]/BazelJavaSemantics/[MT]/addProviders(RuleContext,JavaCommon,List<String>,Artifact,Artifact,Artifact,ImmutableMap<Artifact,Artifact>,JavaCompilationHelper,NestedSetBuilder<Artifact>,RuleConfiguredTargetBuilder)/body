{
  if (!isJavaBinaryOrJavaTest(ruleContext)) {
    Artifact outputDepsProto=helper.getOutputDepsProtoArtifact();
    if (outputDepsProto != null && helper.getStrictJavaDeps() != StrictDepsMode.OFF) {
      ImmutableList<Dependency> strictDependencies=javaCommon.computeStrictDepsFromJavaAttributes(helper.getAttributes());
      ruleBuilder.add(DirectDependencyProvider.class,new DirectDependencyProvider(strictDependencies));
    }
  }
 else {
    boolean createExec=ruleContext.attributes().get("create_executable",Type.BOOLEAN);
    ruleBuilder.add(JavaPrimaryClassProvider.class,new JavaPrimaryClassProvider(createExec ? getMainClassInternal(ruleContext) : null));
  }
}
