{
  final Artifact pbxproj=ruleContext.getImplicitOutputArtifact(XcodeSupport.PBXPROJ);
  final ObjcConfiguration objcConfiguration=ObjcRuleClasses.objcConfiguration(ruleContext);
  final AppleConfiguration appleConfiguration=ruleContext.getFragment(AppleConfiguration.class);
  return new ByteSource(){
    @Override public InputStream openStream(){
      XcodeGenProtos.Control.Builder builder=XcodeGenProtos.Control.newBuilder();
      String workspaceRoot=objcConfiguration.getXcodeWorkspaceRoot();
      if (workspaceRoot != null) {
        builder.setWorkspaceRoot(workspaceRoot);
      }
      List<String> multiCpus=appleConfiguration.getIosMultiCpus();
      if (multiCpus.isEmpty()) {
        builder.addCpuArchitecture(appleConfiguration.getIosCpu());
      }
 else {
        builder.addAllCpuArchitecture(multiCpus);
      }
      return builder.setPbxproj(pbxproj.getExecPathString()).addAllTarget(project.targets()).addBuildSetting(XcodeGenProtos.XcodeprojBuildSetting.newBuilder().setName("IPHONEOS_DEPLOYMENT_TARGET").setValue(objcConfiguration.getMinimumOs()).build()).addBuildSetting(XcodeGenProtos.XcodeprojBuildSetting.newBuilder().setName("DEBUG_INFORMATION_FORMAT").setValue(objcConfiguration.generateDebugSymbols() ? "dwarf-with-dsym" : "dwarf").build()).build().toByteString().newInput();
    }
  }
;
}
