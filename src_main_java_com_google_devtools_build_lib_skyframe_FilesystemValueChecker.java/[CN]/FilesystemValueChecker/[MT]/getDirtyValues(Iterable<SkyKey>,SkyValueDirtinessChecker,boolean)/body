{
  ExecutorService executor=Executors.newFixedThreadPool(DIRTINESS_CHECK_THREADS,new ThreadFactoryBuilder().setNameFormat("FileSystem Value Invalidator %d").build());
  final BatchDirtyResult batchResult=new BatchDirtyResult();
  ThrowableRecordingRunnableWrapper wrapper=new ThrowableRecordingRunnableWrapper("FilesystemValueChecker#getDirtyValues");
  for (  final SkyKey key : values) {
    final SkyValue value=valuesSupplier.get().get(key);
    executor.execute(wrapper.wrap(new Runnable(){
      @Override public void run(){
        if (value != null || checkMissingValues) {
          DirtyResult result=checker.maybeCheck(key,value,tsgm);
          if (result != null && result.isDirty()) {
            batchResult.add(key,value,result.getNewValue());
          }
        }
      }
    }
));
  }
  boolean interrupted=ExecutorUtil.interruptibleShutdown(executor);
  Throwables.propagateIfPossible(wrapper.getFirstThrownError());
  if (interrupted) {
    throw new InterruptedException();
  }
  return batchResult;
}
