{
  if (dep == null) {
    return ImmutableList.of();
  }
  MiddlemanFactory factory=env.getMiddlemanFactory();
  Iterable<Artifact> artifacts=dep.getProvider(FileProvider.class).getFilesToBuild();
  if (useSolibSymlinks) {
    List<Artifact> symlinkedArtifacts=new ArrayList<>();
    for (    Artifact artifact : artifacts) {
      symlinkedArtifacts.add(solibArtifactMaybe(ruleContext,artifact,isCppRuntime,solibDirOverride,configuration));
    }
    artifacts=symlinkedArtifacts;
    purpose+="_with_solib";
  }
  return ImmutableList.of(factory.createMiddlemanAllowMultiple(env,actionOwner,ruleContext.getPackageDirectory(),purpose,artifacts,configuration.getMiddlemanDirectory(ruleContext.getRule().getRepository())));
}
