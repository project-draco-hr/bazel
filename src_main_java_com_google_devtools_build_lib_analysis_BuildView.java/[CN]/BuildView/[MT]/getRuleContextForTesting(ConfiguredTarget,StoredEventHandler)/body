{
  BuildConfiguration config=target.getConfiguration();
  CachingAnalysisEnvironment analysisEnvironment=new CachingAnalysisEnvironment(artifactFactory,new ConfiguredTargetKey(target.getLabel(),config),false,config.extendedSanityChecks(),eventHandler,null,config.isActionsEnabled(),binTools);
  RuleContext ruleContext=new RuleContext.Builder(analysisEnvironment,(Rule)target.getTarget(),config,ruleClassProvider.getPrerequisiteValidator()).setVisibility(NestedSetBuilder.<PackageSpecification>create(Order.STABLE_ORDER,PackageSpecification.EVERYTHING)).setPrerequisites(getPrerequisiteMapForTesting(target)).setConfigConditions(ImmutableSet.<ConfigMatchingProvider>of()).build();
  return ruleContext;
}
