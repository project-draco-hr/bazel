{
  if (!(ctg.getTarget() instanceof Rule)) {
    return ImmutableSet.of();
  }
  Rule rule=(Rule)ctg.getTarget();
  ImmutableSet.Builder<ConfigMatchingProvider> keys=ImmutableSet.builder();
  RawAttributeMapper mapper=RawAttributeMapper.of(rule);
  for (  Attribute attribute : rule.getAttributes()) {
    for (    Label label : mapper.getConfigurabilityKeys(attribute.getName(),attribute.getType())) {
      if (BuildType.Selector.isReservedLabel(label)) {
        continue;
      }
      try {
        ConfiguredTarget ct=getConfiguredTarget(label,ctg.getConfiguration());
        keys.add(Preconditions.checkNotNull(ct.getProvider(ConfigMatchingProvider.class)));
      }
 catch (      NoSuchPackageException|NoSuchTargetException|NoSuchConfiguredTargetException e) {
        throw new IllegalStateException(e);
      }
    }
  }
  return keys.build();
}
