{
  Executor executor=actionExecutionContext.getExecutor();
  if (!spawn.isRemotable()) {
    SandboxHelpers.fallbackToNonSandboxedExecution(spawn,actionExecutionContext,executor);
    return;
  }
  SandboxHelpers.reportSubcommand(executor,spawn);
  SandboxHelpers.postActionStatusMessage(executor,spawn);
  Path sandboxPath=SandboxHelpers.getSandboxRoot(blazeDirs,productName,uuid,execCounter);
  Path sandboxExecRoot=sandboxPath.getRelative("execroot").getRelative(execRoot.getBaseName());
  try {
    SymlinkedExecRoot symlinkedExecRoot=new SymlinkedExecRoot(sandboxExecRoot);
    ImmutableSet<PathFragment> outputs=SandboxHelpers.getOutputFiles(spawn);
    Set<Path> writableDirs=getWritableDirs(sandboxExecRoot,spawn.getEnvironment(),outputs);
    symlinkedExecRoot.createFileSystem(getMounts(spawn,actionExecutionContext),outputs,writableDirs);
    final SandboxRunner runner;
    if (fullySupported) {
      runner=new LinuxSandboxRunner(execRoot,sandboxPath,sandboxExecRoot,getWritableDirs(sandboxExecRoot,spawn.getEnvironment(),outputs),getInaccessiblePaths(),verboseFailures,sandboxOptions.sandboxDebug);
    }
 else {
      runner=new ProcessWrapperRunner(execRoot,sandboxPath,sandboxExecRoot,verboseFailures);
    }
    try {
      runner.run(spawn.getArguments(),spawn.getEnvironment(),actionExecutionContext.getFileOutErr(),Spawns.getTimeoutSeconds(spawn),SandboxHelpers.shouldAllowNetwork(buildRequest,spawn));
    }
  finally {
      symlinkedExecRoot.copyOutputs(execRoot,outputs);
      if (!sandboxOptions.sandboxDebug) {
        SandboxHelpers.lazyCleanup(backgroundWorkers,runner);
      }
    }
  }
 catch (  IOException e) {
    throw new UserExecException("I/O error during sandboxed execution",e);
  }
}
