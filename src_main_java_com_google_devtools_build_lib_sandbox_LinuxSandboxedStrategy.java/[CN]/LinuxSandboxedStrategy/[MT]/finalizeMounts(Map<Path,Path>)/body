{
  MountMap finalizedMounts=new MountMap();
  for (  Entry<Path,Path> mount : mounts.entrySet()) {
    Path target=mount.getKey();
    Path source=mount.getValue();
    FileStatus stat=source.statNullable(Symlinks.NOFOLLOW);
    if (stat != null && stat.isDirectory()) {
      for (      Path subSource : FileSystemUtils.traverseTree(source,Predicates.alwaysTrue())) {
        Path subTarget=target.getRelative(subSource.relativeTo(source));
        finalizeMountPath(finalizedMounts,subTarget,subSource,subSource.statNullable(Symlinks.NOFOLLOW));
      }
    }
 else {
      finalizeMountPath(finalizedMounts,target,source,stat);
    }
  }
  return finalizedMounts;
}
