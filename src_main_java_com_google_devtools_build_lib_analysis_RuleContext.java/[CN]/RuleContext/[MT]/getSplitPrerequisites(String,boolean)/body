{
  checkAttribute(attributeName,Mode.SPLIT);
  Attribute attributeDefinition=getAttribute(attributeName);
  SplitTransition<?> transition=attributeDefinition.getSplitTransition(rule);
  List<BuildConfiguration> configurations=getConfiguration().getTransitions().getSplitConfigurations(transition);
  if (configurations.size() == 1) {
    String cpu=configurations.get(0).getCpu();
    if (cpu == null) {
      Preconditions.checkState(!requireSplit);
      cpu="DO_NOT_USE";
    }
    return ImmutableMap.of(cpu,targetMap.get(attributeName));
  }
  Set<String> cpus=new HashSet<>();
  for (  BuildConfiguration config : configurations) {
    Preconditions.checkNotNull(config.getCpu());
    cpus.add(config.getCpu());
  }
  ImmutableListMultimap.Builder<String,TransitiveInfoCollection> result=ImmutableListMultimap.builder();
  for (  TransitiveInfoCollection t : targetMap.get(attributeName)) {
    if (t.getConfiguration() != null) {
      result.put(t.getConfiguration().getCpu(),t);
    }
 else {
      for (      String cpu : cpus) {
        result.put(cpu,t);
      }
    }
  }
  return Multimaps.asMap(result.build());
}
