{
  Preconditions.checkNotNull(prerequisiteMap);
  Preconditions.checkNotNull(configConditions);
  Preconditions.checkNotNull(visibility);
  ListMultimap<String,ConfiguredTarget> targetMap=createTargetMap();
  ListMultimap<String,ConfiguredFilesetEntry> filesetEntryMap=createFilesetEntryMap(rule,configConditions);
  Map<String,Attribute> attributeMap=new HashMap<>();
  for (  Attribute attribute : prerequisiteMap.keySet()) {
    if (attribute == null) {
      continue;
    }
    attributeMap.put(attribute.getName(),attribute);
  }
  return new RuleContext(this,targetMap,filesetEntryMap,configConditions,getEnabledFeatures(),attributeMap);
}
