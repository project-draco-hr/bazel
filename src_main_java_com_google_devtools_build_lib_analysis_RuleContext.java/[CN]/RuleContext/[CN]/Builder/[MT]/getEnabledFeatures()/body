{
  Set<String> enabled=new HashSet<>();
  Set<String> disabled=new HashSet<>();
  for (  String feature : Iterables.concat(getConfiguration().getDefaultFeatures(),getRule().getPackage().getFeatures())) {
    if (feature.startsWith("-")) {
      disabled.add(feature.substring(1));
    }
 else     if (feature.equals("no_layering_check")) {
      disabled.add(feature.substring(3));
    }
 else {
      enabled.add(feature);
    }
  }
  return Sets.difference(enabled,disabled).immutableCopy();
}
