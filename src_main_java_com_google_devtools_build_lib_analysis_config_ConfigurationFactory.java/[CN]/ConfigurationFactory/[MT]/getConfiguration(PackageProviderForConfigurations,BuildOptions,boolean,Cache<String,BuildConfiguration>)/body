{
  String cacheKey=buildOptions.computeCacheKey();
  BuildConfiguration result=cache.getIfPresent(cacheKey);
  if (result != null) {
    return result;
  }
  Map<Class<? extends Fragment>,Fragment> fragments=new HashMap<>();
  for (  ConfigurationFragmentFactory factory : configurationFragmentFactories) {
    Class<? extends Fragment> fragmentType=factory.creates();
    Fragment fragment=loadedPackageProvider.getFragment(buildOptions,fragmentType);
    if (fragment != null && fragments.get(fragment) == null) {
      fragments.put(fragment.getClass(),fragment);
    }
  }
  BlazeDirectories directories=loadedPackageProvider.getDirectories();
  if (loadedPackageProvider.valuesMissing()) {
    return null;
  }
  fragments=ImmutableSortedMap.copyOf(fragments,new Comparator<Class<? extends Fragment>>(){
    @Override public int compare(    Class<? extends Fragment> o1,    Class<? extends Fragment> o2){
      return o1.getName().compareTo(o2.getName());
    }
  }
);
  fragments=ImmutableMap.copyOf(fragments);
  result=new BuildConfiguration(directories,fragments,buildOptions,actionsDisabled);
  cache.put(cacheKey,result);
  return result;
}
