{
  CcToolchainFeatures.Variables.Builder buildVariables=new CcToolchainFeatures.Variables.Builder();
  CppModuleMap cppModuleMap=context.getCppModuleMap();
  if (featureConfiguration.isEnabled(CppRuleClasses.MODULE_MAPS) && cppModuleMap != null) {
    buildVariables.addVariable("module_name",cppModuleMap.getName());
    buildVariables.addVariable("module_map_file",cppModuleMap.getArtifact().getExecPathString());
    CcToolchainFeatures.Variables.ValueSequence.Builder sequence=new CcToolchainFeatures.Variables.ValueSequence.Builder();
    for (    Artifact artifact : context.getDirectModuleMaps()) {
      sequence.addValue(artifact.getExecPathString());
    }
    buildVariables.addSequence("dependent_module_map_files",sequence.build());
  }
  if (featureConfiguration.isEnabled(CppRuleClasses.USE_HEADER_MODULES)) {
    buildVariables.addSequenceVariable("module_files",getHeaderModulePaths(builder,usePic));
  }
  if (featureConfiguration.isEnabled(CppRuleClasses.INCLUDE_PATHS)) {
    buildVariables.addSequenceVariable("include_paths",getSafePathStrings(context.getIncludeDirs()));
    buildVariables.addSequenceVariable("quote_include_paths",getSafePathStrings(context.getQuoteIncludeDirs()));
    buildVariables.addSequenceVariable("system_include_paths",getSafePathStrings(context.getSystemIncludeDirs()));
  }
  if (ccRelativeName != null) {
    CppHelper.getFdoSupport(ruleContext).configureCompilation(builder,buildVariables,ruleContext,ccRelativeName,autoFdoImportPath,usePic,featureConfiguration);
  }
  if (gcnoFile != null) {
    buildVariables.addVariable("gcov_gcno_file",gcnoFile.getExecPathString());
  }
  buildVariables.addAllVariables(CppHelper.getToolchain(ruleContext).getBuildVariables());
  for (  VariablesExtension extension : variablesExtensions) {
    extension.addVariables(buildVariables);
  }
  CcToolchainFeatures.Variables variables=buildVariables.build();
  builder.setVariables(variables);
}
