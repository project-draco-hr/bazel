{
  if (usePic) {
    outputExtension=".pic" + outputExtension;
    dependencyFileExtension=".pic" + dependencyFileExtension;
  }
  Artifact outputFile=ruleContext.getRelatedArtifact(outputName,outputExtension);
  PathFragment tempOutputName=FileSystemUtils.replaceExtension(outputFile.getExecPath(),".temp" + outputExtension,outputExtension);
  builder.setPicMode(usePic).setOutputFile(outputFile).setDotdFile(outputName,dependencyFileExtension).setTempOutputFile(tempOutputName);
  Artifact dwoFile=generateDwo ? getDwoFile(outputFile) : null;
  builder.setDwoFile(dwoFile);
  setupBuildVariables(builder,usePic,ccRelativeName,execPath,null,dwoFile);
  semantics.finalizeCompileActionBuilder(ruleContext,builder);
  CppCompileAction action=builder.build();
  env.registerAction(action);
  if (addObject) {
    if (usePic) {
      result.addPicObjectFile(action.getOutputFile());
    }
 else {
      result.addObjectFile(action.getOutputFile());
    }
  }
}
