{
  JavaTargetAttributes attributes=getAttributes();
  JavaCompileAction.Builder builder=createJavaCompileActionBuilder(semantics);
  builder.setOutputJar(resourceJar);
  builder.addResources(attributes.getResources());
  builder.addClasspathResources(attributes.getClassPathResources());
  builder.setExtdirInputs(getExtdirInputs());
  builder.setLangtoolsJar(getLangtoolsJar());
  builder.addTranslations(getTranslations());
  builder.setCompressJar(true);
  builder.setClassDirectory(outputDir(resourceJar));
  builder.setTempDirectory(tempDir(resourceJar));
  builder.setJavaBuilderJar(getJavaBuilderJar());
  builder.setJavacOpts(getDefaultJavacOptsFromRule(getRuleContext()));
  builder.setJavacJvmOpts(ImmutableList.copyOf(JavaToolchainProvider.getDefaultJavacOptions(getRuleContext())));
  builder.setJavacJvmOpts(ImmutableList.copyOf(JavaToolchainProvider.getDefaultJavacJvmOptions(getRuleContext())));
  getAnalysisEnvironment().registerAction(builder.build());
  return resourceJar;
}
