{
  IntermediateArtifacts intermediateArtifacts=ObjcRuleClasses.intermediateArtifacts(ruleContext);
  Artifact teamPrefixFile=intermediateArtifacts.appendExtensionForEntitlementArtifact(".team_prefix_file");
  registerExtractTeamPrefixAction(teamPrefixFile);
  Artifact entitlementsNeedingSubstitution=attributes.entitlements();
  if (entitlementsNeedingSubstitution == null) {
    entitlementsNeedingSubstitution=intermediateArtifacts.appendExtensionForEntitlementArtifact(".entitlements_with_variables");
    registerExtractEntitlementsAction(entitlementsNeedingSubstitution);
  }
  Artifact entitlements=intermediateArtifacts.appendExtensionForEntitlementArtifact(".entitlements");
  registerEntitlementsVariableSubstitutionAction(entitlementsNeedingSubstitution,entitlements,teamPrefixFile);
  Artifact ipaUnsigned=ruleContext.getImplicitOutputArtifact(IPA_UNSIGNED);
  registerSignBundleAction(entitlements,ipaOutput,ipaUnsigned);
  return ipaUnsigned;
}
