{
  ruleContext.registerAction(ObjcActionsBuilder.spawnOnDarwinActionBuilder().setMnemonic("IosSignBundle").setProgressMessage("Signing iOS bundle: " + ruleContext.getLabel()).setExecutable(new PathFragment("/bin/bash")).addArgument("-c").addArgument("set -e && " + "t=$(mktemp -d -t signing_intermediate) && " + "signed_ipa=${PWD}/" + ipaOutput.getExecPathString() + " && "+ "unzip -qq "+ ipaUnsigned.getExecPathString()+ " -d ${t} && "+ codesignCommand(attributes.provisioningProfile(),entitlements,"${t}/" + bundling.getBundleDir())+ " && cd \"${t}\" && /usr/bin/zip -q -r \"${signed_ipa}\" .").addInput(ipaUnsigned).addInput(attributes.provisioningProfile()).addInput(entitlements).addOutput(ipaOutput).build(ruleContext));
  return this;
}
