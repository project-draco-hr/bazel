{
  bundleSupport.registerActions(objcProvider);
  registerCombineArchitecturesAction();
  ObjcConfiguration objcConfiguration=ObjcRuleClasses.objcConfiguration(ruleContext);
  Artifact ipaOutput=ruleContext.getImplicitOutputArtifact(IPA);
  Artifact maybeSignedIpa;
  if (objcConfiguration.getPlatform() == Platform.SIMULATOR) {
    maybeSignedIpa=ipaOutput;
  }
 else   if (attributes.provisioningProfile() == null) {
    throw new IllegalStateException(DEVICE_NO_PROVISIONING_PROFILE);
  }
 else {
    maybeSignedIpa=registerBundleSigningActions(ipaOutput);
  }
  String primaryBundleId=null;
  String fallbackBundleId=null;
  if (ruleContext.attributes().isAttributeValueExplicitlySpecified("bundle_id")) {
    primaryBundleId=attributes.bundleId();
  }
 else {
    fallbackBundleId=attributes.bundleId();
  }
  BundleMergeControlBytes bundleMergeControlBytes=new BundleMergeControlBytes(bundling,maybeSignedIpa,objcConfiguration,families,primaryBundleId,fallbackBundleId);
  registerBundleMergeActions(maybeSignedIpa,bundling.getBundleContentArtifacts(),bundleMergeControlBytes);
  return this;
}
