{
  String escapedBundleId=ShellUtils.shellEscape(attributes.bundleId());
  String shellCommand="set -e && " + "PREFIX=\"$(cat " + prefix.getShellEscapedExecPathString() + ")\" && "+ "sed "+ "-e \"s#${PREFIX}\\.\\*#${PREFIX}."+ escapedBundleId+ "#g\" "+ "-e \"s#\\$(AppIdentifierPrefix)#${PREFIX}.#g\" "+ "-e \"s#\\$(CFBundleIdentifier)#"+ escapedBundleId+ "#g\" "+ in.getShellEscapedExecPathString()+ " "+ "> "+ out.getShellEscapedExecPathString();
  ruleContext.registerAction(new SpawnAction.Builder().setMnemonic("SubstituteIosEntitlements").setShellCommand(shellCommand).addInput(in).addInput(prefix).addOutput(out).build(ruleContext));
}
