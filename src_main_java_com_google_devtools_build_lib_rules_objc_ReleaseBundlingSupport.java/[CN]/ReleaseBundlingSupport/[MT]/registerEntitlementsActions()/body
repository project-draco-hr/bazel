{
  Artifact teamPrefixFile=intermediateArtifacts.appendExtensionForEntitlementArtifact(".team_prefix_file");
  registerExtractTeamPrefixAction(teamPrefixFile);
  Artifact entitlementsNeedingSubstitution=attributes.entitlements();
  if (entitlementsNeedingSubstitution == null) {
    entitlementsNeedingSubstitution=intermediateArtifacts.appendExtensionForEntitlementArtifact(".entitlements_with_variables");
    registerExtractEntitlementsAction(entitlementsNeedingSubstitution);
  }
  Artifact substitutedEntitlements=intermediateArtifacts.entitlements();
  if (attributes.extraEntitlements() != null) {
    substitutedEntitlements=intermediateArtifacts.appendExtensionForEntitlementArtifact(".substituted");
    registerMergeEntitlementsAction(substitutedEntitlements,attributes.extraEntitlements());
  }
  registerEntitlementsVariableSubstitutionAction(entitlementsNeedingSubstitution,teamPrefixFile,substitutedEntitlements);
}
