{
  super.setUp();
  AnalysisMock mock=getAnalysisMock();
  pkgLocator=new PathPackageLocator(rootDirectory);
  directories=new BlazeDirectories(outputBase,outputBase,rootDirectory);
  workspaceStatusActionFactory=new AnalysisTestUtil.DummyWorkspaceStatusActionFactory(directories);
  mockToolsConfig=new MockToolsConfig(rootDirectory);
  mock.setupMockClient(mockToolsConfig);
  mock.setupMockWorkspaceFiles(directories.getEmbeddedBinariesRoot());
  configurationFactory=mock.createConfigurationFactory();
  useRuleClassProvider(TestRuleClassProvider.getRuleClassProvider());
}
