{
  ConfiguredAspect.Builder aspectBuilder=new ConfiguredAspect.Builder(NAME,ruleContext);
  ObjcProtoProvider.Builder aspectObjcProtoProvider=new ObjcProtoProvider.Builder();
  if (ruleContext.attributes().has("deps",BuildType.LABEL_LIST)) {
    Iterable<ObjcProtoProvider> depObjcProtoProviders=ruleContext.getPrerequisites("deps",Mode.TARGET,ObjcProtoProvider.class);
    aspectObjcProtoProvider.addTransitive(depObjcProtoProviders);
  }
  if (ruleContext.attributes().isAttributeValueExplicitlySpecified(ObjcProtoLibraryRule.PORTABLE_PROTO_FILTERS_ATTR)) {
    aspectObjcProtoProvider.addPortableProtoFilters(PrerequisiteArtifacts.nestedSet(ruleContext,ObjcProtoLibraryRule.PORTABLE_PROTO_FILTERS_ATTR,Mode.HOST));
    Iterable<ProtoSourcesProvider> protoProviders=ruleContext.getPrerequisites("deps",Mode.TARGET,ProtoSourcesProvider.class);
    for (    ProtoSourcesProvider protoProvider : protoProviders) {
      aspectObjcProtoProvider.addProtoSources(protoProvider.getTransitiveProtoSources());
    }
  }
  if (!aspectObjcProtoProvider.isEmpty()) {
    aspectBuilder.addProvider(ObjcProtoProvider.class,aspectObjcProtoProvider.build());
  }
  return aspectBuilder.build();
}
