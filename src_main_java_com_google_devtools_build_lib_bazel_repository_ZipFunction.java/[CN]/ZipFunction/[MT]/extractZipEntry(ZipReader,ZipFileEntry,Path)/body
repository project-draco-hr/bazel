{
  String relativeString=entry.getName();
  PathFragment relativePath=new PathFragment(relativeString);
  if (relativePath.isAbsolute()) {
    throw new IOException(String.format("Failed to extract %s, zipped paths cannot be absolute",relativePath));
  }
  Path outputPath=destinationDirectory.getRelative(relativePath);
  int permissions=getPermissions(entry.getExternalAttributes(),relativeString);
  FileSystemUtils.createDirectoryAndParents(outputPath.getParentDirectory());
  boolean isDirectory=(permissions & 040000) == 040000;
  if (isDirectory) {
    FileSystemUtils.createDirectoryAndParents(outputPath);
  }
 else {
    if (outputPath.exists()) {
      outputPath.delete();
    }
    File outputFile=outputPath.getPathFile();
    Files.copy(reader.getInputStream(entry),outputFile.toPath());
    outputPath.chmod(permissions);
  }
}
