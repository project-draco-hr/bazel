{
  int shiftedPermissions=permissions >>> 16;
  if (shiftedPermissions != 0) {
    return shiftedPermissions;
  }
  int windowsPermission=permissions & 0xff;
  if (path.endsWith("/") || (windowsPermission & WINDOWS_DIRECTORY) == WINDOWS_DIRECTORY) {
    return 040755;
  }
 else   if (permissions == 0 || (windowsPermission & WINDOWS_FILE) == WINDOWS_FILE) {
    return 010644;
  }
  throw new IOException("Unrecognized file mode for " + path + ": 0x"+ Integer.toHexString(permissions));
}
