{
  super(owner,inputs,new RunfilesSupplierImpl(new PathFragment("runfiles"),executionSettings.getRunfiles()),list(testLog,cacheStatus,coverageArtifact,microCoverageArtifact));
  this.runtime=runtime;
  this.configuration=Preconditions.checkNotNull(configuration);
  this.testLog=testLog;
  this.cacheStatus=cacheStatus;
  this.coverageData=coverageArtifact;
  this.microCoverageData=microCoverageArtifact;
  this.shardNum=shardNum;
  this.runNumber=runNumber;
  this.testProperties=Preconditions.checkNotNull(testProperties);
  this.executionSettings=Preconditions.checkNotNull(executionSettings);
  this.baseDir=cacheStatus.getExecPath().getParentDirectory();
  int totalShards=executionSettings.getTotalShards();
  Preconditions.checkState((totalShards == 0 && shardNum == 0) || (totalShards > 0 && 0 <= shardNum && shardNum < totalShards));
  this.testExitSafe=baseDir.getChild("test.exited_prematurely");
  this.testShard=totalShards > 1 ? baseDir.getChild("test.shard") : null;
  this.xmlOutputPath=baseDir.getChild("test.xml");
  this.testWarningsPath=baseDir.getChild("test.warnings");
  this.unusedRunfilesLogPath=baseDir.getChild("test.unused_runfiles_log");
  this.testStderr=baseDir.getChild("test.err");
  this.splitLogsDir=baseDir.getChild("test.raw_splitlogs");
  this.splitLogsPath=splitLogsDir.getChild("test.splitlogs");
  this.undeclaredOutputsDir=baseDir.getChild("test.outputs");
  this.undeclaredOutputsZipPath=undeclaredOutputsDir.getChild("outputs.zip");
  this.undeclaredOutputsAnnotationsDir=baseDir.getChild("test.outputs_manifest");
  this.undeclaredOutputsManifestPath=undeclaredOutputsAnnotationsDir.getChild("MANIFEST");
  this.undeclaredOutputsAnnotationsPath=undeclaredOutputsAnnotationsDir.getChild("ANNOTATIONS");
  this.testInfrastructureFailure=baseDir.getChild("test.infrastructure_failure");
  this.workspaceName=workspaceName;
  Map<String,String> mergedTestEnv=new HashMap<>(configuration.getTestEnv());
  mergedTestEnv.putAll(extraTestEnv);
  this.testEnv=ImmutableMap.copyOf(mergedTestEnv);
}
