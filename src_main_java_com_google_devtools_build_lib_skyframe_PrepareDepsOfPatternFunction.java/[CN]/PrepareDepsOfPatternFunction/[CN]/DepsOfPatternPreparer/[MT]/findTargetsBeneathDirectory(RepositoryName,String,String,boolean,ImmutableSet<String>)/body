{
  FilteringPolicy policy=rulesOnly ? FilteringPolicies.RULES_ONLY : FilteringPolicies.NO_FILTER;
  ImmutableSet<PathFragment> excludedPathFragments=TargetPatternResolverUtil.getPathFragments(excludedSubdirectories);
  PathFragment pathFragment=TargetPatternResolverUtil.getPathFragment(directory);
  for (  Path root : pkgPath.getPathEntries()) {
    RootedPath rootedPath=RootedPath.toRootedPath(root,pathFragment);
    SkyValue token=env.getValue(PrepareDepsOfTargetsUnderDirectoryValue.key(repository,rootedPath,excludedPathFragments,policy));
    if (token == null) {
      throw new MissingDepException();
    }
  }
  return ResolvedTargets.empty();
}
