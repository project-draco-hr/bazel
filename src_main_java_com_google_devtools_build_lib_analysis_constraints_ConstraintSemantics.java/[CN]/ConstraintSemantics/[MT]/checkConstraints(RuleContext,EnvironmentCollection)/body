{
  for (  TransitiveInfoCollection dependency : getConstraintCheckedDependencies(ruleContext)) {
    SupportedEnvironmentsProvider depProvider=dependency.getProvider(SupportedEnvironmentsProvider.class);
    Collection<Label> unsupportedEnvironments=getUnsupportedEnvironments(depProvider.getEnvironments(),ruleEnvironments);
    if (!unsupportedEnvironments.isEmpty()) {
      ruleContext.ruleError("dependency " + dependency.getLabel() + " doesn't support expected environment"+ (unsupportedEnvironments.size() == 1 ? "" : "s")+ ": "+ Joiner.on(", ").join(unsupportedEnvironments));
    }
  }
}
