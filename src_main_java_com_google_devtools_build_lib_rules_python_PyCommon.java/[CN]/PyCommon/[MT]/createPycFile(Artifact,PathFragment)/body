{
  Artifact output=ruleContext.getRelatedArtifact(source.getRootRelativePath(),".pyc");
  SpawnAction.Builder builder=new SpawnAction.Builder().setResources(PY_COMPILE_RESOURCE_SET).setExecutable(pythonBinary).setProgressMessage("Compiling Python").addInputArgument(ruleContext.getPrerequisiteArtifact("$python_precompile",Mode.HOST)).setMnemonic("PyCompile");
  TransitiveInfoCollection pythonTarget=ruleContext.getPrerequisite(":host_python2_runtime",Mode.HOST);
  if (pythonTarget != null) {
    builder.addInputs(pythonTarget.getProvider(FileProvider.class).getFilesToBuild());
  }
  builder.addInputArgument(source);
  builder.addOutputArgument(output);
  ruleContext.registerAction(builder.build(ruleContext));
  return output;
}
