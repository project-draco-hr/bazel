{
  if (advertisedProviders.isEmpty()) {
    return ImmutableMultimap.of();
  }
  LinkedHashMultimap<Attribute,Label> result=LinkedHashMultimap.create();
  for (  Class<? extends AspectFactory<?,?,?>> candidateClass : attribute.getAspects()) {
    AspectFactory<?,?,?> candidate=AspectFactory.Util.create(candidateClass);
    if (!advertisedProviders.containsAll(candidate.getDefinition().getRequiredProviderNames())) {
      continue;
    }
    addAllAttributesOfAspect((Rule)from,result,candidate.getDefinition(),Rule.ALL_DEPS);
  }
  return ImmutableMultimap.copyOf(result);
}
