{
  List<String> jcopts=new ArrayList<>(javacOpts);
  JavaConfiguration javaConfiguration=configuration.getFragment(JavaConfiguration.class);
  if (!javaConfiguration.getJavaWarns().isEmpty()) {
    jcopts.add("-Xlint:" + Joiner.on(',').join(javaConfiguration.getJavaWarns()));
  }
  if (!bootclasspathEntries.isEmpty()) {
    jcopts.add("-bootclasspath");
    jcopts.add(Artifact.joinExecPaths(configuration.getHostPathSeparator(),bootclasspathEntries));
  }
  List<String> internedJcopts=new ArrayList<>();
  for (  String jcopt : jcopts) {
    internedJcopts.add(StringCanonicalizer.intern(jcopt));
  }
  if (strictJavaDeps == BuildConfiguration.StrictDepsMode.OFF) {
    directJars.clear();
    compileTimeDependencyArtifacts.clear();
  }
  if (javaConfiguration.getReduceJavaClasspath() != JavaClasspathMode.JAVABUILDER) {
    compileTimeDependencyArtifacts.clear();
  }
  if (paramFile == null) {
    paramFile=artifactFactory.create(ParameterFile.derivePath(outputJar.getRootRelativePath()),configuration.getBinDirectory());
  }
  Iterable<Artifact> baseInputs=ImmutableIterable.from(Iterables.concat(javabaseInputs,bootclasspathEntries,extdirInputs,ImmutableList.of(paramFile)));
  Preconditions.checkState(javaExecutable != null,owner);
  Preconditions.checkState(javaExecutable.isAbsolute() ^ !javabaseInputs.isEmpty(),javaExecutable);
  ArrayList<Artifact> outputs=new ArrayList<>(Collections2.filter(Arrays.asList(outputJar,metadata,gensrcOutputJar,manifestProtoOutput,outputDepsProto),Predicates.notNull()));
  CustomCommandLine.Builder paramFileContentsBuilder=javaCompileCommandLine(semantics,configuration,classDirectory,sourceGenDirectory,tempDirectory,outputJar,gensrcOutputJar,manifestProtoOutput,compressJar,outputDepsProto,classpathEntries,processorPath,processorNames,translations,resources,classpathResources,sourceJars,sourceFiles,extdirInputs,internedJcopts,directJars,strictJavaDeps,compileTimeDependencyArtifacts,ruleKind,targetLabel);
  semantics.buildJavaCommandLine(outputs,configuration,paramFileContentsBuilder);
  CommandLine paramFileContents=paramFileContentsBuilder.build();
  Action parameterFileWriteAction=new ParameterFileWriteAction(owner,paramFile,paramFileContents,ParameterFile.ParameterFileType.UNQUOTED,ISO_8859_1);
  analysisEnvironment.registerAction(parameterFileWriteAction);
  CommandLine javaBuilderCommandLine=spawnCommandLine(javaExecutable,javaBuilderJar,langtoolsJar,instrumentationJars,paramFile,javacJvmOpts,semantics.getJavaBuilderMainClass(),configuration.getHostPathSeparator());
  return new JavaCompileAction(owner,baseInputs,outputs,paramFileContents,javaBuilderCommandLine,classDirectory,outputJar,classpathEntries,extdirInputs,processorPath,langtoolsJar,javaBuilderJar,instrumentationJars,processorNames,translations,resources,classpathResources,sourceJars,sourceFiles,internedJcopts,directJars,strictJavaDeps,compileTimeDependencyArtifacts);
}
