'This file contains unit tests for the merge_manifests script.'
import re
import unittest
import xml.dom.minidom
from tools.android import merge_manifests
FIRST_MANIFEST = '<?xml version=\'1.0\' encoding=\'utf-8\'?>\n<manifest\n    xmlns:android="http://schemas.android.com/apk/res/android"\n    package="com.google.android.apps.testapp"\n    android:versionCode="70"\n    android:versionName="1.0">\n  <uses-sdk android:minSdkVersion="10"/>\n  <uses-feature android:name="android.hardware.nfc" android:required="true" />\n  <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />\n  <application\n      android:icon="@drawable/icon"\n      android:name="com.google.android.apps.testapp.TestApplication"\n      android:theme="@style/Theme.Test"\n      android:label="@string/app_name">\n    <!--  START LIBRARIES (Maintain Alphabetic order) -->\n    <!-- NFC extras -->\n    <uses-library android:name="com.google.android.nfc_extras" android:required="false"/>\n    <!--  END LIBRARIES -->\n    <!--  START ACTIVITIES (Maintain Alphabetic order) -->\n    <!-- Entry point activity - navigation and title bar. -->\n    <activity\n        android:name=".entrypoint.EntryPointActivityGroup"\n        android:screenOrientation="portrait"\n        android:launchMode="singleTop"/>\n    <activity android:name=".ui.topup.TopUpActivity" />\n    <service android:name=".nfcevent.NfcEventService" />\n    <receiver\n         android:name="com.receiver.TestReceiver"\n         android:process="@string/receiver_service_name">\n      <!-- Receive the actual message -->\n       <intent-filter>\n         <action\n           android:name="android.intent.action.USER_PRESENT"/>\n       </intent-filter>\n    </receiver>\n    <provider\n        android:name=".dataaccess.persistence.ContentProvider"\n        android:authorities="com.google.android.apps.testapp"\n        android:exported="false" />\n  </application>\n</manifest>\n'
SECOND_MANIFEST = '<?xml version=\'1.0\' encoding=\'utf-8\'?>\n<manifest xmlns:android="http://schemas.android.com/apk/res/android"\n      package="com.google.android.apps.testapp2"\n      android:versionCode="1"\n      android:versionName="1.0">\n  <permission android:name="com.google.android.apps.foo.C2D_MESSAGE"\n     android:protectionLevel="signature" />\n  <uses-sdk android:minSdkVersion="5" />\n  <uses-feature android:name="android.hardware.nfc" android:required="true" />\n  <uses-permission android:name="android.permission.READ_LOGS" />\n  <uses-permission android:name="android.permission.INTERNET" />\n  <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />\n  <!-- Comment for permission android.permission.GET_ACCOUNTS.\n    This is just to make sure the comment is being merged correctly.\n  -->\n  <uses-permission android:name="android.permission.GET_ACCOUNTS" />\n  <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />\n\n  <application\n      android:icon="@drawable/icon"\n      android:name="com.google.android.apps.testapp.TestApplication2"\n      android:theme="@style/Theme.Test2"\n      android:label="@string/app_name"\n      android:backupAgent="FooBar">\n    <activity android:name=".ui.home.HomeActivity"\n              android:label="@string/app_name" >\n      <intent-filter>\n        <action android:name="android.intent.action.MAIN"/>\n        <category android:name="android.intent.category.LAUNCHER"/>\n      </intent-filter>\n    </activity>\n    <activity android:name=".TestActivity2"></activity>\n    <activity android:name=".PreviewActivity"></activity>\n    <activity android:name=".ShowTextActivity" android:excludeFromRecents="true"></activity>\n    <activity android:name=".ShowStringListActivity"\n              android:excludeFromRecents="true"\n              android:parentActivityName=".ui.home.HomeActivity">\n    </activity>\n    <service android:name=".TestService">\n      <meta-data android:name="param" android:value="value"/>\n    </service>\n    <service android:name=".nfcevent.NfcEventService" />\n    <receiver android:name=".ConnectivityReceiver" android:enabled="false" >\n      <intent-filter>\n        <action android:name="android.net.conn.CONNECTIVITY_CHANGE" />\n      </intent-filter>\n    </receiver>\n    <activity-alias android:name="BarFoo" android:targetActivity=".FooBar" />\n    <provider\n      android:name="some.package.with.inner.class$AnInnerClass" />\n    <provider\n      android:name="${packageName}"\n      android:authorities="${packageName}.${packageName}"\n      android:exported="false" />\n    <provider\n      android:name="${packageName}.PlaceHolderProviderName"\n      android:authorities="PlaceHolderProviderAuthorities.${packageName}"\n      android:exported="false" />\n    <activity\n      android:name="activityPrefix.${packageName}.activitySuffix">\n      <intent-filter>\n        <action android:name="actionPrefix.${packageName}.actionSuffix" />\n      </intent-filter>\n    </activity>\n  </application>\n</manifest>\n'
THIRD_MANIFEST = '<?xml version=\'1.0\' encoding=\'utf-8\'?>\n<manifest xmlns:android="http://schemas.android.com/apk/res/android"\n      package="com.google.android.apps.testapp3"\n      android:versionCode="3"\n      android:versionName="1.30">\n  <uses-sdk android:minSdkVersion="14" />\n  <uses-feature android:name="android.hardware.nfc" android:required="true" />\n  <uses-permission android:name="android.permission.READ_LOGS" />\n  <uses-permission android:name="android.permission.INTERNET" />\n  <application>\n    <activity android:name=".ui.home.HomeActivity"\n              android:label="@string/app_name" >\n      <intent-filter>\n        <action android:name="android.intent.action.MAIN"/>\n        <category android:name="android.intent.category.LAUNCHER"/>\n      </intent-filter>\n    </activity>\n    <activity android:name="TestActivity"></activity>\n    <service android:name=".TestService" />\n    <receiver android:name=".ConnectivityReceiver" android:enabled="true" >\n      <intent-filter>\n        <action android:name="android.net.conn.CONNECTIVITY_CHANGER" />\n      </intent-filter>\n    </receiver>\n  </application>\n</manifest>\n'
MANUALLY_MERGED = '<?xml version=\'1.0\' encoding=\'utf-8\'?>\n<manifest\n    xmlns:android="http://schemas.android.com/apk/res/android"\n    package="com.google.android.apps.testapp"\n    android:versionCode="70"\n    android:versionName="1.0">\n  <!-- *** WARNING *** DO NOT EDIT! THIS IS GENERATED MANIFEST BY MERGE_MANIFEST TOOL.\n  Merger manifest:\n    FIRST_MANIFEST\n  Mergee manifests:\n    SECOND_MANIFEST\n    THIRD_MANIFEST\n   -->\n  <uses-sdk android:minSdkVersion="10"/>\n  <uses-feature android:name="android.hardware.nfc" android:required="true" />\n  <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />\n\n  <application\n      android:icon="@drawable/icon"\n      android:name="com.google.android.apps.testapp.TestApplication"\n      android:theme="@style/Theme.Test"\n      android:label="@string/app_name">\n    <!--  START LIBRARIES (Maintain Alphabetic order) -->\n    <!-- NFC extras -->\n    <uses-library android:name="com.google.android.nfc_extras" android:required="false"/>\n    <!--  END LIBRARIES -->\n    <!--  START ACTIVITIES (Maintain Alphabetic order) -->\n    <!-- Entry point activity - navigation and title bar. -->\n    <activity\n        android:name="com.google.android.apps.testapp.entrypoint.EntryPointActivityGroup"\n        android:screenOrientation="portrait"\n        android:launchMode="singleTop"/>\n    <activity android:name="com.google.android.apps.testapp.ui.topup.TopUpActivity" />\n    <service android:name="com.google.android.apps.testapp.nfcevent.NfcEventService" />\n    <receiver\n         android:name="com.receiver.TestReceiver"\n         android:process="@string/receiver_service_name">\n      <!-- Receive the actual message -->\n       <intent-filter>\n         <action\n           android:name="android.intent.action.USER_PRESENT"/>\n       </intent-filter>\n    </receiver>\n    <provider android:authorities="com.google.android.apps.testapp" android:exported="false"\n      android:name="com.google.android.apps.testapp.dataaccess.persistence.ContentProvider"/>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <activity android:label="@string/app_name" android:name="com.google.android.apps.testapp2.ui.home.HomeActivity">\n      <intent-filter>\n        <action android:name="android.intent.action.MAIN"/>\n        <category android:name="android.intent.category.LAUNCHER"/>\n      </intent-filter>\n    </activity>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <activity android:name="com.google.android.apps.testapp2.TestActivity2"></activity>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <activity android:name="com.google.android.apps.testapp2.PreviewActivity"></activity>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <activity android:name="com.google.android.apps.testapp2.ShowTextActivity"\n        android:excludeFromRecents="true"></activity>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <activity android:name="com.google.android.apps.testapp2.ShowStringListActivity"\n              android:excludeFromRecents="true"\n              android:parentActivityName="com.google.android.apps.testapp2.ui.home.HomeActivity">\n    </activity>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <activity\n      android:name="activityPrefix.com.google.android.apps.testapp.activitySuffix">\n      <intent-filter>\n        <action android:name="actionPrefix.com.google.android.apps.testapp.actionSuffix" />\n      </intent-filter>\n    </activity>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <provider\n      android:name="some.package.with.inner.class$AnInnerClass" />\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <provider\n      android:name="com.google.android.apps.testapp"\n      android:authorities="com.google.android.apps.testapp.com.google.android.apps.testapp"\n      android:exported="false" />\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <provider\n      android:name="com.google.android.apps.testapp.PlaceHolderProviderName"\n      android:authorities="PlaceHolderProviderAuthorities.com.google.android.apps.testapp"\n      android:exported="false" />\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <receiver android:name="com.google.android.apps.testapp2.ConnectivityReceiver"\n        android:enabled="false" >\n      <intent-filter>\n        <action android:name="android.net.conn.CONNECTIVITY_CHANGE" />\n      </intent-filter>\n    </receiver>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <service android:name="com.google.android.apps.testapp2.TestService">\n      <meta-data android:name="param" android:value="value"/>\n    </service>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <service android:name="com.google.android.apps.testapp2.nfcevent.NfcEventService"/>\n    <!-- Merged from file: THIRD_MANIFEST -->\n    <activity android:label="@string/app_name" android:name="com.google.android.apps.testapp3.ui.home.HomeActivity">\n    <intent-filter>\n      <action android:name="android.intent.action.MAIN"/>\n      <category android:name="android.intent.category.LAUNCHER"/>\n    </intent-filter>\n    </activity>\n    <!-- Merged from file: THIRD_MANIFEST -->\n    <activity android:name="com.google.android.apps.testapp3.TestActivity"/>\n    <!-- Merged from file: THIRD_MANIFEST -->\n    <receiver android:enabled="true"\n      android:name="com.google.android.apps.testapp3.ConnectivityReceiver">\n    <intent-filter>\n      <action android:name="android.net.conn.CONNECTIVITY_CHANGER"/>\n    </intent-filter>\n  </receiver>\n  <!-- Merged from file: THIRD_MANIFEST -->\n  <service android:name="com.google.android.apps.testapp3.TestService"/>\n  <!-- Merged from file: SECOND_MANIFEST -->\n    <activity-alias android:name="com.google.android.apps.testapp2.BarFoo"\n      android:targetActivity="com.google.android.apps.testapp2.FooBar"/>\n  </application>\n  <!-- Merged from file: SECOND_MANIFEST -->\n  <permission android:name="com.google.android.apps.foo.C2D_MESSAGE" android:protectionLevel="signature" />\n  <!-- Merged from file: SECOND_MANIFEST -->\n  <uses-permission android:name="android.permission.INTERNET" />\n  <!-- Merged from file: SECOND_MANIFEST -->\n  <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />\n  <!-- Merged from file: SECOND_MANIFEST -->\n  <!-- Comment for permission android.permission.GET_ACCOUNTS.\n    This is just to make sure the comment is being merged correctly.\n  -->\n  <uses-permission android:name="android.permission.GET_ACCOUNTS" />\n</manifest>\n'
ALIAS_MANIFEST = '<?xml version=\'1.0\' encoding=\'utf-8\'?>\n<manifest\n    xmlns:android="http://schemas.android.com/apk/res/android"\n    package="com.google.android.apps.testapp"\n    android:versionCode="70"\n    android:versionName="1.0">\n  <uses-sdk android:minSdkVersion="10"/>\n  <uses-feature android:name="android.hardware.nfc" android:required="true" />\n  <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />\n  <application\n      android:icon="@drawable/icon"\n      android:name="com.google.android.apps.testapp.TestApplication"\n      android:theme="@style/Theme.Test"\n      android:label="@string/app_name">\n    <activity-alias android:name="com.google.foo.should.not.be.first"\n      android:targetActivity=".entrypoint.EntryPointActivityGroup"/>\n    <!--  START LIBRARIES (Maintain Alphabetic order) -->\n    <!-- NFC extras -->\n    <uses-library android:name="com.google.android.nfc_extras" android:required="false"/>\n    <!--  END LIBRARIES -->\n    <!--  START ACTIVITIES (Maintain Alphabetic order) -->\n    <!-- Entry point activity - navigation and title bar. -->\n    <activity\n        android:name=".entrypoint.EntryPointActivityGroup"\n        android:screenOrientation="portrait"\n        android:launchMode="singleTop"/>\n    <activity android:name=".ui.topup.TopUpActivity" />\n    <service android:name=".nfcevent.NfcEventService" />\n    <receiver\n         android:name="com.receiver.TestReceiver"\n         android:process="@string/receiver_service_name">\n      <!-- Receive the actual message -->\n       <intent-filter>\n         <action\n           android:name="android.intent.action.USER_PRESENT"/>\n       </intent-filter>\n    </receiver>\n    <provider\n        android:name=".dataaccess.persistence.ContentProvider"\n        android:authorities="com.google.android.apps.testapp"\n        android:exported="false" />\n  </application>\n</manifest>\n'
INVALID_MERGER_MANIFEST = '\n<manifest xmlns:android="http://schemas.android.com/apk/res/android"\n  package="com.google.android.invalid"\n  android:versionCode="9100000"\n  android:versionName="9.1.0.0x">\n  <uses-sdk android:minSdkVersion="14" android:targetSdkVersion="21" />\n</manifest>\n'
VALID_MANIFEST = '\n<manifest\n    android:versionCode="9100000"\n    android:versionName="9.1.0.0x"\n    package="com.google.android.invalid"\n    xmlns:android="http://schemas.android.com/apk/res/android">\n  <!-- *** WARNING *** DO NOT EDIT! THIS IS GENERATED MANIFEST BY MERGE_MANIFEST TOOL.\n  Merger manifest:\n    INVALID_MANIFEST\n  Mergee manifests:\n    SECOND_MANIFEST\n  -->\n  <application\n      android:backupAgent="com.google.android.apps.testapp2.FooBar"\n      android:icon="@drawable/icon"\n      android:label="@string/app_name"\n      android:name="com.google.android.apps.testapp.TestApplication2"\n      android:theme="@style/Theme.Test2">\n    <activity\n       android:name="com.google.android.apps.testapp2.TestActivity2"/>\n    <activity\n       android:name="com.google.android.apps.testapp2.PreviewActivity"/>\n    <activity android:excludeFromRecents="true"\n       android:name="com.google.android.apps.testapp2.ShowTextActivity"/>\n    <activity android:excludeFromRecents="true"\n       android:name="com.google.android.apps.testapp2.ShowStringListActivity"\n       android:parentActivityName="com.google.android.apps.testapp2.ui.home.HomeActivity">\n    </activity>\n    <service\n       android:name="com.google.android.apps.testapp2.TestService">\n      <meta-data android:name="param"\n         android:value="value"/>\n    </service>\n    <service\n       android:name="com.google.android.apps.testapp2.nfcevent.NfcEventService"/>\n    <receiver\n      android:enabled="false"\n      android:name="com.google.android.apps.testapp2.ConnectivityReceiver">\n      <intent-filter>\n        <action android:name="android.net.conn.CONNECTIVITY_CHANGE"/>\n      </intent-filter>\n    </receiver>\n    <provider android:name="some.package.with.inner.class$AnInnerClass"/>\n    <provider\n       android:authorities="com.google.android.invalid.com.google.android.invalid"\n       android:exported="false" android:name="com.google.android.invalid"/>\n    <provider android:authorities="PlaceHolderProviderAuthorities.com.google.android.invalid"\n       android:exported="false"\n       android:name="com.google.android.invalid.PlaceHolderProviderName"/>\n    <activity android:name="activityPrefix.com.google.android.invalid.activitySuffix">\n      <intent-filter>\n        <action android:name="actionPrefix.com.google.android.invalid.actionSuffix"/>\n      </intent-filter>\n    </activity>\n    <!-- Merged from file: SECOND_MANIFEST -->\n    <activity android:label="@string/app_name"\n       android:name="com.google.android.apps.testapp2.ui.home.HomeActivity">\n      <intent-filter>\n        <action android:name="android.intent.action.MAIN"/>\n        <category android:name="android.intent.category.LAUNCHER"/>\n      </intent-filter>\n    </activity>\n    <activity-alias\n      android:name="com.google.android.apps.testapp2.BarFoo"\n      android:targetActivity="com.google.android.apps.testapp2.FooBar"/>\n  </application>\n  <uses-sdk android:minSdkVersion="14" android:targetSdkVersion="21"/>\n  <!-- Merged from file: SECOND_MANIFEST -->\n  <permission android:name="com.google.android.apps.foo.C2D_MESSAGE" android:protectionLevel="signature"/>\n  <!-- Merged from file: SECOND_MANIFEST -->\n  <uses-feature android:name="android.hardware.nfc" android:required="true"/>\n</manifest>\n'
if (__name__ == '__main__'):
    unittest.main()
