{
  Map<PackageIdentifier,Package> packages=Maps.newHashMapWithExpectedSize(packagesToRequest.size());
  for (  PackageIdentifier pkgIdentifier : packagesToRequest) {
    SkyKey key=PackageValue.key(pkgIdentifier);
    Package pkg=null;
    NoSuchPackageException nspe=(NoSuchPackageException)walkableGraph.getException(key);
    if (nspe != null) {
      pkg=nspe.getPackage();
    }
 else {
      pkg=((PackageValue)walkableGraph.getValue(key)).getPackage();
    }
    Preconditions.checkNotNull(pkg,pkgIdentifier);
    packages.put(pkgIdentifier,pkg);
  }
  return packages;
}
