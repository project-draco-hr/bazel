{
  Label crosstoolTop=file.getCrosstoolTop();
  Path path=null;
  try {
    Package containingPackage=env.getTarget(crosstoolTop.getLocalTargetLabel("BUILD")).getPackage();
    if (containingPackage == null) {
      return false;
    }
    path=env.getPath(containingPackage,CROSSTOOL_CONFIGURATION_FILENAME);
  }
 catch (  SyntaxException e) {
    throw new InvalidConfigurationException(e);
  }
catch (  NoSuchThingException e) {
  }
  if (path == null || !path.exists()) {
    throw new InvalidConfigurationException("The crosstool_top you specified was resolved to '" + crosstoolTop + "', which does not contain a CROSSTOOL file. "+ "You can use a crosstool from the depot by specifying its label.");
  }
 else {
    file.setCrosstoolPath(path);
    String md5=BaseEncoding.base16().lowerCase().encode(path.getMD5Digest());
    CrosstoolConfig.CrosstoolRelease release;
    try {
      release=crosstoolReleaseCache.get(new Pair<Path,String>(path,md5));
      file.setCrosstool(release);
      file.setMd5(md5);
    }
 catch (    ExecutionException e) {
      throw new InvalidConfigurationException(e);
    }
  }
  return true;
}
