{
  LineCountingAnsiTerminalWriter countingTerminalWriter=new LineCountingAnsiTerminalWriter(terminal);
  AnsiTerminalWriter terminalWriter=countingTerminalWriter;
  lastRefreshMillis=clock.currentTimeMillis();
  if (cursorControl) {
    terminalWriter=new LineWrappingAnsiTerminalWriter(terminalWriter,terminalWidth - 1);
  }
  stateTracker.writeProgressBar(terminalWriter,!cursorControl);
  terminalWriter.newline();
  numLinesProgressBar=countingTerminalWriter.getWrittenLines();
}
