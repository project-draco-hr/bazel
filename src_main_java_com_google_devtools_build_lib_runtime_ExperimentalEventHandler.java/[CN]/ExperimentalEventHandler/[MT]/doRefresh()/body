{
  long nowMillis=clock.currentTimeMillis();
  if (lastRefreshMillis + minimalDelayMillis < nowMillis) {
    try {
      if (progressBarNeedsRefresh || stateTracker.progressBarTimeDependent()) {
        progressBarNeedsRefresh=false;
        lastRefreshMillis=nowMillis;
        clearProgressBar();
        addProgressBar();
        terminal.flush();
      }
    }
 catch (    IOException e) {
      LOG.warning("IO Error writing to output stream: " + e);
    }
    if (!stateTracker.progressBarTimeDependent()) {
      stopUpdateThread();
    }
  }
 else {
    startUpdateThread();
  }
}
