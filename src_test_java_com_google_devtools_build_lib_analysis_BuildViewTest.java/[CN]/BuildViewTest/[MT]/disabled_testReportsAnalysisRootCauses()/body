{
  scratch.file("pkg/BUILD","genrule(name='foo',","        tools=[:missing],","        outs=['foofile'],","        cmd='')","genrule(name='bar',","        srcs=['foofile'],","        outs=['barfile'],","        cmd='')");
  reporter.removeHandler(failFastHandler);
  EventBus eventBus=new EventBus();
  AnalysisFailureRecorder recorder=new AnalysisFailureRecorder();
  eventBus.register(recorder);
  update(eventBus,defaultFlags().with(Flag.KEEP_GOING),"//pkg:bar");
  assertThat(recorder.events).hasSize(1);
  AnalysisFailureEvent event=recorder.events.get(0);
  assertEquals("//pkg:foo",event.getFailureReason().toString());
  assertEquals("//pkg:bar",event.getFailedTarget().getLabel().toString());
}
