{
  scratch.file("package/BUILD","filegroup(name='top', srcs=[':inner', 'file'])","sh_binary(name='inner', srcs=['script.sh'])");
  update("//package:top");
  ConfiguredTarget top=getConfiguredTarget("//package:top",getTargetConfiguration());
  Iterable<Dependency> targets=getView().getDirectPrerequisiteDependenciesForTesting(reporter,top,getBuildConfigurationCollection()).values();
  Dependency innerDependency;
  Dependency fileDependency;
  if (top.getConfiguration().useDynamicConfigurations()) {
    innerDependency=new Dependency(Label.parseAbsolute("//package:inner"),Attribute.ConfigurationTransition.NONE,ImmutableSet.<Aspect>of());
    fileDependency=new Dependency(Label.parseAbsolute("//package:file"),Attribute.ConfigurationTransition.NONE,ImmutableSet.<Aspect>of());
  }
 else {
    innerDependency=new Dependency(Label.parseAbsolute("//package:inner"),getTargetConfiguration(),ImmutableSet.<Aspect>of());
    fileDependency=new Dependency(Label.parseAbsolute("//package:file"),(BuildConfiguration)null,ImmutableSet.<Aspect>of());
  }
  assertThat(targets).containsExactly(innerDependency,fileDependency);
}
