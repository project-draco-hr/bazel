{
  scratch.file("cycle/BUILD","cc_library(name = 'foo', srcs = ['foo.cc'], deps = [':bar'])","cc_library(name = 'bar', srcs = ['bar.cc'], deps = [':foo'])");
  reporter.removeHandler(failFastHandler);
  try {
    update("//cycle:foo");
    fail();
  }
 catch (  LoadingFailedException|ViewCreationFailedException expected) {
    assertContainsEvent("in cc_library rule //cycle:foo: cycle in dependency graph:");
    if (defaultFlags().contains(Flag.SKYFRAME_LOADING_PHASE)) {
      assertThat(expected.getMessage()).contains("Analysis of target '//cycle:foo' failed; build aborted");
    }
 else {
      assertContainsEvent("Loading of target '//cycle:foo' failed; build aborted");
    }
  }
}
