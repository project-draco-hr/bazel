{
  if (symlinkStrategy != SymlinkStrategy.WINDOWS_COMPATIBLE) {
    return SymlinkImplementation.SYMLINK;
  }
  Path targetPath=linkPath.getRelative(targetFragment);
  if (!targetPath.exists(Symlinks.FOLLOW)) {
    return emitSymlinkCompatibilityMessage("Target does not exist",linkPath,targetFragment);
  }
  targetPath=targetPath.resolveSymbolicLinks();
  if (targetPath.isDirectory(Symlinks.FOLLOW)) {
    return SymlinkImplementation.JUNCTION;
  }
  if (isHardLinkAllowed(targetPath)) {
    return SymlinkImplementation.HARDLINK;
  }
  return emitSymlinkCompatibilityMessage("Target is a non-writable file",linkPath,targetFragment);
}
