{
  Artifact hello=createSourceArtifact("hello");
  BlazeTestUtils.makeEmptyFile(hello.getPath());
  Artifact wazuup=createDerivedArtifact("wazuup");
  Button button1=new Button();
  registerAction(new CopyingAction(button1,hello,wazuup));
  Artifact goodbye=createDerivedArtifact("goodbye");
  Button button2=createActionButton(Sets.newHashSet(wazuup),Sets.newHashSet(goodbye));
  button1.pressed=button2.pressed=false;
  buildArtifacts(cachingBuilder(),wazuup);
  assertTrue(button1.pressed);
  assertFalse(button2.pressed);
  button1.pressed=button2.pressed=false;
  buildArtifacts(cachingBuilder(),wazuup);
  assertFalse(button1.pressed);
  assertFalse(button2.pressed);
  button1.pressed=button2.pressed=false;
  buildArtifacts(cachingBuilder(),goodbye);
  assertFalse(button1.pressed);
  assertTrue(button2.pressed);
  button1.pressed=button2.pressed=false;
  buildArtifacts(cachingBuilder(),goodbye);
  assertFalse(button1.pressed);
  assertFalse(button2.pressed);
  hello.getPath().setWritable(true);
  FileSystemUtils.writeContentAsLatin1(hello.getPath(),"new content");
  button1.pressed=button2.pressed=false;
  buildArtifacts(cachingBuilder(),goodbye);
  assertTrue(button1.pressed);
  assertTrue(button2.pressed);
}
