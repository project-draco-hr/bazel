{
  Preconditions.checkNotNull(pkgLocator);
  Preconditions.checkNotNull(tsgm);
  setActive(true);
  this.tsgm.set(tsgm);
  maybeInjectPrecomputedValuesForAnalysis();
  setCommandId(commandId);
  setPrecomputedClientEnv(clientEnv);
  setBlacklistedPackagePrefixesFile(getBlacklistedPackagePrefixesFile());
  setShowLoadingProgress(packageCacheOptions.showLoadingProgress);
  setDefaultVisibility(packageCacheOptions.defaultVisibility);
  setupDefaultPackage(defaultsPackageContents);
  setPackageLocator(pkgLocator);
  syscalls.set(newPerBuildSyscallCache(packageCacheOptions.globbingThreads));
  this.pkgFactory.setGlobbingThreads(packageCacheOptions.globbingThreads);
  checkPreprocessorFactory();
  emittedEventState.clear();
  packageFunctionCache.invalidateAll();
  astCache.invalidateAll();
  numPackagesLoaded.set(0);
  packageProgress.reset();
  cyclesReporter.set(createCyclesReporter());
}
