{
  Preconditions.checkNotNull(pkgLocator);
  setActive(true);
  maybeInjectPrecomputedValuesForAnalysis();
  setCommandId(commandId);
  setBlacklistedPkgPrefixes(getBlacklistedPkgPrefixes());
  setShowLoadingProgress(showLoadingProgress);
  setDefaultVisibility(defaultVisibility);
  setupDefaultPackage(defaultsPackageContents);
  setPackageLocator(pkgLocator);
  syscalls.set(newPerBuildSyscallCache(globbingThreads));
  this.pkgFactory.setGlobbingThreads(globbingThreads);
  checkPreprocessorFactory();
  emittedEventState.clear();
  packageFunctionCache.invalidateAll();
  astCache.invalidateAll();
  numPackagesLoaded.set(0);
  cyclesReporter.set(createCyclesReporter());
}
