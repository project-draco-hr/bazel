{
  final int method=getUnsignedShort(headerBuffer,COMPRESSION_METHOD_OFFSET);
  if ((method != DEFLATE_METHOD) && (method != STORED_METHOD)) {
    throw new IOException("Unable to handle compression methods other than DEFLATE!");
  }
  final int flags=getUnsignedShort(headerBuffer,GENERAL_PURPOSE_FLAGS_OFFSET);
  if ((method == STORED_METHOD) && ((flags & SIZE_MASKED_FLAG) != 0)) {
    throw new IOException("If the method is STORED, then the size must be available in the" + " header!");
  }
  final long compressedSize=getUnsignedInt(headerBuffer,COMPRESSED_SIZE_OFFSET);
  final long uncompressedSize=getUnsignedInt(headerBuffer,UNCOMPRESSED_SIZE_OFFSET);
  if ((method == STORED_METHOD) && (compressedSize != uncompressedSize)) {
    throw new IOException("Compressed and uncompressed sizes for STORED entry differ!");
  }
  if ((compressedSize == MAXIMUM_DATA_SIZE) || (uncompressedSize == MAXIMUM_DATA_SIZE)) {
    throw new IOException("Unable to handle ZIP64 compressed files.");
  }
}
