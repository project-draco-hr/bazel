{
  if (lval instanceof Integer && rval instanceof Integer) {
    return ((Integer)lval).intValue() + ((Integer)rval).intValue();
  }
  if (lval instanceof String && rval instanceof String) {
    return (String)lval + (String)rval;
  }
  if (lval instanceof List<?> && rval instanceof List<?>) {
    List<?> llist=(List<?>)lval;
    List<?> rlist=(List<?>)rval;
    if (EvalUtils.isImmutable(llist) != EvalUtils.isImmutable(rlist)) {
      throw new EvalException(getLocation(),"can only concatenate " + EvalUtils.getDataTypeName(rlist) + " (not \""+ EvalUtils.getDataTypeName(llist)+ "\") to "+ EvalUtils.getDataTypeName(rlist));
    }
    if (llist instanceof GlobList<?> || rlist instanceof GlobList<?>) {
      return GlobList.concat(llist,rlist);
    }
 else {
      List<Object> result=Lists.newArrayListWithCapacity(llist.size() + rlist.size());
      result.addAll(llist);
      result.addAll(rlist);
      return EvalUtils.makeSequence(result,EvalUtils.isImmutable(llist));
    }
  }
  if (lval instanceof SelectorValue || rval instanceof SelectorValue || lval instanceof SelectorList|| rval instanceof SelectorList) {
    return SelectorList.concat(getLocation(),lval,rval);
  }
  if ((lval instanceof SkylarkList || lval instanceof List<?>) && (rval instanceof SkylarkList || rval instanceof List<?>)) {
    SkylarkList left=(SkylarkList)SkylarkType.convertToSkylark(lval,getLocation());
    SkylarkList right=(SkylarkList)SkylarkType.convertToSkylark(rval,getLocation());
    return SkylarkList.concat(left,right,getLocation());
  }
  if (lval instanceof Map<?,?> && rval instanceof Map<?,?>) {
    Map<?,?> ldict=(Map<?,?>)lval;
    Map<?,?> rdict=(Map<?,?>)rval;
    Map<Object,Object> result=Maps.newHashMapWithExpectedSize(ldict.size() + rdict.size());
    result.putAll(ldict);
    result.putAll(rdict);
    return ImmutableMap.copyOf(result);
  }
  if (lval instanceof SkylarkClassObject && rval instanceof SkylarkClassObject) {
    return SkylarkClassObject.concat((SkylarkClassObject)lval,(SkylarkClassObject)rval,getLocation());
  }
  if (lval instanceof SkylarkNestedSet) {
    return new SkylarkNestedSet((SkylarkNestedSet)lval,rval,getLocation());
  }
  throw new EvalException(getLocation(),String.format("unsupported operand type(s) for %s: '%s' and '%s'",operator,EvalUtils.getDataTypeName(lval),EvalUtils.getDataTypeName(rval)));
}
