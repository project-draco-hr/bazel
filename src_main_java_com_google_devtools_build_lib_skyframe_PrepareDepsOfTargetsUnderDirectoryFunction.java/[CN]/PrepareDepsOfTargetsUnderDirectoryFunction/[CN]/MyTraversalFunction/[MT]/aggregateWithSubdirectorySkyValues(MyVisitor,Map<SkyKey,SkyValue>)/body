{
  ImmutableMap.Builder<RootedPath,Integer> builder=ImmutableMap.builder();
  for (  SkyKey key : subdirectorySkyValues.keySet()) {
    PrepareDepsOfTargetsUnderDirectoryKey prepDepsKey=(PrepareDepsOfTargetsUnderDirectoryKey)key.argument();
    PrepareDepsOfTargetsUnderDirectoryValue prepDepsValue=(PrepareDepsOfTargetsUnderDirectoryValue)subdirectorySkyValues.get(key);
    int numPackagesInSubdirectory=(prepDepsValue.isDirectoryPackage() ? 1 : 0);
    for (    Integer numPkgsInSubSub : prepDepsValue.getSubdirectoryPackageCount().values()) {
      numPackagesInSubdirectory+=numPkgsInSubSub;
    }
    builder.put(prepDepsKey.getRecursivePkgKey().getRootedPath(),numPackagesInSubdirectory);
  }
  return new PrepareDepsOfTargetsUnderDirectoryValue(visitor.isDirectoryPackage(),builder.build());
}
