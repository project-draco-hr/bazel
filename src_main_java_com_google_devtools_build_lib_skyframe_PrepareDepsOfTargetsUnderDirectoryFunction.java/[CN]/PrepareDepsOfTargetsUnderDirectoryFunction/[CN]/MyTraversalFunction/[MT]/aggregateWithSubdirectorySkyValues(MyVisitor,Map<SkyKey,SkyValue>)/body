{
  ImmutableMap.Builder<RootedPath,Boolean> builder=ImmutableMap.builder();
  for (  SkyKey key : subdirectorySkyValues.keySet()) {
    PrepareDepsOfTargetsUnderDirectoryKey prepDepsKey=(PrepareDepsOfTargetsUnderDirectoryKey)key.argument();
    PrepareDepsOfTargetsUnderDirectoryValue prepDepsValue=(PrepareDepsOfTargetsUnderDirectoryValue)subdirectorySkyValues.get(key);
    boolean packagesInSubdirectory=prepDepsValue.isDirectoryPackage();
    if (!packagesInSubdirectory) {
      ImmutableCollection<Boolean> subdirectoryValues=prepDepsValue.getSubdirectoryTransitivelyContainsPackages().values();
      for (      Boolean pkgsInSubSub : subdirectoryValues) {
        if (pkgsInSubSub) {
          packagesInSubdirectory=true;
          break;
        }
      }
    }
    builder.put(prepDepsKey.getRecursivePkgKey().getRootedPath(),packagesInSubdirectory);
  }
  return PrepareDepsOfTargetsUnderDirectoryValue.of(visitor.isDirectoryPackage(),builder.build());
}
