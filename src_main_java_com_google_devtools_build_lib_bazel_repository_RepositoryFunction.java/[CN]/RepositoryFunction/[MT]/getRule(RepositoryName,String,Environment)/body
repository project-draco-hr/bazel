{
  SkyKey packageKey=PackageValue.key(PackageIdentifier.createInDefaultRepo(ExternalPackage.NAME));
  PackageValue packageValue;
  try {
    packageValue=(PackageValue)env.getValueOrThrow(packageKey,NoSuchPackageException.class);
  }
 catch (  NoSuchPackageException e) {
    throw new RepositoryFunctionException(new BuildFileNotFoundException(ExternalPackage.NAME,"Could not load //external package"),Transience.PERSISTENT);
  }
  if (packageValue == null) {
    return null;
  }
  ExternalPackage externalPackage=(ExternalPackage)packageValue.getPackage();
  Rule rule=externalPackage.getRepositoryInfo(repositoryName);
  if (rule == null) {
    throw new RepositoryFunctionException(new BuildFileContainsErrorsException(ExternalPackage.NAME,"The repository named '" + repositoryName + "' could not be resolved"),Transience.PERSISTENT);
  }
  Preconditions.checkState(ruleClassName == null || rule.getRuleClass().equals(ruleClassName),"Got %s, was expecting a %s",rule,ruleClassName);
  return rule;
}
