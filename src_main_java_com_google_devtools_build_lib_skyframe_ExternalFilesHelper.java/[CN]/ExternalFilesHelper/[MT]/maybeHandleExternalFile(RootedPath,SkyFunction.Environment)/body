{
  if (isInternal(rootedPath,pkgLocator.get())) {
    return;
  }
  externalFileSeen=true;
  if (externalFileAction == ExternalFileAction.ERROR_OUT) {
    throw new FileOutsidePackageRootsException(rootedPath);
  }
  Path outputBase=pkgLocator.get().getOutputBase();
  if (outputBase != null && !rootedPath.asPath().startsWith(pkgLocator.get().getOutputBase().getRelative(Label.EXTERNAL_PATH_PREFIX))) {
    return;
  }
  PackageValue pkgValue=(PackageValue)env.getValue(PackageValue.key(Label.EXTERNAL_PACKAGE_IDENTIFIER));
  if (pkgValue == null) {
    return;
  }
  Preconditions.checkState(!pkgValue.getPackage().containsErrors());
}
