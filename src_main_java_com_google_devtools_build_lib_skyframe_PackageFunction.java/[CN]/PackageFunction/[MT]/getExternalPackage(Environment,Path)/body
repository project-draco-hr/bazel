{
  RootedPath workspacePath=RootedPath.toRootedPath(packageLookupPath,new PathFragment("WORKSPACE"));
  SkyKey workspaceKey=PackageValue.workspaceKey(workspacePath);
  PackageValue workspace=null;
  try {
    workspace=(PackageValue)env.getValueOrThrow(workspaceKey,IOException.class,FileSymlinkException.class,InconsistentFilesystemException.class,EvalException.class);
  }
 catch (  IOException|FileSymlinkException|InconsistentFilesystemException|EvalException e) {
    throw new PackageFunctionException(new BadWorkspaceFileException(e.getMessage()),Transience.PERSISTENT);
  }
  if (workspace == null) {
    return null;
  }
  Package pkg=workspace.getPackage();
  Event.replayEventsOn(env.getListener(),pkg.getEvents());
  return new PackageValue(pkg);
}
