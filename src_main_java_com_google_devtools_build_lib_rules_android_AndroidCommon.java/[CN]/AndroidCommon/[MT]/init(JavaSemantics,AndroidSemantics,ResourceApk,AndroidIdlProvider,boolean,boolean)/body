{
  ImmutableList<Artifact> extraSources=resourceApk.isLegacy() || resourceApk.getResourceJavaSrcJar() == null ? ImmutableList.<Artifact>of() : ImmutableList.of(resourceApk.getResourceJavaSrcJar());
  JavaTargetAttributes.Builder attributes=init(androidSemantics,transitiveIdlImportData,resourceApk.getTransitiveResources(),extraSources);
  JavaCompilationArtifacts.Builder artifactsBuilder=new JavaCompilationArtifacts.Builder();
  if (resourceApk.isLegacy()) {
    compileResources(javaSemantics,artifactsBuilder,attributes,resourceApk.getTransitiveResources(),resourceApk.getPrimaryResource());
  }
  JavaCompilationHelper helper=initAttributes(attributes,javaSemantics);
  if (ruleContext.hasErrors()) {
    return null;
  }
  if (addCoverageSupport) {
    androidSemantics.addCoverageSupport(ruleContext,this,javaSemantics,true,attributes,artifactsBuilder);
    if (ruleContext.hasErrors()) {
      return null;
    }
  }
  jackCompilationHelper=initJack(helper.getAttributes(),javaSemantics);
  if (ruleContext.hasErrors()) {
    return null;
  }
  initJava(helper,artifactsBuilder,collectJavaCompilationArgs,resourceApk.getResourceJavaSrcJar());
  if (ruleContext.hasErrors()) {
    return null;
  }
  return helper.getAttributes();
}
