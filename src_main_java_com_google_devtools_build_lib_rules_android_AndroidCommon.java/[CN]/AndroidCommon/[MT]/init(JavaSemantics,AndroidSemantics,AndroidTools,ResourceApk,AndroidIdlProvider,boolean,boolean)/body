{
  ImmutableList<Artifact> extraSources=resourceApk.isLegacy() || resourceApk.getResourceJavaSrcJar() == null ? ImmutableList.<Artifact>of() : ImmutableList.of(resourceApk.getResourceJavaSrcJar());
  JavaTargetAttributes.Builder attributes=init(tools,androidSemantics,transitiveIdlImportData,resourceApk.getTransitiveResources(),extraSources);
  JavaCompilationArtifacts.Builder artifactsBuilder=new JavaCompilationArtifacts.Builder();
  if (resourceApk.isLegacy()) {
    compileResources(javaSemantics,artifactsBuilder,attributes,resourceApk.getTransitiveResources(),resourceApk.getPrimaryResource());
  }
  JavaCompilationHelper helper=initAttributes(attributes,javaSemantics);
  if (addCoverageSupport) {
    androidSemantics.addCoverageSupport(ruleContext,this,javaSemantics,true,attributes,artifactsBuilder);
  }
  jackCompilationHelper=initJack(helper.getAttributes(),javaSemantics);
  initJava(helper,artifactsBuilder,collectJavaCompilationArgs,resourceApk.getResourceJavaSrcJar());
  return helper.getAttributes();
}
