{
  SkyframeBuildView view=buildViewProvider.getSkyframeBuildView();
  NestedSetBuilder<Package> transitivePackages=NestedSetBuilder.stableOrder();
  ConfiguredTargetKey configuredTargetKey=(ConfiguredTargetKey)key.argument();
  LabelAndConfiguration lc=LabelAndConfiguration.of(configuredTargetKey.getLabel(),configuredTargetKey.getConfiguration());
  BuildConfiguration configuration=lc.getConfiguration();
  PackageValue packageValue=(PackageValue)env.getValue(PackageValue.key(lc.getLabel().getPackageIdentifier()));
  if (packageValue == null) {
    return null;
  }
  Package pkg=packageValue.getPackage();
  if (pkg.containsErrors()) {
    throw new ConfiguredTargetFunctionException(new BuildFileContainsErrorsException(lc.getLabel().getPackageIdentifier()));
  }
  Target target;
  try {
    target=packageValue.getPackage().getTarget(lc.getLabel().getName());
  }
 catch (  NoSuchTargetException e1) {
    throw new ConfiguredTargetFunctionException(new NoSuchTargetException(lc.getLabel(),"No such target"));
  }
  transitivePackages.add(packageValue.getPackage());
  if (!target.isConfigurable()) {
    configuration=null;
  }
  SkyframeDependencyResolver resolver=view.createDependencyResolver(env);
  TargetAndConfiguration ctgValue=new TargetAndConfiguration(target,configuration);
  try {
    Set<ConfigMatchingProvider> configConditions=getConfigConditions(ctgValue.getTarget(),env,resolver,ctgValue,transitivePackages);
    if (env.valuesMissing()) {
      return null;
    }
    ListMultimap<Attribute,ConfiguredTarget> depValueMap=computeDependencies(env,resolver,ctgValue,null,configConditions,ruleClassProvider,view.getHostConfiguration(configuration),transitivePackages);
    ConfiguredTargetValue ans=createConfiguredTarget(view,env,target,configuration,depValueMap,configConditions,transitivePackages);
    return ans;
  }
 catch (  DependencyEvaluationException e) {
    throw new ConfiguredTargetFunctionException(e.getRootCauseSkyKey(),e.getCause());
  }
catch (  AspectCreationException e) {
    throw new ConfiguredTargetFunctionException(new ConfiguredValueCreationException(e.getMessage()));
  }
}
