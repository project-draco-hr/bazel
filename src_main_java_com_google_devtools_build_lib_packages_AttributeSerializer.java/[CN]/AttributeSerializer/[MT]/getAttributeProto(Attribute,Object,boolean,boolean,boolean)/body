{
  Type<?> type=attr.getType();
  Build.Attribute.Builder attrPb=Build.Attribute.newBuilder();
  attrPb.setName(attr.getName());
  attrPb.setExplicitlySpecified(explicitlySpecified);
  maybeSetNoDep(type,attrPb);
  if (value instanceof SelectorList<?>) {
    attrPb.setType(Discriminator.SELECTOR_LIST);
    writeSelectorListToBuilder(attrPb,type,(SelectorList<?>)value,includeGlobs);
  }
 else {
    attrPb.setType(ProtoUtils.getDiscriminatorFromType(type));
    if (value != null) {
      AttributeBuilderAdapter adapter=new AttributeBuilderAdapter(attrPb,encodeBooleanAndTriStateAsIntegerAndString);
      writeAttributeValueToBuilder(adapter,type,value,includeGlobs);
    }
  }
  return attrPb.build();
}
