{
  StringWriter contents=new StringWriter();
  XMLEventWriter writer=XML_OUTPUT_FACTORY.createXMLEventWriter(contents);
  while (!isEndTag(eventReader.peek(),startTag)) {
    XMLEvent xmlEvent=eventReader.nextEvent();
    if (xmlEvent.isStartElement()) {
      StartElement start=xmlEvent.asStartElement();
      QName name=start.getName();
      List<Namespace> namespaces=maybeAddNamespace(name,null);
      Iterator<Attribute> attributes=iterateAttributesFrom(start);
      while (attributes.hasNext()) {
        Attribute attribute=attributes.next();
        namespaces=maybeAddNamespace(attribute.getName(),namespaces);
      }
      if (namespaces != null) {
        writer.add(XML_EVENT_FACTORY.createStartElement(name,iterateAttributesFrom(start),namespaces.iterator()));
      }
 else {
        writer.add(xmlEvent);
      }
    }
 else {
      writer.add(xmlEvent);
    }
  }
  EndElement endElement=eventReader.nextEvent().asEndElement();
  Preconditions.checkArgument(endElement.getName().equals(startTag));
  return contents.toString();
}
