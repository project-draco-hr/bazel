{
  Map<String,Artifact> basenames=new HashMap<>();
  Set<Artifact> artifacts=new HashSet<>();
  for (  LinkerInput linkerInput : libraries) {
    String name=linkerInput.getArtifact().getFilename();
    if (!(CppFileTypes.SHARED_LIBRARY.matches(name) || CppFileTypes.VERSIONED_SHARED_LIBRARY.matches(name))) {
      continue;
    }
    Artifact artifact=linkerInput.getOriginalLibraryArtifact();
    if (!artifacts.add(artifact)) {
      continue;
    }
    String basename=artifact.getExecPath().getBaseName();
    Artifact oldArtifact=basenames.put(basename,artifact);
    if (oldArtifact != null) {
      ruleContext.ruleError("Each library in the transitive closure must have a unique " + "basename, but two libraries had the basename '" + basename + "': "+ artifact.prettyPrint()+ " and "+ oldArtifact.prettyPrint());
    }
  }
  return artifacts;
}
