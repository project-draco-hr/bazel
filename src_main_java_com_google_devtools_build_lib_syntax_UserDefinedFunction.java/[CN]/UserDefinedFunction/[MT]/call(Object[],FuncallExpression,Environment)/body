{
  if (!env.mutability().isMutable()) {
    throw new EvalException(getLocation(),"Trying to call in frozen environment");
  }
  if (env.getStackTrace().contains(this)) {
    throw new EvalException(getLocation(),String.format("Recursion was detected when calling '%s' from '%s'",getName(),Iterables.getLast(env.getStackTrace()).getName()));
  }
  Profiler.instance().startTask(ProfilerTask.SKYLARK_USER_FN,getLocationPathAndLine() + "#" + getName());
  Statement lastStatement=null;
  try {
    env.enterScope(this,ast,definitionGlobals);
    ImmutableList<String> names=signature.getSignature().getNames();
    int i=0;
    for (    String name : names) {
      env.update(name,arguments[i++]);
    }
    try {
      for (      Statement stmt : statements) {
        lastStatement=stmt;
        stmt.exec(env);
      }
    }
 catch (    ReturnStatement.ReturnException e) {
      return e.getValue();
    }
    return Runtime.NONE;
  }
 catch (  EvalExceptionWithStackTrace ex) {
    throw ex;
  }
catch (  EvalException ex) {
    EvalExceptionWithStackTrace real=new EvalExceptionWithStackTrace(ex,lastStatement.getLocation());
    real.registerStatement(lastStatement);
    throw real;
  }
 finally {
    Profiler.instance().completeTask(ProfilerTask.SKYLARK_USER_FN);
    env.exitScope();
  }
}
