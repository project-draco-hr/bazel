{
  PathFragment ideBuildFilePath=getOutputFilePath(base,ruleContext);
  Root genfilesDirectory=ruleContext.getConfiguration().getGenfilesDirectory();
  Artifact ideBuildFile=ruleContext.getAnalysisEnvironment().getDerivedArtifact(ideBuildFilePath,genfilesDirectory);
  RuleIdeInfo.Builder outputBuilder=RuleIdeInfo.newBuilder();
  outputBuilder.setLabel(base.getLabel().toString());
  outputBuilder.setBuildFile(ruleContext.getRule().getPackage().getBuildFile().getPath().toString());
  outputBuilder.setKind(ruleKind);
  if (ruleKind == RuleIdeInfo.Kind.JAVA_LIBRARY) {
    outputBuilder.setJavaRuleIdeInfo(makeJavaRuleIdeInfo(base));
  }
 else   if (ruleKind == RuleIdeInfo.Kind.ANDROID_SDK) {
    outputBuilder.setAndroidSdkRuleInfo(makeAndroidSdkRuleInfo(ruleContext,base.getProvider(AndroidSdkProvider.class)));
  }
  final RuleIdeInfo ruleIdeInfo=outputBuilder.build();
  ruleContext.registerAction(makeProtoWriteAction(ruleContext.getActionOwner(),ruleIdeInfo,ideBuildFile));
  return ideBuildFile;
}
