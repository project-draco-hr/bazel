{
  Aspect.Builder builder=new Builder(NAME);
  AndroidStudioInfoFilesProvider.Builder providerBuilder=new AndroidStudioInfoFilesProvider.Builder();
  NestedSetBuilder<Label> dependenciesBuilder=NestedSetBuilder.stableOrder();
  if (ruleContext.attributes().has("deps",BuildType.LABEL_LIST)) {
    Iterable<AndroidStudioInfoFilesProvider> androidStudioInfoFilesProviders=ruleContext.getPrerequisites("deps",Mode.TARGET,AndroidStudioInfoFilesProvider.class);
    for (    AndroidStudioInfoFilesProvider depProvider : androidStudioInfoFilesProviders) {
      providerBuilder.ideBuildFilesBuilder().addTransitive(depProvider.getIdeBuildFiles());
      providerBuilder.transitiveDependenciesBuilder().addTransitive(depProvider.getTransitiveDependencies());
      providerBuilder.transitiveResourcesBuilder().addTransitive(depProvider.getTransitiveResources());
    }
    List<? extends TransitiveInfoCollection> deps=ruleContext.getPrerequisites("deps",Mode.TARGET);
    for (    TransitiveInfoCollection dep : deps) {
      dependenciesBuilder.add(dep.getLabel());
    }
    Iterable<JavaExportsProvider> javaExportsProviders=ruleContext.getPrerequisites("deps",Mode.TARGET,JavaExportsProvider.class);
    for (    JavaExportsProvider javaExportsProvider : javaExportsProviders) {
      dependenciesBuilder.addTransitive(javaExportsProvider.getTransitiveExports());
    }
  }
  NestedSet<Label> directDependencies=dependenciesBuilder.build();
  providerBuilder.transitiveDependenciesBuilder().addTransitive(directDependencies);
  RuleIdeInfo.Kind ruleKind=getRuleKind(ruleContext.getRule(),base);
  AndroidStudioInfoFilesProvider provider;
  if (ruleKind != RuleIdeInfo.Kind.UNRECOGNIZED) {
    provider=createIdeBuildArtifact(base,ruleContext,ruleKind,directDependencies,providerBuilder);
  }
 else {
    provider=providerBuilder.build();
  }
  NestedSet<Artifact> ideInfoFiles=provider.getIdeBuildFiles();
  builder.addOutputGroup(IDE_BUILD,ideInfoFiles).addProvider(AndroidStudioInfoFilesProvider.class,provider);
  return builder.build();
}
