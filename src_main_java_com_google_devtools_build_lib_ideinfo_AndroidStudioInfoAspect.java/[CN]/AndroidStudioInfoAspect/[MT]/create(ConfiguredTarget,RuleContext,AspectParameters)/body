{
  Aspect.Builder builder=new Builder(NAME);
  NestedSetBuilder<Artifact> ideBuildFilesBuilder=NestedSetBuilder.stableOrder();
  if (ruleContext.attributes().has("deps",Type.LABEL_LIST)) {
    Iterable<AndroidStudioInfoFilesProvider> deps=ruleContext.getPrerequisites("deps",Mode.TARGET,AndroidStudioInfoFilesProvider.class);
    for (    AndroidStudioInfoFilesProvider dep : deps) {
      ideBuildFilesBuilder.addTransitive(dep.getIdeBuildFiles());
    }
  }
  RuleIdeInfo.Kind ruleKind=getRuleKind(ruleContext.getRule(),base);
  if (ruleKind != RuleIdeInfo.Kind.UNRECOGNIZED) {
    Artifact ideBuildFile=createIdeBuildArtifact(base,ruleContext,ruleKind);
    ideBuildFilesBuilder.add(ideBuildFile);
  }
  NestedSet<Artifact> ideBuildFiles=ideBuildFilesBuilder.build();
  builder.addOutputGroup(IDE_BUILD,ideBuildFiles).addProvider(AndroidStudioInfoFilesProvider.class,new AndroidStudioInfoFilesProvider(ideBuildFiles));
  return builder.build();
}
