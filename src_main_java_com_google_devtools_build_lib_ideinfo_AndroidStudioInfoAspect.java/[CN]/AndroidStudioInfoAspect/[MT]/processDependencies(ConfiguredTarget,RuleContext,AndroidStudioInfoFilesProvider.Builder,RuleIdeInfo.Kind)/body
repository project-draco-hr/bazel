{
  ImmutableList.Builder<TransitiveInfoCollection> directDepsBuilder=ImmutableList.builder();
  for (  PrerequisiteAttr prerequisiteAttr : PREREQUISITE_ATTRS) {
    if (ruleContext.attributes().has(prerequisiteAttr.name,prerequisiteAttr.type)) {
      directDepsBuilder.addAll(ruleContext.getPrerequisites(prerequisiteAttr.name,Mode.TARGET));
    }
  }
  List<TransitiveInfoCollection> directDeps=directDepsBuilder.build();
  NestedSetBuilder<Label> dependenciesBuilder=NestedSetBuilder.stableOrder();
  for (  AndroidStudioInfoFilesProvider depProvider : AnalysisUtils.getProviders(directDeps,AndroidStudioInfoFilesProvider.class)) {
    dependenciesBuilder.addTransitive(depProvider.getExportedDeps());
  }
  for (  TransitiveInfoCollection dep : directDeps) {
    dependenciesBuilder.add(dep.getLabel());
  }
  NestedSet<Label> dependencies=dependenciesBuilder.build();
  JavaExportsProvider javaExportsProvider=base.getProvider(JavaExportsProvider.class);
  if (javaExportsProvider != null) {
    providerBuilder.exportedDepsBuilder().addTransitive(javaExportsProvider.getTransitiveExports());
  }
  if (ruleKind == Kind.ANDROID_LIBRARY) {
    JavaSourceInfoProvider sourceInfoProvider=base.getProvider(JavaSourceInfoProvider.class);
    boolean hasSources=sourceInfoProvider != null && !sourceInfoProvider.getSourceFiles().isEmpty();
    if (!hasSources) {
      for (      TransitiveInfoCollection dep : directDeps) {
        providerBuilder.exportedDepsBuilder().add(dep.getLabel());
      }
    }
  }
  ImmutableList.Builder<TransitiveInfoCollection> prerequisitesBuilder=ImmutableList.builder();
  prerequisitesBuilder.addAll(directDeps);
  if (ruleContext.attributes().has("runtime_deps",BuildType.LABEL_LIST)) {
    prerequisitesBuilder.addAll(ruleContext.getPrerequisites("runtime_deps",Mode.TARGET));
  }
  List<TransitiveInfoCollection> prerequisites=prerequisitesBuilder.build();
  for (  AndroidStudioInfoFilesProvider depProvider : AnalysisUtils.getProviders(prerequisites,AndroidStudioInfoFilesProvider.class)) {
    providerBuilder.ideInfoFilesBuilder().addTransitive(depProvider.getIdeInfoFiles());
    providerBuilder.ideInfoTextFilesBuilder().addTransitive(depProvider.getIdeInfoTextFiles());
    providerBuilder.ideResolveFilesBuilder().addTransitive(depProvider.getIdeResolveFiles());
  }
  return dependencies;
}
