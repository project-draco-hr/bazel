{
  NestedSetBuilder<Artifact> importantBuilder=NestedSetBuilder.stableOrder();
  NestedSetBuilder<Artifact> allBuilder=NestedSetBuilder.stableOrder();
  OutputGroupProvider outputGroupProvider=target.getProvider(OutputGroupProvider.class);
  for (  String outputGroup : context.outputGroups()) {
    NestedSet<Artifact> results=null;
    if (outputGroup.equals(OutputGroupProvider.DEFAULT)) {
      FileProvider fileProvider=target.getProvider(FileProvider.class);
      if (fileProvider != null) {
        results=fileProvider.getFilesToBuild();
      }
    }
 else     if (outputGroupProvider != null) {
      results=outputGroupProvider.getOutputGroup(outputGroup);
    }
    if (results != null) {
      if (outputGroup.startsWith(OutputGroupProvider.HIDDEN_OUTPUT_GROUP_PREFIX)) {
        allBuilder.addTransitive(results);
      }
 else {
        importantBuilder.addTransitive(results);
      }
    }
  }
  NestedSet<Artifact> importantArtifacts=importantBuilder.build();
  allBuilder.addTransitive(importantArtifacts);
  return new ArtifactsToBuild(importantArtifacts,allBuilder.build());
}
