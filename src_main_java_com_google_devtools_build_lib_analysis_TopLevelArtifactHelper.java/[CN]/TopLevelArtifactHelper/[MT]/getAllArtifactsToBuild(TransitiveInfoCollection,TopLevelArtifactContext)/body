{
  NestedSetBuilder<Artifact> importantBuilder=NestedSetBuilder.stableOrder();
  NestedSetBuilder<Artifact> allBuilder=NestedSetBuilder.stableOrder();
  TopLevelArtifactProvider topLevelArtifactProvider=target.getProvider(TopLevelArtifactProvider.class);
  for (  String outputGroup : context.outputGroups()) {
    NestedSet<Artifact> results=null;
    if (outputGroup.equals(TopLevelArtifactProvider.DEFAULT)) {
      FileProvider fileProvider=target.getProvider(FileProvider.class);
      if (fileProvider != null) {
        results=fileProvider.getFilesToBuild();
      }
    }
 else     if (topLevelArtifactProvider != null) {
      results=topLevelArtifactProvider.getOutputGroup(outputGroup);
    }
    if (results != null) {
      if (outputGroup.startsWith(TopLevelArtifactProvider.HIDDEN_OUTPUT_GROUP_PREFIX)) {
        allBuilder.addTransitive(results);
      }
 else {
        importantBuilder.addTransitive(results);
      }
    }
  }
  NestedSet<Artifact> importantArtifacts=importantBuilder.build();
  allBuilder.addTransitive(importantArtifacts);
  return new ArtifactsToBuild(importantArtifacts,allBuilder.build());
}
