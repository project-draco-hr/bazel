{
  FileSystem fileSystem=FileSystems.getDefault();
  OptionsParser parser=OptionsParser.newOptionsParser(PlMergeOptions.class);
  parser.parse(args);
  PlMergeOptions options=parser.getOptions(PlMergeOptions.class);
  MergingArguments data=null;
  if (usingControlProtobuf(options)) {
    InputStream in=Files.newInputStream(fileSystem.getPath(options.controlPath));
    Control control=Control.parseFrom(in);
    validateControl(control);
    data=new MergingArguments(control);
  }
 else   if (usingCommandLineArgs(options)) {
    data=new MergingArguments(options);
  }
 else {
    missingArg("Either --control or --out_file and at least one --source_file");
  }
  PlistMerging merging=PlistMerging.from(data,ImmutableMap.<String,NSObject>of(),new KeysToRemoveIfEmptyString("CFBundleIconFile","NSPrincipalClass"));
  if (data.getPrimaryBundleId() != null || data.getFallbackBundleId() != null) {
    merging.setBundleIdentifier(data.getPrimaryBundleId(),data.getFallbackBundleId());
  }
  merging.writePlist(fileSystem.getPath(data.getOutFile()));
}
