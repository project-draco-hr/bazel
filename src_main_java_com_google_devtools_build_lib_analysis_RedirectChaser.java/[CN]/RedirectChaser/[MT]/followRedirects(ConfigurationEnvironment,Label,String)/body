{
  Set<Label> visitedLabels=new HashSet<>();
  visitedLabels.add(label);
  try {
    while (true) {
      Target possibleRedirect=env.getTarget(label);
      if (possibleRedirect == null) {
        return null;
      }
      if ((possibleRedirect instanceof Rule) && "filegroup".equals(((Rule)possibleRedirect).getRuleClass())) {
        List<Label> labels=new StaticValuedAttributeMapper((Rule)possibleRedirect).getAndValidate("srcs",Type.LABEL_LIST);
        if (labels.size() != 1) {
          return label;
        }
        label=labels.get(0);
        if (!visitedLabels.add(label)) {
          throw new InvalidConfigurationException("The " + name + " points to a filegroup which "+ "recursively includes itself. The label "+ label+ " is part of the loop");
        }
      }
 else {
        return label;
      }
    }
  }
 catch (  NoSuchPackageException e) {
    throw new InvalidConfigurationException(e.getMessage(),e);
  }
catch (  NoSuchTargetException e) {
    return label;
  }
}
