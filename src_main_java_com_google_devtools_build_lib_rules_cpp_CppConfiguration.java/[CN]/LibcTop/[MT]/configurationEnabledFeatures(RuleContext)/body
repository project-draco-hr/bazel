{
  ImmutableSet.Builder<String> requestedFeatures=ImmutableSet.builder();
  FdoSupport fdoSupport=getFdoSupport();
  if (fdoSupport.getFdoInstrument() != null) {
    requestedFeatures.add(CppRuleClasses.FDO_INSTRUMENT);
  }
  if (fdoSupport.getFdoOptimizeProfile() != null && !fdoSupport.isAutoFdoEnabled()) {
    requestedFeatures.add(CppRuleClasses.FDO_OPTIMIZE);
  }
  if (fdoSupport.isAutoFdoEnabled()) {
    requestedFeatures.add(CppRuleClasses.AUTOFDO);
  }
  if (isLipoOptimizationOrInstrumentation()) {
    requestedFeatures.add(CppRuleClasses.LIPO);
  }
  if (ruleContext.getConfiguration().isCodeCoverageEnabled()) {
    requestedFeatures.add(CppRuleClasses.COVERAGE);
  }
  return requestedFeatures.build();
}
