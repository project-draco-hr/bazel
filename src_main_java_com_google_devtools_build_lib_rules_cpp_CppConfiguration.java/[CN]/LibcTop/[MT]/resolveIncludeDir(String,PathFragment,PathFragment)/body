{
  PathFragment path=new PathFragment(s);
  if (!path.isNormalized()) {
    throw new IllegalArgumentException("The include path '" + s + "' is not normalized.");
  }
  if (path.startsWith(SYSROOT_FRAGMENT)) {
    if (sysroot == null) {
      throw new IllegalArgumentException("A %sysroot% prefix is only allowed if the " + "default_sysroot option is set");
    }
    return sysroot.getRelative(path.relativeTo(SYSROOT_FRAGMENT));
  }
 else   if (path.startsWith(WORKSPACE_FRAGMENT)) {
    return path.subFragment(1,path.segmentCount());
  }
 else {
    return crosstoolTopPathFragment.getRelative(path.startsWith(CROSSTOOL_FRAGMENT) ? path.subFragment(1,path.segmentCount()) : path);
  }
}
