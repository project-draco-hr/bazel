{
  StoredEventHandler localReporter=new StoredEventHandler();
  LOG.fine("Starting to parse " + packageId);
  BuildFileAST buildFileAST=BuildFileAST.parseBuildFile(preprocessingResult.result,preludeStatements,localReporter,locator,false);
  LOG.fine("Finished parsing of " + packageId);
  MakeEnvironment.Builder makeEnv=new MakeEnvironment.Builder();
  if (platformSetRegexps != null) {
    makeEnv.setPlatformSetRegexps(platformSetRegexps);
  }
  try {
    prefetchGlobs(packageId,buildFileAST,preprocessingResult.preprocessed,buildFile,globber,defaultVisibility,makeEnv);
    return evaluateBuildFile(packageId,buildFileAST,buildFile,globber,Iterables.concat(preprocessingEvents,localReporter.getEvents()),defaultVisibility,preprocessingResult.containsErrors,preprocessingResult.containsTransientErrors,makeEnv,imports,skylarkFileDependencies);
  }
 catch (  InterruptedException e) {
    globber.onInterrupt();
    throw e;
  }
 finally {
    globber.onCompletion();
  }
}
