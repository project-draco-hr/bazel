{
  ParserInputSource inputSource=maybeGetParserInputSource(buildFile,eventHandler);
  if (inputSource == null) {
    return Preprocessor.Result.transientError(buildFile);
  }
  Globber globber=createLegacyGlobber(buildFile.getParentDirectory(),packageId,locator);
  try {
    return preprocess(packageId,buildFile,inputSource,globber,eventHandler);
  }
  finally {
    globber.onCompletion();
  }
}
