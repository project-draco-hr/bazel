{
  if (wasPreprocessed) {
    return;
  }
  Environment pkgEnv=new Environment();
  pkgEnv.setLoadingPhase();
  Package.LegacyBuilder pkgBuilder=new Package.LegacyBuilder(packageId);
  pkgBuilder.setFilename(buildFilePath).setMakeEnv(pkgMakeEnv).setDefaultVisibility(defaultVisibility).setDefaultVisibilitySet(false);
  PackageContext context=new PackageContext(pkgBuilder,globber,NullEventHandler.INSTANCE);
  buildPkgEnv(pkgEnv,context,ruleFactory);
  pkgEnv.update("glob",newGlobFunction.apply(context,true));
  pkgEnv.remove("FilesetEntry");
  buildFileAST.exec(pkgEnv,NullEventHandler.INSTANCE);
}
