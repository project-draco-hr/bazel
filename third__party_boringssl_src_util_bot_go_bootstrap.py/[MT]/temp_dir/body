@contextlib.contextmanager
def temp_dir(path):
    'Creates a temporary directory, then deletes it.'
    tmp = tempfile.mkdtemp(dir=path)
    try:
        yield tmp
    finally:
        remove_directory([tmp])
