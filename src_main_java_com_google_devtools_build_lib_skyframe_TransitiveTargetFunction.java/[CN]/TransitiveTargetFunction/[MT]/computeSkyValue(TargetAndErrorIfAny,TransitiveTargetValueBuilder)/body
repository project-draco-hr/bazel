{
  Target target=targetAndErrorIfAny.getTarget();
  NoSuchTargetException errorLoadingTarget=targetAndErrorIfAny.getErrorLoadingTarget();
  if (target instanceof Rule) {
    ConfigurationFragmentPolicy configurationFragmentPolicy=target.getAssociatedRule().getRuleClassObject().getConfigurationFragmentPolicy();
    for (    Class<?> fragment : configurationFragmentPolicy.getRequiredConfigurationFragments()) {
      if (!builder.getConfigFragmentsFromDeps().contains(fragment)) {
        builder.getTransitiveConfigFragments().add(fragment.asSubclass(BuildConfiguration.Fragment.class));
      }
    }
    builder.getTransitiveConfigFragments().add(ruleClassProvider.getUniversalFragment().asSubclass(BuildConfiguration.Fragment.class));
  }
  return builder.build(errorLoadingTarget);
}
