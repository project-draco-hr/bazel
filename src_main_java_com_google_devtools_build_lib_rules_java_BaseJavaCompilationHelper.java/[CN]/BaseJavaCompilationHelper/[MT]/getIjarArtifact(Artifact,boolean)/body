{
  if (addPrefix) {
    PathFragment ruleBase=ruleContext.getLabel().getPackageFragment().getRelative(ruleContext.getLabel().getName()).getRelative("_ijars");
    PathFragment artifactDirFragment=jar.getRootRelativePath().getParentDirectory();
    String ijarBasename=FileSystemUtils.removeExtension(jar.getFilename()) + "-ijar.jar";
    return getAnalysisEnvironment().getDerivedArtifact(ruleBase.getRelative(artifactDirFragment).getRelative(ijarBasename),getConfiguration().getGenfilesDirectory());
  }
 else {
    return derivedArtifact(jar,"","-ijar.jar");
  }
}
