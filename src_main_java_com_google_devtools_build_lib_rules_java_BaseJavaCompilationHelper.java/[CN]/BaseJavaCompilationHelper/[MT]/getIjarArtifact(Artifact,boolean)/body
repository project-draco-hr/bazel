{
  if (addPrefix) {
    PathFragment ruleBase=ruleContext.getUniqueDirectory("_ijar");
    PathFragment artifactDirFragment=jar.getRootRelativePath().getParentDirectory();
    String ijarBasename=FileSystemUtils.removeExtension(jar.getFilename()) + "-ijar.jar";
    return ruleContext.getDerivedArtifact(ruleBase.getRelative(artifactDirFragment).getRelative(ijarBasename),getConfiguration().getGenfilesDirectory());
  }
 else {
    return derivedArtifact(jar,"","-ijar.jar");
  }
}
