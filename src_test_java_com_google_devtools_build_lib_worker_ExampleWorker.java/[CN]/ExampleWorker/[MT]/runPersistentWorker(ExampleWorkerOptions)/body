{
  PrintStream originalStdOut=System.out;
  PrintStream originalStdErr=System.err;
  while (true) {
    try {
      WorkRequest request=WorkRequest.parseDelimitedFrom(System.in);
      if (request == null) {
        break;
      }
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      int exitCode=0;
      try (PrintStream ps=new PrintStream(baos)){
        System.setOut(ps);
        System.setErr(ps);
        try {
          processRequest(request.getArgumentsList());
        }
 catch (        Exception e) {
          e.printStackTrace();
          exitCode=1;
        }
      }
  finally {
        System.setOut(originalStdOut);
        System.setErr(originalStdErr);
      }
      WorkResponse.newBuilder().setOutput(baos.toString()).setExitCode(exitCode).build().writeDelimitedTo(System.out);
      System.out.flush();
    }
  finally {
      System.gc();
    }
  }
}
