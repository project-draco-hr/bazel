{
  LoadingPhaseRunner.Options loadingOptions=Options.getDefaults(LoadingPhaseRunner.Options.class);
  loadingOptions.loadingPhaseThreads=loadingPhaseThreads;
  BuildView.Options viewOptions=Options.getDefaults(BuildView.Options.class);
  viewOptions.keepGoing=keepGoing;
  LoadingPhaseRunner runner=new LoadingPhaseRunner(getPackageManager(),Collections.unmodifiableSet(ruleClassProvider.getRuleClassMap().keySet()));
  LoadingResult loadingResult=runner.execute(reporter,eventBus,targets,loadingOptions,getTargetConfiguration().getAllLabels(),viewOptions.keepGoing,false,null);
  if (!doAnalysis) {
    return null;
  }
  return view.update(loadingResult,masterConfig,viewOptions,TopLevelArtifactContext.DEFAULT,reporter,eventBus);
}
